import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as s,b as t,o as p}from"./app-BDHo8HdU.js";const e={};function o(c,n){return p(),s("div",null,[...n[0]||(n[0]=[t(`<h1 id="日常开发笔记" tabindex="-1"><a class="header-anchor" href="#日常开发笔记"><span>日常开发笔记</span></a></h1><h2 id="_2025-10-21-mybatis-plus-json字段查询返回null问题" tabindex="-1"><a class="header-anchor" href="#_2025-10-21-mybatis-plus-json字段查询返回null问题"><span>2025/10/21 - MyBatis-Plus JSON字段查询返回null问题</span></a></h2><h3 id="问题" tabindex="-1"><a class="header-anchor" href="#问题"><span>问题</span></a></h3><p>使用 MyBatis-Plus 查询时，实体类中配置了 TypeHandler 的 JSON 字段始终返回 null，但新增/编辑操作正常。</p><h3 id="原因" tabindex="-1"><a class="header-anchor" href="#原因"><span>原因</span></a></h3><ul><li>MyBatis-Plus 默认不为实体类生成 ResultMap</li><li>没有 ResultMap 时，字段上的 <code>typeHandler</code> 配置在查询时不生效</li><li>SQL 日志显示该字段被识别为 <code>&lt;&lt;BLOB&gt;&gt;</code> 类型</li></ul><h3 id="解决方法" tabindex="-1"><a class="header-anchor" href="#解决方法"><span>解决方法</span></a></h3><p>在实体类的 <code>@TableName</code> 注解中添加 <code>autoResultMap = true</code>：</p><pre><code class="language-java"><span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;table_name&quot;</span><span class="token punctuation">,</span> autoResultMap <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Entity</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>typeHandler <span class="token operator">=</span> <span class="token class-name">JacksonTypeHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> jsonField<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="关键点" tabindex="-1"><a class="header-anchor" href="#关键点"><span>关键点</span></a></h3><ul><li><code>autoResultMap = true</code> 让 MyBatis-Plus 自动生成 ResultMap</li><li>生成的 ResultMap 会正确应用字段上的 typeHandler 配置</li><li>写入时 typeHandler 默认生效，但查询时需要 ResultMap 支持</li></ul><h2 id="_2025-10-21-spring的-transactional注解" tabindex="-1"><a class="header-anchor" href="#_2025-10-21-spring的-transactional注解"><span>2025/10/21 - Spring的@Transactional注解</span></a></h2><p><code>@Transactional</code> 是 Spring 框架提供的声明式事务管理注解，用于控制数据库事务的行为。</p><h3 id="主要作用" tabindex="-1"><a class="header-anchor" href="#主要作用"><span>主要作用</span></a></h3><ul><li>自动管理事务的开启、提交和回滚</li><li>确保方法内的数据库操作要么全部成功，要么全部失败（原子性）</li></ul><h3 id="常用属性" tabindex="-1"><a class="header-anchor" href="#常用属性"><span>常用属性</span></a></h3><h4 id="_1-rollbackfor" tabindex="-1"><a class="header-anchor" href="#_1-rollbackfor"><span>1. <code>rollbackFor</code></span></a></h4><p>指定哪些异常会触发事务回滚：</p><pre><code class="language-java"><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>  <span class="token comment">// 所有 Exception 都回滚</span>
</code></pre><h4 id="_2-propagation" tabindex="-1"><a class="header-anchor" href="#_2-propagation"><span>2. <code>propagation</code></span></a></h4><p>事务传播行为：</p><ul><li><code>REQUIRED</code>（默认）：如果当前存在事务，则加入；否则创建新事务</li><li><code>REQUIRES_NEW</code>：总是创建新事务，挂起当前事务</li><li><code>NESTED</code>：嵌套事务，支持部分回滚</li></ul><h4 id="_3-isolation" tabindex="-1"><a class="header-anchor" href="#_3-isolation"><span>3. <code>isolation</code></span></a></h4><p>事务隔离级别：</p><ul><li><code>READ_UNCOMMITTED</code>：最低隔离级别，可能脏读</li><li><code>READ_COMMITTED</code>：防止脏读</li><li><code>REPEATABLE_READ</code>（MySQL默认）：防止脏读和不可重复读</li><li><code>SERIALIZABLE</code>：最高隔离级别，完全串行化</li></ul><h4 id="_4-readonly" tabindex="-1"><a class="header-anchor" href="#_4-readonly"><span>4. <code>readOnly</code></span></a></h4><p>标记为只读事务（优化性能）：</p><pre><code class="language-java"><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>readOnly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre><h4 id="_5-timeout" tabindex="-1"><a class="header-anchor" href="#_5-timeout"><span>5. <code>timeout</code></span></a></h4><p>事务超时时间（秒）：</p><pre><code class="language-java"><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">)</span>
</code></pre><h3 id="使用位置" tabindex="-1"><a class="header-anchor" href="#使用位置"><span>使用位置</span></a></h3><ul><li><strong>类级别</strong>：对该类的所有 public 方法生效</li><li><strong>方法级别</strong>：仅对该方法生效（会覆盖类级别配置）</li></ul><h3 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h3><ol><li><strong>只对 public 方法生效</strong></li><li><strong>自调用失效</strong>：同一个类内部方法调用不会触发事务（因为没有走代理）</li><li><strong>异常类型</strong>：只写 <code>@Transactional</code> 不加任何参数，默认只对 <code>RuntimeException</code> 和 <code>Error</code> 回滚，checked 异常不会回滚（需要指定 <code>rollbackFor</code>）</li></ol><h2 id="_2025-10-21-分页表格跨页选择数据丢失问题" tabindex="-1"><a class="header-anchor" href="#_2025-10-21-分页表格跨页选择数据丢失问题"><span>2025/10/21 - 分页表格跨页选择数据丢失问题</span></a></h2><h3 id="问题-1" tabindex="-1"><a class="header-anchor" href="#问题-1"><span>问题</span></a></h3><p>在使用 Ant Design Vue 的表格组件实现多选功能时，发现每次翻页后，之前页面中已选择的数据会被清空，无法实现跨页面的多选保持。</p><h3 id="问题-2" tabindex="-1"><a class="header-anchor" href="#问题-2"><span>问题</span></a></h3><p>Ant Design Vue 的 <code>&lt;a-table&gt;</code> 组件在数据源（<code>dataSource</code>）发生变化时，默认会重置 <code>selectedRowKeys</code>。当用户翻页时，虽然视觉上看起来是同一个表格，但实际上表格的 <code>dataSource</code> 已经更新为新的数据，这会触发组件的内部重置逻辑，导致之前的选择状态丢失。</p><h3 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案"><span>解决方案</span></a></h3><h4 id="_1-启用跨页选择保持" tabindex="-1"><a class="header-anchor" href="#_1-启用跨页选择保持"><span>1. 启用跨页选择保持</span></a></h4><p>在表格的 <code>:row-selection</code> 配置中添加 <code>preserveSelectedRowKeys: true</code>：</p><pre><code class="language-vue"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-table</span>
  <span class="token attr-name">:columns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>columns<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:data-source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataList<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:row-selection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{
    selectedRowKeys: selectedKeys,
    onChange: handleSelectionChange,
    preserveSelectedRowKeys: true  // 关键配置：保持选中的 key
  }<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:pagination</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>paginationConfig<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">/&gt;</span></span>
</code></pre><h4 id="_2-使用数组展开避免引用问题" tabindex="-1"><a class="header-anchor" href="#_2-使用数组展开避免引用问题"><span>2. 使用数组展开避免引用问题</span></a></h4><p>在选择变化的回调函数中，使用数组展开运算符创建新数组，而不是直接引用：</p><pre><code class="language-javascript"><span class="token comment">// ❌ 错误写法 - 直接引用</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleSelectionChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  formData<span class="token punctuation">.</span>value<span class="token punctuation">.</span>selectedIds <span class="token operator">=</span> keys
<span class="token punctuation">}</span>

<span class="token comment">// ✅ 正确写法 - 创建新数组</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleSelectionChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  formData<span class="token punctuation">.</span>value<span class="token punctuation">.</span>selectedIds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>keys<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="_3-初始化数组避免-undefined-错误" tabindex="-1"><a class="header-anchor" href="#_3-初始化数组避免-undefined-错误"><span>3. 初始化数组避免 undefined 错误</span></a></h4><p>在表单打开或初始化时，确保选中的数组字段被初始化为空数组：</p><pre><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">openForm</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  formData<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">selectedIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 初始化为空数组，避免 undefined</span>
    <span class="token comment">// ...其他字段</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="完整示例" tabindex="-1"><a class="header-anchor" href="#完整示例"><span>完整示例</span></a></h3><pre><code class="language-vue"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-table</span>
    <span class="token attr-name">:columns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>columns<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:data-source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataList<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:row-selection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{
      selectedRowKeys: formData.selectedIds,
      onChange: handleSelectionChange,
      preserveSelectedRowKeys: true
    }<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:pagination</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{
      current: pagination.current,
      pageSize: pagination.pageSize,
      total: pagination.total,
      showSizeChanger: true,
      showTotal: (total) =&gt; \`共 \${total} 条\`
    }<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleTableChange<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

<span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">selectedIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> dataList <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> pagination <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">current</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">pageSize</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token literal-property property">total</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 选择变化处理</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleSelectionChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">selectedRowKeys</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  formData<span class="token punctuation">.</span>value<span class="token punctuation">.</span>selectedIds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>selectedRowKeys<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 分页变化处理</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleTableChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">paginationInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  pagination<span class="token punctuation">.</span>value<span class="token punctuation">.</span>current <span class="token operator">=</span> paginationInfo<span class="token punctuation">.</span>current
  pagination<span class="token punctuation">.</span>value<span class="token punctuation">.</span>pageSize <span class="token operator">=</span> paginationInfo<span class="token punctuation">.</span>pageSize
  <span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 加载数据</span>
<span class="token keyword">const</span> <span class="token function-variable function">loadData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">current</span><span class="token operator">:</span> pagination<span class="token punctuation">.</span>value<span class="token punctuation">.</span>current<span class="token punctuation">,</span>
    <span class="token literal-property property">size</span><span class="token operator">:</span> pagination<span class="token punctuation">.</span>value<span class="token punctuation">.</span>pageSize
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  dataList<span class="token punctuation">.</span>value <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>records
  pagination<span class="token punctuation">.</span>value<span class="token punctuation">.</span>total <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>total
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><h3 id="关键要点" tabindex="-1"><a class="header-anchor" href="#关键要点"><span>关键要点</span></a></h3><ol><li><strong>preserveSelectedRowKeys</strong>: 这是核心配置，告诉 Ant Design 在数据源变化时保持已选择的 key</li><li><strong>数组展开</strong>: 使用 <code>[...array]</code> 创建新数组引用，确保 Vue 的响应式系统能正确追踪变化</li><li><strong>初始化</strong>: 确保数组字段初始化为空数组而不是 undefined，避免运行时错误</li><li><strong>rowKey</strong>: 确保表格数据有唯一的 key 字段（默认是 <code>key</code>，也可以通过 <code>:row-key</code> 指定）</li></ol><h3 id="适用场景" tabindex="-1"><a class="header-anchor" href="#适用场景"><span>适用场景</span></a></h3><ul><li>需要跨页面选择多条记录的场景</li><li>批量操作功能（如批量删除、批量导出等）</li><li>复杂表单中的关联数据选择</li></ul><h2 id="spring-异步方法不生效问题排查笔记" tabindex="-1"><a class="header-anchor" href="#spring-异步方法不生效问题排查笔记"><span>Spring 异步方法不生效问题排查笔记</span></a></h2><h3 id="问题-3" tabindex="-1"><a class="header-anchor" href="#问题-3"><span>问题</span></a></h3><p>在使用 Spring 的 <code>@Async</code> 注解实现异步方法时，发现方法并未真正异步执行。通过日志观察，异步方法与调用方法的线程名称相同，都在 HTTP 请求线程中执行，而不是在独立的异步线程池中运行。</p><p><strong>现象：</strong></p><ul><li>调用方法日志线程：<code>[http-nio-82-exec-2]</code></li><li>异步方法日志线程：<code>[http-nio-82-exec-2]</code> （期望应该是 <code>[task-1]</code> 等异步线程）</li><li>HTTP 请求阻塞等待任务完成，导致超时错误</li></ul><h3 id="原因-1" tabindex="-1"><a class="header-anchor" href="#原因-1"><span>原因</span></a></h3><p>Spring 的 <code>@Async</code> 注解基于 AOP 代理实现，存在以下限制条件：</p><h4 id="_1-缺少启用注解" tabindex="-1"><a class="header-anchor" href="#_1-缺少启用注解"><span>1. 缺少启用注解</span></a></h4><p>Spring Boot 应用需要在配置类或启动类上添加 <code>@EnableAsync</code> 注解来启用异步功能。</p><h4 id="_2-方法修饰符限制" tabindex="-1"><a class="header-anchor" href="#_2-方法修饰符限制"><span>2. 方法修饰符限制</span></a></h4><p><strong>Spring AOP 无法代理 private 方法</strong>，因为：</p><ul><li>Spring 使用 CGLIB 或 JDK 动态代理</li><li><strong>代理只能拦截 public 方法</strong></li><li>private 方法无法被子类覆盖，AOP 切面无法介入</li></ul><h4 id="_3-自调用问题" tabindex="-1"><a class="header-anchor" href="#_3-自调用问题"><span>3. 自调用问题</span></a></h4><p>在同一个类内部直接调用异步方法（<code>this.asyncMethod()</code>）会绕过代理，导致 <code>@Async</code> 失效。</p><h3 id="解决方案-1" tabindex="-1"><a class="header-anchor" href="#解决方案-1"><span>解决方案</span></a></h3><h4 id="步骤-1-启用异步支持" tabindex="-1"><a class="header-anchor" href="#步骤-1-启用异步支持"><span>步骤 1：启用异步支持</span></a></h4><p>在 Spring Boot 启动类添加 <code>@EnableAsync</code> 注解：</p><pre><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableAsync</span>  <span class="token comment">// 启用异步功能</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="步骤-2-修改方法访问修饰符" tabindex="-1"><a class="header-anchor" href="#步骤-2-修改方法访问修饰符"><span>步骤 2：修改方法访问修饰符</span></a></h4><p>将异步方法的访问修饰符从 <code>private</code> 改为 <code>public</code>：</p><pre><code class="language-java"><span class="token comment">// ❌ 错误：private 方法，AOP 无法代理</span>
<span class="token annotation punctuation">@Async</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">processAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 异步逻辑</span>
<span class="token punctuation">}</span>

<span class="token comment">// ✅ 正确：public 方法，AOP 可以代理</span>
<span class="token annotation punctuation">@Async</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 异步逻辑</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="步骤-3-验证异步执行" tabindex="-1"><a class="header-anchor" href="#步骤-3-验证异步执行"><span>步骤 3：验证异步执行</span></a></h4><p>通过日志确认异步方法在独立线程中执行：</p><pre><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">callMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;调用方法，线程：{}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 输出：调用方法，线程：http-nio-82-exec-2</span>
    
    <span class="token function">asyncMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;已提交异步任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Async</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">asyncMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;异步方法执行，线程：{}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 输出：异步方法执行，线程：task-1</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="异步方法写法" tabindex="-1"><a class="header-anchor" href="#异步方法写法"><span>异步方法写法</span></a></h3><h4 id="_1-自定义线程池" tabindex="-1"><a class="header-anchor" href="#_1-自定义线程池"><span>1. 自定义线程池</span></a></h4><p>默认情况下，Spring 使用 <code>SimpleAsyncTaskExecutor</code>，建议自定义线程池：</p><pre><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableAsync</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncConfig</span> <span class="token keyword">implements</span> <span class="token class-name">AsyncConfigurer</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Executor</span> <span class="token function">getAsyncExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadPoolTaskExecutor</span> executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolTaskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">setCorePoolSize</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">setMaxPoolSize</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">setQueueCapacity</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">setThreadNamePrefix</span><span class="token punctuation">(</span><span class="token string">&quot;async-task-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> executor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="_2-异常处理" tabindex="-1"><a class="header-anchor" href="#_2-异常处理"><span>2. 异常处理</span></a></h4><p>异步方法的异常不会传播到调用方，需要自定义异常处理器：</p><pre><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableAsync</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncConfig</span> <span class="token keyword">implements</span> <span class="token class-name">AsyncConfigurer</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">AsyncUncaughtExceptionHandler</span> <span class="token function">getAsyncUncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>ex<span class="token punctuation">,</span> method<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;异步方法执行异常 - 方法: {}, 参数: {}&quot;</span><span class="token punctuation">,</span> 
                method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="_3-返回值处理" tabindex="-1"><a class="header-anchor" href="#_3-返回值处理"><span>3. 返回值处理</span></a></h4><p>异步方法可以返回 <code>Future</code>、<code>CompletableFuture</code> 或 <code>ListenableFuture</code>：</p><pre><code class="language-java"><span class="token annotation punctuation">@Async</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">asyncMethodWithReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行异步任务</span>
    <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">completedFuture</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="_2025-11-03-knife4j-文档页面空白问题排查与解决" tabindex="-1"><a class="header-anchor" href="#_2025-11-03-knife4j-文档页面空白问题排查与解决"><span>2025/11/03 - Knife4j 文档页面空白问题排查与解决</span></a></h2><h3 id="问题-4" tabindex="-1"><a class="header-anchor" href="#问题-4"><span>问题</span></a></h3><p>访问 <code>http://localhost:82/doc.html</code> 页面显示空白，无法加载 API 文档界面。</p><ol><li>初步检查配置</li></ol><ul><li>✅ Knife4j 依赖已正确引入</li><li>✅ <code>application.properties</code> 中 Knife4j 配置正确</li><li>✅ <code>GlobalConfigure.java</code> 中静态资源映射配置正确</li><li>✅ API 接口 <code>/v3/api-docs</code> 可以正常访问（需要 Basic 认证）</li></ul><ol start="2"><li>查看调试日志</li></ol><p>启用调试模式后，发现关键日志：</p><pre><code class="language-log"><span class="token level debug keyword">DEBUG</span> o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>w<span class="token punctuation">.</span>s<span class="token punctuation">.</span>s<span class="token punctuation">.</span>s<span class="token punctuation">.</span>WebSocketHandlerMapping <span class="token operator">:</span> Mapped to WebSocketHttpRequestHandler
<span class="token level debug keyword">DEBUG</span> o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>w<span class="token punctuation">.</span>s<span class="token punctuation">.</span>s<span class="token punctuation">.</span>s<span class="token punctuation">.</span>WebSocketHttpRequestHandler <span class="token operator">:</span> GET <span class="token file-path string">/doc.html</span>
<span class="token level debug keyword">DEBUG</span> o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>w<span class="token punctuation">.</span>s<span class="token punctuation">.</span>s<span class="token punctuation">.</span>s<span class="token punctuation">.</span>HandshakeInterceptorChain <span class="token operator">:</span> returns <span class="token boolean">false</span> from beforeHandshake
<span class="token level debug keyword">DEBUG</span> o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>DispatcherServlet <span class="token operator">:</span> Completed <span class="token number">200</span> OK
</code></pre><p><strong>关键发现</strong>：<code>/doc.html</code> 请求被错误地映射到了 WebSocket 处理器，而不是静态资源处理器。</p><h3 id="原因-2" tabindex="-1"><a class="header-anchor" href="#原因-2"><span>原因</span></a></h3><p>在 <code>WebSocketConfig.java</code> 中，WebSocket 处理器使用了过于宽泛的路径模式：</p><pre><code class="language-java">registry<span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WsServerNodeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;/*&quot;</span><span class="token punctuation">)</span>
</code></pre><h4 id="为什么会拦截-http-请求" tabindex="-1"><a class="header-anchor" href="#为什么会拦截-http-请求"><span>为什么会拦截 HTTP 请求？</span></a></h4><ol><li>Spring MVC 的请求处理流程中，<code>WebSocketHandlerMapping</code> 优先级较高</li><li><code>&quot;/*&quot;</code> 模式会匹配所有单层路径，包括： <ul><li><code>/doc.html</code></li><li><code>/favicon.ico</code></li><li><code>/index.html</code></li><li>等等</li></ul></li><li>当 WebSocket 处理器匹配上请求后，会检查是否是 WebSocket 握手请求</li><li>如果不是握手请求，拦截器返回 false，请求直接结束（返回 200 但无内容）</li><li>静态资源处理器无法处理该请求，导致页面空白</li></ol><h3 id="解决方案-2" tabindex="-1"><a class="header-anchor" href="#解决方案-2"><span>解决方案</span></a></h3><h4 id="修改-websocketconfig-java" tabindex="-1"><a class="header-anchor" href="#修改-websocketconfig-java"><span>修改 WebSocketConfig.java</span></a></h4><p><strong>位置</strong>：<code>snowy-plugin/snowy-plugin-attack/src/main/java/vip/xiaonuo/attack/modular/config/WebSocketConfig.java</code></p><p><strong>修改前</strong>：</p><pre><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerWebSocketHandlers</span><span class="token punctuation">(</span><span class="token class-name">WebSocketHandlerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    registry<span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WsServerNodeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;/*&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// ❌ 错误：拦截所有路径</span>
            <span class="token punctuation">.</span><span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WsHandshakeInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setAllowedOrigins</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>修改后</strong>：</p><pre><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerWebSocketHandlers</span><span class="token punctuation">(</span><span class="token class-name">WebSocketHandlerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    registry<span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WsServerNodeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;/ws/**&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// ✅ 正确：只拦截 /ws 开头的路径</span>
            <span class="token punctuation">.</span><span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WsHandshakeInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setAllowedOrigins</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="经验总结" tabindex="-1"><a class="header-anchor" href="#经验总结"><span>经验总结</span></a></h3><h4 id="_1-websocket-路径配置要谨慎" tabindex="-1"><a class="header-anchor" href="#_1-websocket-路径配置要谨慎"><span>1. WebSocket 路径配置要谨慎</span></a></h4><ul><li>❌ 避免使用 <code>&quot;/*&quot;</code> 或 <code>&quot;/**&quot;</code> 等宽泛模式</li><li>✅ 使用明确的路径前缀，如 <code>&quot;/ws/**&quot;</code></li></ul><h4 id="_2-请求映射优先级" tabindex="-1"><a class="header-anchor" href="#_2-请求映射优先级"><span>2. 请求映射优先级</span></a></h4><p>Spring MVC 中不同类型的 Handler Mapping 优先级：</p><ol><li><code>WebSocketHandlerMapping</code> - 优先级较高</li><li><code>RequestMappingHandlerMapping</code> - 处理 @RequestMapping</li><li><code>SimpleUrlHandlerMapping</code> - 处理静态资源</li></ol><h4 id="_3-调试技巧" tabindex="-1"><a class="header-anchor" href="#_3-调试技巧"><span>3. 调试技巧</span></a></h4><p>启用 Spring Web 调试日志可以快速定位路由问题：</p><pre><code class="language-properties"><span class="token key attr-name">logging.level.org.springframework.web</span><span class="token punctuation">=</span><span class="token value attr-value">DEBUG</span>
<span class="token key attr-name">logging.level.org.springframework.web.servlet.resource</span><span class="token punctuation">=</span><span class="token value attr-value">TRACE</span>
</code></pre><h4 id="_4-ant-路径模式说明" tabindex="-1"><a class="header-anchor" href="#_4-ant-路径模式说明"><span>4. Ant 路径模式说明</span></a></h4><ul><li><code>&quot;/&quot;</code> - 只匹配根路径</li><li><code>&quot;/*&quot;</code> - 匹配单层路径（如 <code>/doc.html</code>）</li><li><code>&quot;/**&quot;</code> - 匹配多层路径（如 <code>/api/user/info</code>）</li><li><code>&quot;/ws/**&quot;</code> - 只匹配 <code>/ws</code> 开头的所有路径</li></ul>`,122)])])}const i=a(e,[["render",o]]),r=JSON.parse('{"path":"/develop/DailyDev.html","title":"日常开发笔记","lang":"zh-CN","frontmatter":{"description":"日常开发笔记 2025/10/21 - MyBatis-Plus JSON字段查询返回null问题 问题 使用 MyBatis-Plus 查询时，实体类中配置了 TypeHandler 的 JSON 字段始终返回 null，但新增/编辑操作正常。 原因 MyBatis-Plus 默认不为实体类生成 ResultMap 没有 ResultMap 时，字段...","head":[["meta",{"property":"og:url","content":"https://echo0d.github.io/DailyNotes/develop/DailyDev.html"}],["meta",{"property":"og:site_name","content":"echo0d-notes"}],["meta",{"property":"og:title","content":"日常开发笔记"}],["meta",{"property":"og:description","content":"日常开发笔记 2025/10/21 - MyBatis-Plus JSON字段查询返回null问题 问题 使用 MyBatis-Plus 查询时，实体类中配置了 TypeHandler 的 JSON 字段始终返回 null，但新增/编辑操作正常。 原因 MyBatis-Plus 默认不为实体类生成 ResultMap 没有 ResultMap 时，字段..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-21T09:57:45.000Z"}],["meta",{"property":"article:author","content":"echo0d"}],["meta",{"property":"article:modified_time","content":"2025-11-21T09:57:45.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"日常开发笔记\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-11-21T09:57:45.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"echo0d\\",\\"url\\":\\"\\"}]}"]]},"headers":[{"level":2,"title":"2025/10/21 - MyBatis-Plus JSON字段查询返回null问题","slug":"_2025-10-21-mybatis-plus-json字段查询返回null问题","link":"#_2025-10-21-mybatis-plus-json字段查询返回null问题","children":[{"level":3,"title":"问题","slug":"问题","link":"#问题","children":[]},{"level":3,"title":"原因","slug":"原因","link":"#原因","children":[]},{"level":3,"title":"解决方法","slug":"解决方法","link":"#解决方法","children":[]},{"level":3,"title":"关键点","slug":"关键点","link":"#关键点","children":[]}]},{"level":2,"title":"2025/10/21 - Spring的@Transactional注解","slug":"_2025-10-21-spring的-transactional注解","link":"#_2025-10-21-spring的-transactional注解","children":[{"level":3,"title":"主要作用","slug":"主要作用","link":"#主要作用","children":[]},{"level":3,"title":"常用属性","slug":"常用属性","link":"#常用属性","children":[]},{"level":3,"title":"使用位置","slug":"使用位置","link":"#使用位置","children":[]},{"level":3,"title":"注意事项","slug":"注意事项","link":"#注意事项","children":[]}]},{"level":2,"title":"2025/10/21 - 分页表格跨页选择数据丢失问题","slug":"_2025-10-21-分页表格跨页选择数据丢失问题","link":"#_2025-10-21-分页表格跨页选择数据丢失问题","children":[{"level":3,"title":"问题","slug":"问题-1","link":"#问题-1","children":[]},{"level":3,"title":"问题","slug":"问题-2","link":"#问题-2","children":[]},{"level":3,"title":"解决方案","slug":"解决方案","link":"#解决方案","children":[]},{"level":3,"title":"完整示例","slug":"完整示例","link":"#完整示例","children":[]},{"level":3,"title":"关键要点","slug":"关键要点","link":"#关键要点","children":[]},{"level":3,"title":"适用场景","slug":"适用场景","link":"#适用场景","children":[]}]},{"level":2,"title":"Spring 异步方法不生效问题排查笔记","slug":"spring-异步方法不生效问题排查笔记","link":"#spring-异步方法不生效问题排查笔记","children":[{"level":3,"title":"问题","slug":"问题-3","link":"#问题-3","children":[]},{"level":3,"title":"原因","slug":"原因-1","link":"#原因-1","children":[]},{"level":3,"title":"解决方案","slug":"解决方案-1","link":"#解决方案-1","children":[]},{"level":3,"title":"异步方法写法","slug":"异步方法写法","link":"#异步方法写法","children":[]}]},{"level":2,"title":"2025/11/03 - Knife4j 文档页面空白问题排查与解决","slug":"_2025-11-03-knife4j-文档页面空白问题排查与解决","link":"#_2025-11-03-knife4j-文档页面空白问题排查与解决","children":[{"level":3,"title":"问题","slug":"问题-4","link":"#问题-4","children":[]},{"level":3,"title":"原因","slug":"原因-2","link":"#原因-2","children":[]},{"level":3,"title":"解决方案","slug":"解决方案-2","link":"#解决方案-2","children":[]},{"level":3,"title":"经验总结","slug":"经验总结","link":"#经验总结","children":[]}]}],"git":{"createdTime":1761057960000,"updatedTime":1763719065000,"contributors":[{"name":"echo0d","email":"echo0d@163.com","commits":3}]},"readingTime":{"minutes":7.77,"words":2332},"filePathRelative":"develop/DailyDev.md","localizedDate":"2025年10月21日","excerpt":"","autoDesc":true}');export{i as comp,r as data};
