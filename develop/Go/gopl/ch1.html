<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.27" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="alternate" type="application/atom+xml" href="https://echo0d.github.io/DailyNotes/atom.xml" title="echo0d'notes Atom Feed"><link rel="alternate" type="application/json" href="https://echo0d.github.io/DailyNotes/feed.json" title="echo0d'notes JSON Feed"><link rel="alternate" type="application/rss+xml" href="https://echo0d.github.io/DailyNotes/rss.xml" title="echo0d'notes RSS Feed"><title>01. 入门 | echo0d'notes</title><meta name="description" content="echo0d'notes-vuepress">
    <link rel="preload" href="/DailyNotes/assets/style-Ck379rO9.css" as="style"><link rel="stylesheet" href="/DailyNotes/assets/style-Ck379rO9.css">
    <link rel="modulepreload" href="/DailyNotes/assets/app-KRcqTjW-.js"><link rel="modulepreload" href="/DailyNotes/assets/ch1.html-CPyjfnQ9.js"><link rel="modulepreload" href="/DailyNotes/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/DailyNotes/assets/index.html-CcpsarIu.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-G6D8Gais.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/DailySkills.html-DN-l7P_8.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/Treasure.html-By-u4Hi-.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1-FileSystem.html-bhnCK6Be.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2-commandExecute.html-CC621kwb.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/3-Database.html-B2nv1Hbs.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/4-JNDI.html-Dpop6OnM.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/5-reflection.html-EZpOZwM7.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/6-ClassLoader.html-CKqm6o_k.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/7-DynamicProxy.html-CjUg7ClW.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1-JavaEE.html-CTIfVq5b.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2-JavaMVC.html-Cr0HynAS.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/3-JavaWeb_Servlet.html-ByikYynE.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/4-JavaWeb_filter.html-D9EYdfYr.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/5-JavaWeb_Listener.html-C0RL9jVt.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/6-CookieAndSession.html-Cy0vwG-P.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/7-JSP.html-DAK1dAK5.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/JavaVul.html-CNHQGJdY.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/deserialize.html-C0YzTbzc.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/GoVul.html-BjA0-FAM.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1-CTF_WEB.html-D2hZ26Tr.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-BfoVILs5.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ExecuteAssembly.html-B2Iuvjqd.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/RDI.html-DIWvPKwc.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-BQU65N3Q.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-x3M7VsvU.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1_syntax.html-ay8xUIVX.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2_VariableTypes.html-T_CisXjI.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CgfVR546.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CuBDzVRT.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-t7AO3VIe.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/React_Typescript_antd.html-DJ9gsPmi.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1_JavaBase.html-C32S6z05.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2_ObjectOriented.html-tRgVwVOB.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/3_CoreClass.html-BJdfRcdA.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/4_Exception.html-D076agvz.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/5_Reflection.html-wqcJyf52.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/6_Annotation.html-BNBpB4W2.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/7_Genericity.html-C5iz-R6m.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-Dzzg-x_3.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/test_django.html-BgPryxcD.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-ByI-Ce24.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1_InformationGathering.html-BvcYrGL3.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2_Intranet_windows.html-aM9k-8PQ.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/3_CDN.html-CN1WpLrv.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1_LinuxPersistence.html-Bm-cyyLy.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2_WindowsPersistence.html-CUTluXNt.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/3_ProcessInjection.html-C5idKUNn.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1_Linux.html-F4OVGDqy.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2_Windows.html-YvltPsVY.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/Intranet_tunnel.html-BGSbLFLY.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/Tamper.html-Ct2OW0DX.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/TracesRemoval.html-C2NUiZr0.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/Burpsuite.html-DzZHBj7u.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/SQLmap.html-BNJwD2_o.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/Tunnel.html-CCEeJFI8.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/WebShell.html-DidX69oz.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/openwrt.html-C8eY5NF4.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/1_GoFinal.html-BdTw5izn.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/2_fscanPro.html-CMGDULI2.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-DYZ-Clh_.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-PhqeFptg.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch10.html-BYRIWO2L.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch11.html-C567WNQ7.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch12.html-BWiZGtN4.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch2.html-DR6LpJ7-.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch3.html-o47jZXDu.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch4.html-C1tuMLL5.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch5.html-DsQtd8Fx.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch6.html-B6Uhbpuf.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/ch7.html-i21iVczS.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/node_CVE-2017-14849.html-CsOS3PQx.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/tomcat_CVE-2017-12615.html-xgoBg_iO.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/tomcat_CVE-2020-1938.html-BrxPB05e.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/weblogic_CVE-2017-10271.html-CG52uK1k.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/weblogic_CVE-2018-2894.html-oxi-up0T.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/weblogic_CVE-2020-14882.html-tJBjsXIv.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/FastjsonVul.html-BfbAELHY.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/log4j2 .html-BtakjR4L.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/shiro.html-rD8lh7ex.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/反序列化_shiro_CVE-2019-12422_shiro721反序列化命令执行漏洞.html-cuAa7sj_.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/权限绕过_shiro_CVE-2020-11989_Apache Shiro782权限绕过漏洞.html-CHLair4d.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/权限绕过_shiro_CVE-2020-13933_Apache Shiro权限绕过漏洞.html-DhxEu8BC.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/spring.html-LbdmEu8G.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/spring_CVE-2018-1273_bypass.html-CPdx-bz_.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/supervisor_CVE-2017-11610.html-ChX0nSzG.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/xstream_CVE-2021-21351.html-BmYFgLUw.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/C3.html-BsAZzVCg.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/CS.html-B7Uz-LDA.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/MSFUse.html-Cb_R53Eo.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/MSF_CS.html-C0U194hg.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/404.html-BVciyaB8.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-BHVZkGh-.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-qW8ofQf3.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CyF7L21d.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-DFgl7tF_.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CUvY7NeJ.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-BBklR3YM.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CRoycvHw.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-DkS0B9wF.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-BPn61CvQ.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-DCZ2EgrN.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-vQKaDa1a.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CuDyRHhO.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-C3NwjJ-8.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CDTw0u52.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-unhTtuts.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CPJr4aSo.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-B1ReSTce.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-BCk4yVsa.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-1sNSQXlB.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-Bd5HuGnx.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CLI9c8JP.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-BGP8w5mK.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-Bs1NH02r.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CkYWWJev.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-DvelNRRI.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/index.html-CriBNEOn.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/DailyNotes/assets/SearchResult-B9nwPMoP.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/DailyNotes/"><img class="vp-nav-logo" src="/DailyNotes/logo.jpg" alt><!----><span class="vp-site-name hide-in-pad">echo0d&#39;notes</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/DailyNotes/CyberSecurity/" aria-label="网络安全"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>网络安全<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/DailyNotes/CodeAudittutorial/" aria-label="代码审计"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>代码审计<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link active" href="/DailyNotes/develop/" aria-label="开发技术"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>开发技术<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/DailyNotes/others/" aria-label="其他随笔"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>其他随笔<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/echo0d/DailyNotes" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable active"><!----><a class="route-link nav-link active vp-sidebar-title" href="/DailyNotes/develop/" aria-label="开发技术"><!---->开发技术<!----></a><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">C 语言</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">C++笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Go</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Go语言圣经</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/DailyNotes/develop/Go/gopl/" aria-label="Go语言圣经"><!---->Go语言圣经<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/DailyNotes/develop/Go/gopl/ch1.html" aria-label="01. 入门"><!---->01. 入门<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/DailyNotes/develop/Go/gopl/ch2.html" aria-label="02. 程序结构"><!---->02. 程序结构<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/DailyNotes/develop/Go/gopl/ch3.html" aria-label="03. 基础数据类型"><!---->03. 基础数据类型<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/DailyNotes/develop/Go/gopl/ch4.html" aria-label="04. 复合数据类型"><!---->04. 复合数据类型<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/DailyNotes/develop/Go/gopl/ch5.html" aria-label="05. 函数"><!---->05. 函数<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/DailyNotes/develop/Go/gopl/ch6.html" aria-label="06. 方法"><!---->06. 方法<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/DailyNotes/develop/Go/gopl/ch7.html" aria-label="07. 接口"><!---->07. 接口<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/DailyNotes/develop/Go/gopl/ch10.html" aria-label="10. 包和工具"><!---->10. 包和工具<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/DailyNotes/develop/Go/gopl/ch11.html" aria-label="11. 测试"><!---->11. 测试<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/DailyNotes/develop/Go/gopl/ch12.html" aria-label="12. 反射"><!---->12. 反射<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Go语言精进</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Python</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Rust</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">前端</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->01. 入门</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">echo0d</span></span><span property="author" content="echo0d"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-07-31T08:52:23.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 33 分钟</span><meta property="timeRequired" content="PT33M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/DailyNotes/#_1-1-hello-world">1.1. Hello, World</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#goproxy设置">GOPROXY设置</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#hello-world">Hello, World</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#package-import">package/import</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/DailyNotes/#_1-2-命令行参数">1.2. 命令行参数</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#切片">切片</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#s-i">s+=  i++</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#for循环">for循环</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#空标识符">空标识符</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#声明-初始化">声明&amp;初始化</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#strings-包的-join-函数">strings 包的 Join 函数</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#练习1-1-1-2">练习1.1&amp;1.2</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#练习-1-3">练习 1.3</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/DailyNotes/#_1-3-查找重复的行">1.3. 查找重复的行</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#if语句">if语句</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#map">map</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#bufio-包">bufio 包</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#fmt-printf">fmt.Printf</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#os-open">os.open</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#readfile">ReadFile</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#练习-1-4">练习 1.4</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/DailyNotes/#_1-4-gif动画">1.4. GIF动画</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#常量">常量</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#复合声明">复合声明</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#踩坑">踩坑</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#练习-1-5">练习 1.5</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#练习1-6">练习1.6</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/DailyNotes/#_1-5-获取url">1.5. 获取URL</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#net-http">net/http</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#练习-1-7">练习 1.7</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#练习-1-8">练习 1.8</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#练习-1-9">练习 1.9</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/DailyNotes/#_1-6-并发获取多个url">1.6. 并发获取多个URL</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#goroutine">goroutine</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#make">make</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#ioutil-discard">ioutil.Discard</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#分两个函数的原因">分两个函数的原因</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#练习-1-10">练习 1.10</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/DailyNotes/#_1-7-web服务">1.7. Web服务</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#handler">handler</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#handler-count">handler&amp;count</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#竞态条件">竞态条件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#if嵌套parseform">if嵌套ParseForm()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#标准输出流">标准输出流</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#接口">接口</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#练习-1-12">练习 1.12</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/DailyNotes/#_1-8-本章要点">1.8. 本章要点</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#控制流">控制流</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#命名类型">命名类型</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#指针">指针</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#方法和接口">方法和接口</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#包-packages">包（packages）</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/DailyNotes/#注释">注释</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="_01-入门" tabindex="-1"><a class="header-anchor" href="#_01-入门"><span>01. 入门</span></a></h1><h2 id="_1-1-hello-world" tabindex="-1"><a class="header-anchor" href="#_1-1-hello-world"><span>1.1. Hello, World</span></a></h2><h3 id="goproxy设置" tabindex="-1"><a class="header-anchor" href="#goproxy设置"><span>GOPROXY设置</span></a></h3><p>windows下载安装包，直接默认安装。此处版本go1.15.15</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>PS C:\Users\echo0d\Desktop\gopl.io-master\ch1\helloworld&gt; go env
set GO111MODULE=on
set GOARCH=amd64                                  
set GOBIN=                                        
set GOCACHE=C:\Users\echo0d\AppData\Local\go-build
set GOENV=C:\Users\echo0d\AppData\Roaming\go\env  
set GOEXE=.exe                                    
set GOFLAGS=
set GOHOSTARCH=amd64
set GOHOSTOS=windows
set GOINSECURE=
set GOMODCACHE=C:\Users\echo0d\go\pkg\mod
set GONOPROXY=
set GONOSUMDB=
set GOOS=windows
set GOPATH=C:\Users\echo0d\go
set GOPRIVATE=
set GOPROXY=https://proxy.golang.org,direct
set GOROOT=C:\Program Files\Go
set GOSUMDB=sum.golang.org
set GOTMPDIR=
set GOTOOLDIR=C:\Program Files\Go\pkg\tool\windows_amd64
set GCCGO=gccgo
set AR=ar
set GOMOD=C:\Users\echo0d\Desktop\gopl.io-master\go.mod
set CGO_CFLAGS=-g -O2
set CGO_CPPFLAGS=
set CGO_CXXFLAGS=-g -O2
set CGO_FFLAGS=-g -O2
set CGO_LDFLAGS=-g -O2
set PKG_CONFIG=pkg-config
set GOGCCFLAGS=-m64 -mthreads -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=C:\Users\echo0d\AppData\Local\Temp\go-build967739482=/tmp/go-build -gno-record-gcc-switches
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编译程序会报错</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>PS C:\Users\echo0d\Desktop\gopl.io-master\ch1\helloworld&gt; go run main.go
go: golang.org/x/net@v0.0.0-20210929193557-e81a3d93ecf6: Get &quot;https://proxy.golang.org/golang.org/x/net/@v/v0.0.0-20210929193557-e81a3d93ecf6.mod&quot;: dial tcp [2404:6800:4003:c04::8d]:443: connectex: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>原因：从 <code>Go 1.11</code> 版本开始，官方支持了 <code>go module</code> 包依赖管理工具。还新增了 <code>GOPROXY</code> 环境变量。</p><p>如果设置了该变量，下载源代码时将会通过这个环境变量设置的代理地址，而不再是以前的直接从代码库下载。也就是这个变量</p><div class="language-cmd line-numbers-mode" data-ext="cmd" data-title="cmd"><pre class="language-cmd"><code>go env -w GO111MODULE=on
go env -w GOPROXY=https://goproxy.cn,direct
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>powershell执行，https://goproxy.io这个项目看起来非常不错</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token comment"># 启用 Go Modules 功能</span>
<span class="token variable">$env</span>:GO111MODULE=<span class="token string">&quot;on&quot;</span>
<span class="token comment"># 配置 GOPROXY 环境变量</span>
<span class="token variable">$env</span>:GOPROXY=<span class="token string">&quot;https://goproxy.io&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>cmd执行</p><div class="language-cmd line-numbers-mode" data-ext="cmd" data-title="cmd"><pre class="language-cmd"><code>set GOPROXY=https://proxy.golang.org,direct
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果使用的 Go 版本&gt;=1.13, 你可以通过设置 GOPRIVATE 环境变量来控制哪些私有仓库和依赖(公司内部仓库)不通过 proxy 来拉取，直接走本地，设置如下：</p><div class="language-powershell line-numbers-mode" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="token comment"># 配置 GOPROXY 环境变量</span>
<span class="token variable">$env</span>:GOPROXY = <span class="token string">&quot;https://goproxy.io,direct&quot;</span>
<span class="token comment"># 设置不走 proxy 的私有仓库或组，多个用逗号相隔（可选）</span>
<span class="token variable">$env</span>:GOPRIVATE = <span class="token string">&quot;git.mycompany.com,github.com/my/private&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>除此之外还有</p><p>七牛云：https://goproxy.cn</p><p>aliyun：https://mirrors.aliyun.com/goproxy/</p><blockquote><p>后面感觉go1.15版本有点低，改成 go1.21.8</p></blockquote><h3 id="hello-world" tabindex="-1"><a class="header-anchor" href="#hello-world"><span>Hello, World</span></a></h3><p>初始化，新建一个文件夹，例如ch2</p><div class="language-cmd line-numbers-mode" data-ext="cmd" data-title="cmd"><pre class="language-cmd"><code>cd ch2
go mod init ch2
# 生成一个go.mod文件，内容如下
module ch2
go 1.22.1

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例代码<em>gopl.io/ch1/helloworld</em></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, 世界&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Go语言的函数名首字母一定要大写，上面如果写成fmt.println就不对</p></blockquote><figure><img src="/DailyNotes/assets/image-20240313224312928-BJ38JWm7.png" alt="image-20240313224312928" tabindex="0" loading="lazy"><figcaption>image-20240313224312928</figcaption></figure><p>Go是一门编译型语言，Go语言提供的工具都通过一个单独的命令<code>go</code>调用，<code>go</code>命令有一系列子命令。最简单的一个子命令就是run。这个命令编译一个或多个以.go结尾的源文件，链接库文件，并运行最终生成的可执行文件。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>$ go run helloworld.go
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这个命令会输出：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>Hello, 世界
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Go语言原生支持Unicode，它可以处理全世界任何语言的文本。</p><p>单独编译这个程序，保存编译结果以备将来之用。可以用build子命令：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>$ go build helloworld.go
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这个命令生成一个名为helloworld的可执行的二进制文件，Windows系统下生成的可执行文件是helloworld.exe，增加了.exe后缀名</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>.\helloworld.exe
Hello, 世界
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="package-import" tabindex="-1"><a class="header-anchor" href="#package-import"><span>package/import</span></a></h3><ul><li>Go代码结构</li></ul><p>Go语言的代码通过<code>包（package）</code>组织，包类似于其它语言里的库（libraries）或者模块（modules）。一个包由位于<code>单个目录</code>下的一个或多个.go源代码文件组成</p><blockquote><p>也就是说，一个文件夹下的go文件应该属于同一个包</p></blockquote><p><code>main</code>包比较特殊。它定义了一个独立可执行的程序，而不是一个库。在<code>main</code>里的<code>main</code> 函数也很特殊，它是整个程序执行时的入口（译注：C系语言差不多都这样）。</p><p>每个源文件都以一条<code>package</code>声明语句开始，例子里的<code>package main</code>，表示该文件属于哪个包，紧跟着一系列导入（<code>import</code>）的包，<strong><code>import</code> 声明必须跟在文件的 <code>package</code> 声明之后</strong>。</p><blockquote><p>⚠️ 必须恰当导入需要的包，<strong>缺少了必要的包或者导入了不需要的包，程序都无法编译通过</strong>。这项严格要求避免了程序开发过程中引入未使用的包❗</p></blockquote><p>之后是这个文件里的其他程序语句，是组成程序的函数、变量、常量、类型的声明语句（分别由关键字 <code>func</code>、<code>var</code>、<code>const</code>、<code>type</code> 定义）。</p><ul><li><p>Go 语言不需要在语句或者声明的末尾添加分号，除非一行上有多条语句。编译器会主动把特定符号后的换行符转换为分号</p><p>例子，函数的左括号 <code>{</code> 必须和 <code>func</code> 函数声明在同一行上，且位于末尾，不能独占一行，而在表达式 <code>x+y</code> 中，可在 <code>+</code> 后换行，不能在 <code>+</code> 前换行（译注：以+结尾的话不会被插入分号分隔符，但是以 x 结尾的话则会被分号分隔符，从而导致编译错误）。</p></li><li><p>Go 语言在代码格式上采取了很强硬的态度。<code>gofmt</code>工具把代码格式化为标准格式</p><p>很多文本编辑器都可以配置为保存文件时自动执行 <code>gofmt</code>，这样你的源代码总会被恰当地格式化。还有个相关的工具：<code>goimports</code>，可以根据代码需要，自动地添加或删除 <code>import</code> 声明。这个工具并没有包含在标准的分发包中，可以用下面的命令安装：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>go <span class="token function">install</span> golang.org/x/tools/cmd/goimports@latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h2 id="_1-2-命令行参数" tabindex="-1"><a class="header-anchor" href="#_1-2-命令行参数"><span>1.2. 命令行参数</span></a></h2><p>示例代码</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> s<span class="token punctuation">,</span> sep <span class="token builtin">string</span>
	<span class="token comment">// var 声明定义了两个 string 类型的变量 s 和 sep。变量会在声明时直接初始化。</span>
	<span class="token comment">// 如果变量没有显式初始化，则被隐式地赋予其类型的零值，数值类型是0，字符串类型是空字符串&quot;&quot;</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		s <span class="token operator">+=</span> sep <span class="token operator">+</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
		<span class="token comment">// 对 string 类型，+ 运算符连接字符串</span>
		<span class="token comment">// 等价于：s=s+sep+os.Args[i]。</span>
		sep <span class="token operator">=</span> <span class="token string">&quot; &quot;</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="切片" tabindex="-1"><a class="header-anchor" href="#切片"><span>切片</span></a></h3><ul><li><p>程序的命令行参数可从 <code>os</code> 包的 <code>Args</code> 变量获取；<code>os</code> 包外部使用 <code>os.Args</code> 访问该变量。<code>os.Args</code> 变量是一个字符串（string）的<code>切片（slice）</code>。</p></li><li><p><code>os.Args</code> 的第一个元素：<code>os.Args[0]</code>，是命令本身的名字；其它的元素则是程序启动时传给它的参数。</p></li><li><p><code>s[m:n]</code> 形式的切片表达式，产生从第 <code>m</code> 个元素到第 <code>n-1</code> 个元素的切片，如果省略切片表达式的索引，会默认传入 <code>0</code> 或 <code>len(s)</code>。（区间索引时，Go 语言里也采用左闭右开形式）<code>os.Args[1:len(os.Args)]</code> 切片，可以简写成 <code>os.Args[1:]</code></p></li></ul><blockquote><p>注释语句以 <code>//</code> 开头。</p></blockquote><h3 id="s-i" tabindex="-1"><a class="header-anchor" href="#s-i"><span>s+= i++</span></a></h3><p>上面<code>s += sep + os.Args[i]</code>等价于：<code>s=s+sep+os.Args[i]</code>。看起来和其他语言一样的，但是</p><blockquote><p>自增语句 <code>i++</code> 给 <code>i</code> 加 <code>1</code>；这和 <code>i+=1</code> 以及 <code>i=i+1</code> 都是等价的。对应的还有 <code>i--</code> 给 <code>i</code> 减 <code>1</code>。它们是语句，而不像 C 系的其它语言那样是表达式。所以 <code>j=i++</code> 非法，而且 <code>++</code> 和 <code>--</code> 都只能放在变量名后面，因此 <code>--i</code> 也非法。</p></blockquote><h3 id="for循环" tabindex="-1"><a class="header-anchor" href="#for循环"><span>for循环</span></a></h3><p>Go 语言只有 <code>for</code> 循环这一种循环语句。<code>for</code> 循环有多种形式，</p><p><strong>for循环1</strong></p><p>其中一种如下所示：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">for</span> initialization<span class="token punctuation">;</span> condition<span class="token punctuation">;</span> post <span class="token punctuation">{</span>
    <span class="token comment">// zero or more statements</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>for</code> 循环三个部分不需括号包围。大括号强制要求，左大括号必须和 <em><code>post</code></em> 语句在同一行。</p><ul><li><code>initialization</code> 语句是可选的，在循环开始前执行。<code>initalization</code>如果存在，必须是一条 <em>简单语句</em>（simple statement），即，短变量声明、自增语句、赋值语句或函数调用。</li><li><code>condition</code> 是一个布尔表达式（boolean expression），其值在每次循环迭代开始时计算。如果为 <code>true</code> 则执行循环体语句。</li><li><code>post</code> 语句在循环体执行结束后执行，之后再次对 <code>condition</code> 求值。<code>condition</code> 值为 <code>false</code> 时，循环结束。</li></ul><p>for 循环的这三个部分<strong>每个都可以省略</strong>，如果省略 <code>initialization</code> 和 <code>post</code>，分号也可以省略：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// a traditional &quot;while&quot; loop</span>
<span class="token keyword">for</span> condition <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果连 <code>condition</code> 也省略了，像下面这样：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// a traditional infinite loop</span>
<span class="token keyword">for</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这就变成一个无限循环，尽管如此，还可以用其他方式终止循环，如一条 <code>break</code> 或 <code>return</code> 语句。</p><p><strong>for循环2</strong></p><p>在某种数据类型的区间（range）上遍历，如字符串或切片。例如</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// Echo2 prints its command-line arguments.</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    s<span class="token punctuation">,</span> sep <span class="token operator">:=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> arg <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        s <span class="token operator">+=</span> sep <span class="token operator">+</span> arg
        sep <span class="token operator">=</span> <span class="token string">&quot; &quot;</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="空标识符" tabindex="-1"><a class="header-anchor" href="#空标识符"><span>空标识符</span></a></h3><p>上面for循环2中，每次循环迭代，<code>range</code> 产生一对值（索引以及在该索引处的元素值）。这个例子不需要索引，一种思路是把索引赋值给一个临时变量（如 <code>temp</code>）然后忽略它的值，但 Go 语言不允许使用无用的局部变量（local variables），因为这会导致编译错误。</p><p>Go 语言中这种情况的解决方法是用 <code>空标识符（blank identifier）</code>，即 <code>_</code>（下划线）。空标识符可用于在任何语法需要变量名但程序逻辑不需要的时候。</p><h3 id="声明-初始化" tabindex="-1"><a class="header-anchor" href="#声明-初始化"><span>声明&amp;初始化</span></a></h3><p>使用一条短变量声明来声明并初始化 <code>s</code> 和 <code>seps</code></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>s<span class="token punctuation">,</span> sep <span class="token operator">:=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>声明一个变量有好几种方式，下面这些都等价：实践中一般使用前两种形式中的某个，初始值重要的话就显式地指定变量的值，否则指定类型使用隐式初始化。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>s <span class="token operator">:=</span> <span class="token string">&quot;&quot;</span>
<span class="token keyword">var</span> s <span class="token builtin">string</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
<span class="token keyword">var</span> s <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第一种形式，是一条短变量声明，最简洁，但只能用在函数内部，而不能用于包变量。</p><p>第二种形式依赖于字符串的默认初始化零值机制，被初始化为 <code>&quot;&quot;</code>。</p><p>第三种形式用得很少，除非同时声明多个变量。</p><p>第四种形式显式地标明变量的类型，当变量类型与初值类型相同时，类型冗余，但如果两者类型不同，变量类型就必须了。</p><h3 id="strings-包的-join-函数" tabindex="-1"><a class="header-anchor" href="#strings-包的-join-函数"><span><code>strings</code> 包的 <code>Join</code> 函数</span></a></h3><p><em>gopl.io/ch1/echo3</em></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后，如果不关心输出格式，只想看看输出值，或许只是为了调试，可以用 <code>Println</code> 为我们格式化输出。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这条语句的输出结果跟 <code>strings.Join</code> 得到的结果很像，只是被放到了一对方括号里。切片都会被打印成这种格式。</p><figure><img src="/DailyNotes/assets/image-20240313224440655-BSXk0q2U.png" alt="image-20240313224440655" tabindex="0" loading="lazy"><figcaption>image-20240313224440655</figcaption></figure><h3 id="练习1-1-1-2" tabindex="-1"><a class="header-anchor" href="#练习1-1-1-2"><span>练习1.1&amp;1.2</span></a></h3><p>修改 <code>echo</code> 程序，使其打印每个参数的索引和值，每个一行。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// 练习 1.1： 修改 echo 程序，使其能够打印 os.Args[0]，即被执行命令本身的名字。</span>
<span class="token comment">// 练习 1.2： 修改 echo 程序，使其打印每个参数的索引和值，每个一行。</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	s<span class="token punctuation">,</span> sep <span class="token operator">:=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> arg <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		s <span class="token operator">+=</span> sep <span class="token operator">+</span> arg
		sep <span class="token operator">=</span> <span class="token string">&quot; &quot;</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;只输出值&quot;</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;输出值和索引1：index, arg := range os.Args[1:]&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> index<span class="token punctuation">,</span> arg <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;参数&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> <span class="token string">&quot;是&quot;</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;输出值和索引2：index, arg := range os.Args&quot;</span><span class="token punctuation">)</span>
	<span class="token comment">// 练习 1.1： 修改 echo 程序，使其能够打印 os.Args[0]，即被执行命令本身的名字。</span>
	<span class="token comment">// Args[0:]的[0:]可以省略</span>
	<span class="token comment">// for index, arg := range os.Args {</span>
	<span class="token keyword">for</span> index<span class="token punctuation">,</span> arg <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;参数&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> <span class="token string">&quot;是&quot;</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/DailyNotes/assets/image-20240313230441488-BDIEdgNx.png" alt="image-20240313230441488" tabindex="0" loading="lazy"><figcaption>image-20240313230441488</figcaption></figure><h3 id="练习-1-3" tabindex="-1"><a class="header-anchor" href="#练习-1-3"><span>练习 1.3</span></a></h3><p>做实验测量潜在低效的版本和使用了 <code>strings.Join</code> 的版本的运行时间差异。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;os&quot;</span>
	<span class="token string">&quot;strings&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// !+</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	now1 <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	s<span class="token punctuation">,</span> sep <span class="token operator">:=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> arg <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		s <span class="token operator">+=</span> sep <span class="token operator">+</span> arg
		sep <span class="token operator">=</span> <span class="token string">&quot; &quot;</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
	end1 <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;for range运行时间&quot;</span><span class="token punctuation">,</span> end1<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>now1<span class="token punctuation">)</span><span class="token punctuation">)</span>
	now2 <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	end2 <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;strings.Join运行时间&quot;</span><span class="token punctuation">,</span> end2<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>now2<span class="token punctuation">)</span><span class="token punctuation">)</span>
	now3 <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	end3 <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Println(os.Args[1:])运行时间&quot;</span><span class="token punctuation">,</span> end3<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>now3<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/DailyNotes/assets/image-20240313231229410-DU8G3jqI.png" alt="image-20240313231229410" tabindex="0" loading="lazy"><figcaption>image-20240313231229410</figcaption></figure><h2 id="_1-3-查找重复的行" tabindex="-1"><a class="header-anchor" href="#_1-3-查找重复的行"><span>1.3. 查找重复的行</span></a></h2><p>例</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;bufio&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	counts <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token comment">// 键是字符串，值是整数</span>
	input <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewScanner</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdin<span class="token punctuation">)</span>
	<span class="token keyword">for</span> input<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		counts<span class="token punctuation">[</span>input<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">++</span>
		<span class="token comment">// line := input.Text()</span>
		<span class="token comment">// counts[line] = counts[line] + 1</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// NOTE: ignoring potential errors from input.Err()</span>
	<span class="token keyword">for</span> line<span class="token punctuation">,</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> counts <span class="token punctuation">{</span>
		<span class="token comment">// if 语句条件两边也不加括号。if 语句的 else 部分是可选的</span>
		<span class="token keyword">if</span> n <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\t%s\n&quot;</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> line<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/DailyNotes/assets/image-20240318212619313-D-Qx9jJI.png" alt="image-20240318212619313" tabindex="0" loading="lazy"><figcaption>image-20240318212619313</figcaption></figure><h3 id="if语句" tabindex="-1"><a class="header-anchor" href="#if语句"><span>if语句</span></a></h3><p>正如 <code>for</code> 循环一样，<code>if</code> 语句条件两边也不加括号，但是主体部分需要加。<code>if</code> 语句的 <code>else</code> 部分是可选的，在 <code>if</code> 的条件为 <code>false</code> 时执行。</p><h3 id="map" tabindex="-1"><a class="header-anchor" href="#map"><span>map</span></a></h3><p><strong>map</strong> 存储了键/值（key/value）的集合，对集合元素，提供常数时间的存、取或测试操作。键可以是任意类型，只要其值能用 <code>==</code> 运算符比较，最常见的例子是字符串；值则可以是任意类型。</p><p>从功能和实现上说，<code>Go</code> 的 <code>map</code> 类似于 <code>Java</code> 语言中的 <code>HashMap</code>，Python 语言中的 <code>dict</code>，<code>Lua</code> 语言中的 <code>table</code>，通常使用 <code>hash</code> 实现。</p><p>每次 <code>dup</code> 读取一行输入，该行被当做键存入 <code>map</code>，其对应的值递增。<code>counts[input.Text()]++</code> 语句等价下面两句：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>line <span class="token operator">:=</span> input<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
counts<span class="token punctuation">[</span>line<span class="token punctuation">]</span> <span class="token operator">=</span> counts<span class="token punctuation">[</span>line<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>map</code> 中不含某个键（首次读到新行时），等号右边的表达式 <code>counts[line]</code> 的值将被计算为其类型的零值，对于 <code>int</code> 即 <code>0</code>。</p><p>我们使用了基于 <code>range</code> 的循环，并在 <code>counts</code> 这个 <code>map</code> 上迭代。跟之前类似，每次迭代得到两个结果，键和其在 <code>map</code> 中对应的值。<code>map</code> 的迭代顺序并不确定，从实践来看，该顺序随机，每次运行都会变化。</p><h3 id="bufio-包" tabindex="-1"><a class="header-anchor" href="#bufio-包"><span><code>bufio</code> 包</span></a></h3><p><code>bufio</code> 包，它使处理输入和输出方便又高效。<code>Scanner</code> 类型是该包最有用的特性之一，它读取输入并将其拆成行或单词；通常是处理行形式的输入最简单的方法。</p><p>程序使用短变量声明创建 <code>bufio.Scanner</code> 类型的变量 <code>input</code>。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>input <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewScanner</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdin<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>该变量从程序的标准输入中读取内容。每次调用 <code>input.Scan()</code>，即读入下一行，并移除行末的换行符；读取的内容可以调用 <code>input.Text()</code> 得到。<code>Scan</code> 函数在读到一行时返回 <code>true</code>，不再有输入时返回 <code>false</code>。</p><h3 id="fmt-printf" tabindex="-1"><a class="header-anchor" href="#fmt-printf"><span><code>fmt.Printf</code></span></a></h3><p>对一些表达式产生格式化输出。该函数的首个参数是个格式字符串，指定后续参数被如何格式化，默认情况下，<code>Printf</code> 不会换行。</p><ul><li><p>关于 Printf 格式化输出:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>%d          十进制整数
%x, %o, %b  十六进制，八进制，二进制整数。
%f, %g, %e  浮点数： 3.141593 3.141592653589793 3.141593e+00
%t          布尔：true或false
%c          字符(rune)  (Unicode码点)
%s          字符串
%q          带双引号的字符串&quot;abc&quot;或带单引号的字符&#39;c&#39;
%v          变量的自然形式(natural format) 
%T          变量的类型
%%          字面上的百分号标志(无操作数) 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>按照惯例，以字母 <code>f</code> 结尾的格式化函数，如 <code>log.Printf</code> 和 <code>fmt.Errorf</code>，都采用 <code>fmt.Printf</code> 的格式化准则。而以 <code>ln</code> 结尾的格式化函数，则遵循 <code>Println</code> 的方式，以跟 <code>%v</code> 差不多的方式格式化参数，并在最后添加一个换行符。（译注：后缀 <code>f</code> 指 <code>format</code>，<code>ln</code> 指 <code>line</code>。）</p><h3 id="os-open" tabindex="-1"><a class="header-anchor" href="#os-open"><span><code>os.open</code></span></a></h3><p>例</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;bufio&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	counts <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>
	files <span class="token operator">:=</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		<span class="token function">countLines</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdin<span class="token punctuation">,</span> counts<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> arg <span class="token operator">:=</span> <span class="token keyword">range</span> files <span class="token punctuation">{</span>
			f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;dup2: %v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
				<span class="token keyword">continue</span>
			<span class="token punctuation">}</span>
			<span class="token function">countLines</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> counts<span class="token punctuation">)</span>
			f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> line<span class="token punctuation">,</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> counts <span class="token punctuation">{</span>
		<span class="token keyword">if</span> n <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\t%s\n&quot;</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> line<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">countLines</span><span class="token punctuation">(</span>f <span class="token operator">*</span>os<span class="token punctuation">.</span>File<span class="token punctuation">,</span> counts <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	input <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewScanner</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
	<span class="token keyword">for</span> input<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		counts<span class="token punctuation">[</span>input<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">++</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// NOTE: ignoring potential errors from input.Err()</span>
<span class="token punctuation">}</span>

<span class="token comment">//!-</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/DailyNotes/assets/image-20240318221904249-yZ9r74Sq.png" alt="image-20240318221904249" tabindex="0" loading="lazy"><figcaption>image-20240318221904249</figcaption></figure><p><code>os.Open</code> 函数返回两个值：</p><p>第一个值是被打开的文件（<code>*os.File</code>），其后被 <code>Scanner</code> 读取。</p><p>第二个值是内置 <code>error</code> 类型的值。</p><ul><li>如果 <code>err</code> 等于内置值<code>nil</code>（其它语言里的 <code>NULL</code>），那么文件被成功打开。读取文件，直到文件结束，然后调用 <code>Close</code> 关闭该文件，并释放占用的所有资源。</li><li>如果 <code>err</code> 的值不是 <code>nil</code>，说明打开文件时出错了。这种情况下，错误值描述了所遇到的问题。使用 <code>Fprintf</code> 与表示任意类型默认格式值的动词 <code>%v</code>，向标准错误流打印一条信息，然后 <code>dup</code> 继续处理下一个文件；<code>continue</code> 语句直接跳到 <code>for</code> 循环的下个迭代开始执行。</li></ul><p>注意 <code>countLines</code> 函数在其声明前被调用。</p><blockquote><p>函数和包级别的变量（package-level entities）可以任意顺序声明，并不影响其被调用。</p></blockquote><h3 id="readfile" tabindex="-1"><a class="header-anchor" href="#readfile"><span><code>ReadFile</code></span></a></h3><p><code>dup</code> 的前两个版本以&quot;流”模式读取输入，并根据需要拆分成多个行。理论上，这些程序可以处理任意数量的输入数据。还有另一个方法，就是一口气把全部输入数据读到内存中，一次分割为多行，然后处理它们。</p><p>引入了 <code>ReadFile</code> 函数（来自于<code>io/ioutil</code>包）。但是由于这个包已经在 Go 1.16 之后弃用，下面直接写成了 <code>os.ReadFile</code>。</p><p><code>os.ReadFile</code>读取指定文件的全部内容，<code>strings.Split</code> 函数把字符串分割成子串的切片。（<code>Split</code> 的作用与前文提到的 <code>strings.Join</code> 相反。）</p><blockquote><p>下面代码有修正，由于windows中的换行默认使用的是<code>\r\n</code>，所以不能只靠\n分割</p></blockquote><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Dup3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	counts <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> filename <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		<span class="token comment">// ReadFile 函数返回一个字节切片（byte slice），必须把它转换为 string，才能用 strings.Split 分割</span>
		data<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;dup3: %v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			<span class="token keyword">continue</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// ReadFile 函数读取指定文件的全部内容，strings.Split 函数把字符串分割成子串的切片。</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> line <span class="token operator">:=</span> <span class="token keyword">range</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			counts<span class="token punctuation">[</span>line<span class="token punctuation">]</span><span class="token operator">++</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> line<span class="token punctuation">,</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> counts <span class="token punctuation">{</span>
		<span class="token keyword">if</span> n <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\t%s\r\n&quot;</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> line<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>ReadFile</code> 函数返回一个字节切片（byte slice），必须把它转换为 <code>string</code>，才能用 <code>strings.Split</code> 分割。我们会在3.5.4 节详细讲解字符串和字节切片。</p><p>实现上，<code>bufio.Scanner</code>、<code>ioutil.ReadFile</code> 和 <code>ioutil.WriteFile</code> 都使用 <code>*os.File</code> 的 <code>Read</code> 和 <code>Write</code> 方法，但是，大多数程序员很少需要直接调用那些低级（lower-level）函数。高级（higher-level）函数，像 <code>bufio</code> 和 <code>io/ioutil</code> 包中所提供的那些，用起来要容易点。</p><h3 id="练习-1-4" tabindex="-1"><a class="header-anchor" href="#练习-1-4"><span>练习 1.4</span></a></h3><p>修改 <code>dup2</code>，出现重复的行时打印文件名称。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;bufio&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	counts <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>
	<span class="token comment">// 用于记录文件名的hash表,每一行对应的文件名存到一个数组中</span>
	fileHash <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span>
	<span class="token comment">// 获取命令行参数</span>
	files <span class="token operator">:=</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
	<span class="token comment">// 如果为空，则在控制台上输入</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;随便填,输入0终止\r\n&quot;</span><span class="token punctuation">)</span>
		<span class="token function">newcountlines</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdin<span class="token punctuation">,</span> counts<span class="token punctuation">,</span> fileHash<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment">// 不为空，遍历文件列表</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;你输入的文件是:&quot;</span><span class="token punctuation">,</span> files<span class="token punctuation">)</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> file <span class="token operator">:=</span> <span class="token keyword">range</span> files <span class="token punctuation">{</span>
			<span class="token comment">// 打开文件</span>
			f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
			<span class="token comment">// 判断文件路径等是否出错</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
				<span class="token keyword">continue</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 传入contlines进行处理</span>
			<span class="token function">newcountlines</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> counts<span class="token punctuation">,</span> fileHash<span class="token punctuation">)</span>
			f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> k<span class="token punctuation">,</span> count <span class="token operator">:=</span> <span class="token keyword">range</span> counts <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> count<span class="token punctuation">)</span>
		<span class="token comment">// 打印出现的文件</span>
		<span class="token keyword">if</span> count <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> fname <span class="token operator">:=</span> <span class="token keyword">range</span> fileHash<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token punctuation">{</span>
				fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s &quot;</span><span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">newcountlines</span><span class="token punctuation">(</span>f <span class="token operator">*</span>os<span class="token punctuation">.</span>File<span class="token punctuation">,</span> counts <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> fileHash <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 创建读入流</span>
	input <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewScanner</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
	<span class="token comment">// 一行一行读取</span>
	<span class="token keyword">for</span> input<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> input<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">{</span>
			<span class="token keyword">break</span>
		<span class="token punctuation">}</span>
		counts<span class="token punctuation">[</span>input<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">++</span>
		<span class="token comment">// 按照每行内容，将文件名加到[]string{value}里</span>
		fileHash<span class="token punctuation">[</span>input<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>fileHash<span class="token punctuation">[</span>input<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/DailyNotes/assets/image-20240318231747959-BiIMUdVX.png" alt="image-20240318231747959" tabindex="0" loading="lazy"><figcaption>image-20240318231747959</figcaption></figure><h2 id="_1-4-gif动画" tabindex="-1"><a class="header-anchor" href="#_1-4-gif动画"><span>1.4. GIF动画</span></a></h2><p>例</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> lissajous

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;image&quot;</span>
	<span class="token string">&quot;image/color&quot;</span>
	<span class="token string">&quot;image/gif&quot;</span>
	<span class="token string">&quot;io&quot;</span>
	<span class="token string">&quot;math&quot;</span>
	<span class="token string">&quot;math/rand&quot;</span>
	<span class="token string">&quot;os&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> palette <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>color<span class="token punctuation">.</span>Color<span class="token punctuation">{</span>color<span class="token punctuation">.</span>White<span class="token punctuation">,</span> color<span class="token punctuation">.</span>Black<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
	whiteIndex <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// first color in palette</span>
	blackIndex <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// next color in palette</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">Lissajous</span><span class="token punctuation">(</span>out io<span class="token punctuation">.</span>Writer<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// out 这个变量是 io.Writer 类型，这个类型支持把输出结果写到很多目标</span>
	<span class="token keyword">const</span> <span class="token punctuation">(</span>
		cycles  <span class="token operator">=</span> <span class="token number">5</span>     <span class="token comment">// number of complete x oscillator revolutions</span>
		res     <span class="token operator">=</span> <span class="token number">0.001</span> <span class="token comment">// angular resolution</span>
		size    <span class="token operator">=</span> <span class="token number">100</span>   <span class="token comment">// image canvas covers [-size..+size]</span>
		nframes <span class="token operator">=</span> <span class="token number">64</span>    <span class="token comment">// number of animation frames</span>
		delay   <span class="token operator">=</span> <span class="token number">8</span>     <span class="token comment">// delay between frames in 10ms units</span>
	<span class="token punctuation">)</span>

	freq <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">Float64</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3.0</span> <span class="token comment">// relative frequency of y oscillator</span>
	anim <span class="token operator">:=</span> gif<span class="token punctuation">.</span>GIF<span class="token punctuation">{</span>LoopCount<span class="token punctuation">:</span> nframes<span class="token punctuation">}</span>
	phase <span class="token operator">:=</span> <span class="token number">0.0</span> <span class="token comment">// phase difference</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nframes<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		rect <span class="token operator">:=</span> image<span class="token punctuation">.</span><span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
		img <span class="token operator">:=</span> image<span class="token punctuation">.</span><span class="token function">NewPaletted</span><span class="token punctuation">(</span>rect<span class="token punctuation">,</span> palette<span class="token punctuation">)</span>
		<span class="token keyword">for</span> t <span class="token operator">:=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> cycles<span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span>math<span class="token punctuation">.</span>Pi<span class="token punctuation">;</span> t <span class="token operator">+=</span> res <span class="token punctuation">{</span>
			x <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
			y <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>t<span class="token operator">*</span>freq <span class="token operator">+</span> phase<span class="token punctuation">)</span>
            <span class="token comment">// 每一步它都会调用 SetColorIndex 来为(x,y)点来染黑色。</span>
			img<span class="token punctuation">.</span><span class="token function">SetColorIndex</span><span class="token punctuation">(</span>size<span class="token operator">+</span><span class="token function">int</span><span class="token punctuation">(</span>x<span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">+</span><span class="token function">int</span><span class="token punctuation">(</span>y<span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				blackIndex<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		phase <span class="token operator">+=</span> <span class="token number">0.1</span>
		anim<span class="token punctuation">.</span>Delay <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>anim<span class="token punctuation">.</span>Delay<span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
		anim<span class="token punctuation">.</span>Image <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>anim<span class="token punctuation">.</span>Image<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	gif<span class="token punctuation">.</span><span class="token function">EncodeAll</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token operator">&amp;</span>anim<span class="token punctuation">)</span> <span class="token comment">// NOTE: ignoring encoding errors</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">LissajousMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UTC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token function">Lissajous</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当我们import了一个包路径包含有多个单词的package时，比如image/color（image和color两个单词），后面调用的时候，只写最后那个单词就可以。所以当我们写color.White时，这个变量指向的是image/color包里的变量。</p><h3 id="常量" tabindex="-1"><a class="header-anchor" href="#常量"><span>常量</span></a></h3><p>常量是指在程序编译后运行时始终都不会变化的值。</p><p>常量声明和变量声明一般都会出现在包级别，所以这些常量在整个包中都是可以共享的，或者你也可以把常量声明定义在函数体内部，那么这种常量就只能在函数体内用。</p><p>常量声明的值必须是一个<strong>数字值</strong>、<strong>字符串</strong>或者<strong>固定的boolean值</strong>。</p><h3 id="复合声明" tabindex="-1"><a class="header-anchor" href="#复合声明"><span>复合声明</span></a></h3><p><code>[]color.Color{...}</code> 和 <code>gif.GIF{...}</code> 这两个表达式是复合声明(4.2 和 4.4.1 节有说明) 。这是实例化 Go 语言里的复合类型的一种写法。</p><p>前者生成的是一个 slice 切片，后者生成的是一个 struct 结构体。</p><blockquote><p>后面再看吧</p></blockquote><h3 id="踩坑" tabindex="-1"><a class="header-anchor" href="#踩坑"><span>踩坑</span></a></h3><p>powershell 重定向管道 <code>go run main.go &gt; out.gif</code> 生成的 gif 图片将会出错无法打开。</p><p>powershell 的标准输出流如果进行管道重定向会进行转换。参考<a href="https://stackoverflow.com/questions/56323293/go-generated-animated-gifs-didnt-work-in-windows" target="_blank" rel="noopener noreferrer">image - Go-generated animated GIFs didn&#39;t work in windows - Stack Overflow<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>下面使用cmd运行，结果：</p><figure><img src="/DailyNotes/assets/image-20240319162930634-C01E2-6P.png" alt="image-20240319162930634" tabindex="0" loading="lazy"><figcaption>image-20240319162930634</figcaption></figure><h3 id="练习-1-5" tabindex="-1"><a class="header-anchor" href="#练习-1-5"><span>练习 1.5</span></a></h3><p>修改前面的Lissajous程序里的调色板，由黑色改为绿色。我们可以用<code>color.RGBA{0xRR, 0xGG, 0xBB, 0xff}</code>来得到<code>#RRGGBB</code>这个色值，三个十六进制的字符串分别代表红、绿、蓝像素。改成这样就行了</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> palette <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>color<span class="token punctuation">.</span>Color<span class="token punctuation">{</span>color<span class="token punctuation">.</span>White<span class="token punctuation">,</span> color<span class="token punctuation">.</span>RGBA<span class="token punctuation">{</span><span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="练习1-6" tabindex="-1"><a class="header-anchor" href="#练习1-6"><span>练习1.6</span></a></h3><p>修改Lissajous程序，修改其调色板来生成更丰富的颜色，然后修改SetColorIndex的第三个参数，</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> lissajousPractice

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;image&quot;</span>
	<span class="token string">&quot;image/color&quot;</span>
	<span class="token string">&quot;image/gif&quot;</span>
	<span class="token string">&quot;io&quot;</span>
	<span class="token string">&quot;math&quot;</span>
	<span class="token string">&quot;math/rand&quot;</span>
	<span class="token string">&quot;os&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// 练习1.5 调色板由黑色变成绿色</span>
<span class="token comment">// var palette = []color.Color{color.White, color.RGBA{0x00, 0xff, 0x00, 0xff}}</span>

<span class="token comment">// 练习1.6 颜色增多</span>
<span class="token keyword">var</span> palette <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>color<span class="token punctuation">.</span>Color<span class="token punctuation">{</span>color<span class="token punctuation">.</span>White<span class="token punctuation">,</span> color<span class="token punctuation">.</span>Black<span class="token punctuation">,</span> color<span class="token punctuation">.</span>RGBA<span class="token punctuation">{</span><span class="token number">0xff</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">}</span><span class="token punctuation">,</span> color<span class="token punctuation">.</span>RGBA<span class="token punctuation">{</span><span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">}</span><span class="token punctuation">,</span> color<span class="token punctuation">.</span>RGBA<span class="token punctuation">{</span><span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Lissajousemain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// The sequence of images is deterministic unless we seed</span>
	<span class="token comment">// the pseudo-random number generator using the current time.</span>
	<span class="token comment">// Thanks to Randall McPherson for pointing out the omission.</span>
	rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UTC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token function">Lissajous</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Lissajous</span><span class="token punctuation">(</span>out io<span class="token punctuation">.</span>Writer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">(</span>
		cycles  <span class="token operator">=</span> <span class="token number">5</span>     <span class="token comment">// number of complete x oscillator revolutions</span>
		res     <span class="token operator">=</span> <span class="token number">0.001</span> <span class="token comment">// angular resolution</span>
		size    <span class="token operator">=</span> <span class="token number">100</span>   <span class="token comment">// image canvas covers [-size..+size]</span>
		nframes <span class="token operator">=</span> <span class="token number">64</span>    <span class="token comment">// number of animation frames</span>
		delay   <span class="token operator">=</span> <span class="token number">8</span>     <span class="token comment">// delay between frames in 10ms units</span>
	<span class="token punctuation">)</span>
	colorIndex <span class="token operator">:=</span> <span class="token function">uint8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	freq <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">Float64</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3.0</span> <span class="token comment">// relative frequency of y oscillator</span>
	anim <span class="token operator">:=</span> gif<span class="token punctuation">.</span>GIF<span class="token punctuation">{</span>LoopCount<span class="token punctuation">:</span> nframes<span class="token punctuation">}</span>
	phase <span class="token operator">:=</span> <span class="token number">0.0</span> <span class="token comment">// phase difference</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nframes<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		rect <span class="token operator">:=</span> image<span class="token punctuation">.</span><span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
		img <span class="token operator">:=</span> image<span class="token punctuation">.</span><span class="token function">NewPaletted</span><span class="token punctuation">(</span>rect<span class="token punctuation">,</span> palette<span class="token punctuation">)</span>
		<span class="token keyword">for</span> t <span class="token operator">:=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> cycles<span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span>math<span class="token punctuation">.</span>Pi<span class="token punctuation">;</span> t <span class="token operator">+=</span> res <span class="token punctuation">{</span>
			x <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
			y <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>t<span class="token operator">*</span>freq <span class="token operator">+</span> phase<span class="token punctuation">)</span>
			img<span class="token punctuation">.</span><span class="token function">SetColorIndex</span><span class="token punctuation">(</span>size<span class="token operator">+</span><span class="token function">int</span><span class="token punctuation">(</span>x<span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">+</span><span class="token function">int</span><span class="token punctuation">(</span>y<span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> colorIndex<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		colorIndex <span class="token operator">=</span> <span class="token punctuation">(</span>colorIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token function">uint8</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>palette<span class="token punctuation">)</span><span class="token punctuation">)</span>
		phase <span class="token operator">+=</span> <span class="token number">0.1</span>
		anim<span class="token punctuation">.</span>Delay <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>anim<span class="token punctuation">.</span>Delay<span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
		anim<span class="token punctuation">.</span>Image <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>anim<span class="token punctuation">.</span>Image<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	gif<span class="token punctuation">.</span><span class="token function">EncodeAll</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token operator">&amp;</span>anim<span class="token punctuation">)</span> <span class="token comment">// NOTE: ignoring encoding errors</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-5-获取url" tabindex="-1"><a class="header-anchor" href="#_1-5-获取url"><span>1.5. 获取URL</span></a></h2><h3 id="net-http" tabindex="-1"><a class="header-anchor" href="#net-http"><span>net/http</span></a></h3><p>这个程序将获取对应的url，并将其源文本打印出来；类似curl工具</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// Fetch prints the content found at a URL.</span>
<span class="token keyword">package</span> fetch

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;io&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>
	<span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">Fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> url <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;fetch: %v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		b<span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
		resp<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;fetch: reading %s: %v\n&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>http.Get函数是创建HTTP请求的函数，如果获取过程没有出错，那么会在resp这个结构体中得到访问的请求结果。resp的Body字段包括一个可读的服务器响应流。</li><li>io.ReadAll函数从response中读取到全部内容；将其结果保存在变量b中。</li><li>resp.Body.Close关闭resp的Body流，防止资源泄露</li><li>Printf函数会将结果b写出到标准输出流中。</li></ul><figure><img src="/DailyNotes/assets/image-20240319174745213-qj2Kt8Vx.png" alt="image-20240319174745213" tabindex="0" loading="lazy"><figcaption>image-20240319174745213</figcaption></figure><p>错误输出如图：</p><figure><img src="/DailyNotes/assets/image-20240319175205976-Ni3OR1Pb.png" alt="image-20240319175205976" tabindex="0" loading="lazy"><figcaption>image-20240319175205976</figcaption></figure><p>无论哪种失败原因，我们的程序都用了os.Exit函数来终止进程，并且返回一个status错误码，其值为1。</p><h3 id="练习-1-7" tabindex="-1"><a class="header-anchor" href="#练习-1-7"><span>练习 1.7</span></a></h3><p>函数调用io.Copy(dst, src)会从src中读取内容，并将读到的结果写入到dst中，使用这个函数替代掉例子中的ioutil.ReadAll来拷贝响应结构体到os.Stdout，避免申请一个缓冲区（例子中的b）来存储。记得处理io.Copy返回结果中的错误。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">IoCopy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> url <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;fetch: %v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
		resp<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;fetch: reading %s: %v\n&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="练习-1-8" tabindex="-1"><a class="header-anchor" href="#练习-1-8"><span>练习 1.8</span></a></h3><p>修改fetch这个范例，如果输入的url参数没有 <code>http://</code> 前缀的话，为这个url加上该前缀。你可能会用到strings.HasPrefix这个函数。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">HasPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> url <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token comment">// 加个判断</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">&quot;https://&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//这里必须Fprint，允许输入的不是字符串</span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprint</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;前缀不对哦&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;fetch: %v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
		resp<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;fetch: reading %s: %v\n&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="练习-1-9" tabindex="-1"><a class="header-anchor" href="#练习-1-9"><span>练习 1.9</span></a></h3><p>修改fetch打印出HTTP协议的状态码，可以从resp.Status变量得到该状态码。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">RespStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> url <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;fetch: %v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
		resp<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;fetch: reading %s: %v\n&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;状态码：%d&quot;</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span>StatusCode<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-6-并发获取多个url" tabindex="-1"><a class="header-anchor" href="#_1-6-并发获取多个url"><span>1.6. 并发获取多个URL</span></a></h2><p>例子</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> fetchall

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;io&quot;</span>
	<span class="token string">&quot;io/ioutil&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>
	<span class="token string">&quot;os&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">Fetching</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> url <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		<span class="token keyword">go</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> ch<span class="token punctuation">)</span> <span class="token comment">// start a goroutine</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span> <span class="token comment">// receive from channel ch</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%.2fs elapsed\n&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url <span class="token builtin">string</span><span class="token punctuation">,</span> ch <span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		ch <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Sprint</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// send to channel ch</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	nbytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>ioutil<span class="token punctuation">.</span>Discard<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
	resp<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// don&#39;t leak resources</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		ch <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;while reading %s: %v&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	secs <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ch <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%.2fs  %7d  %s&quot;</span><span class="token punctuation">,</span> secs<span class="token punctuation">,</span> nbytes<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/DailyNotes/assets/image-20240319215948498-BQ8-A63W.png" alt="image-20240319215948498" tabindex="0" loading="lazy"><figcaption>image-20240319215948498</figcaption></figure><h3 id="goroutine" tabindex="-1"><a class="header-anchor" href="#goroutine"><span>goroutine</span></a></h3><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>    ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> url <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">go</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> ch<span class="token punctuation">)</span> <span class="token comment">// start a goroutine</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span> <span class="token comment">// receive from channel ch</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>goroutine</code>是一种函数的并发执行方式，而<code>channel</code>是用来在<code>goroutine</code>之间进行参数传递。</p><p>上面的<code>Fetching</code>函数本身也运行在一个<code>goroutine</code>中，而<code>go function</code>则表示创建一个新的<code>goroutine</code>（也就是上面2-4行，把函数<code>fetch</code>放在<code>goroutine</code>中），并在这个新的<code>goroutine</code>中执行这个函数。</p><h3 id="make" tabindex="-1"><a class="header-anchor" href="#make"><span>make</span></a></h3><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>make</code>函数创建了一个传递<code>string</code>类型参数的<code>channel</code>，也就是<code>ch chan&lt;- string</code>，对每一个命令行参数，我们都用<code>go</code>这个关键字来创建一个<code>goroutine</code>，并且让函数在这个<code>goroutine</code>异步执行<code>http.Get</code>方法。</p><h3 id="ioutil-discard" tabindex="-1"><a class="header-anchor" href="#ioutil-discard"><span>ioutil.Discard</span></a></h3><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>nbytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>ioutil<span class="token punctuation">.</span>Discard<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这个程序里的<code>io.Copy</code>会把响应的Body内容拷贝到<code>ioutil.Discard</code>输出流中（译注：可以把这个变量看作一个垃圾桶，可以向里面写一些不需要的数据），因为我们需要这个方法返回的字节数，但是又不想要其内容。</p><p>每当请求返回内容时，<code>fetch</code>函数都会往<code>ch</code>这个<code>channel</code>里写入一个字符串，由<code>Fetching</code>函数里的第二个for循环来处理并打印<code>channel</code>里的这个字符串。</p><h3 id="分两个函数的原因" tabindex="-1"><a class="header-anchor" href="#分两个函数的原因"><span>分两个函数的原因</span></a></h3><p>当一个<code>goroutine</code>尝试在一个<code>channel</code>上做<code>send</code>或者<code>receive</code>操作时，这个<code>goroutine</code>会阻塞在调用处，直到另一个<code>goroutine</code>从这个<code>channel</code>里接收或者写入值，这样两个<code>goroutine</code>才会继续执行<code>channel</code>操作之后的逻辑。在这个例子中，每一个fetch函数在执行时都会往channel里发送一个值（ch &lt;- expression），<code>Fetching</code>函数负责接收这些值（&lt;-ch）。这个程序中我们用<code>Fetching</code>函数来完整地处理/接收所有<code>fetch</code>函数传回的字符串，可以避免因为有两个<code>goroutine</code>同时完成而使得其输出交错在一起的危险。</p><h3 id="练习-1-10" tabindex="-1"><a class="header-anchor" href="#练习-1-10"><span>练习 1.10</span></a></h3><p>修改本节中的程序，将响应结果输出到文件，以便于进行对比。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;io&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>
	<span class="token string">&quot;os&quot;</span>
	<span class="token string">&quot;strings&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> url <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		<span class="token keyword">go</span> <span class="token function">saveFile</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> ch<span class="token punctuation">)</span> <span class="token comment">// start a goroutine</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span> <span class="token comment">// receive from channel ch</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;total %.2fs elapsed\n&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">saveFile</span><span class="token punctuation">(</span>url <span class="token builtin">string</span><span class="token punctuation">,</span> ch <span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token comment">// 这里必须fmt.Sprintf</span>
		ch <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Sprint</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// send to channel ch</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//拿到域名做文件名</span>
	domain <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">&quot;//&quot;</span><span class="token punctuation">)</span>
	<span class="token comment">// 创建文件</span>
	outFile<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>domain<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;.txt&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		ch <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Sprint</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	nbytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>outFile<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
	<span class="token comment">// resp.Body.Close()</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		ch <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;while reading %s: %v&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	secs <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	ch <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%.2fs  %7d  %s&quot;</span><span class="token punctuation">,</span> secs<span class="token punctuation">,</span> nbytes<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-7-web服务" tabindex="-1"><a class="header-anchor" href="#_1-7-web服务"><span>1.7. Web服务</span></a></h2><p>例子，一个服务器，返回当前用户正在访问的URL。比如用户访问的是 http://localhost:8000/hello ，那么响应是URL.Path = &quot;hello&quot;。</p><figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYsAAABMCAIAAAATGAxkAAAODUlEQVR4nO2dbWhb9RfHT5JmW9f+u0YNbhdXOh+yNFLywmB12WipHahgTWHd3Is9FmmF0XSKpi8EfSM0Mrb03SZmzorWvwHTdciG1q1d7cbw+hAGWRqw+2+F29KAmcJal6f7f3EfepPcJDc3t821O58Xo/nld88597L75Zxzf/cXzdLSEiDFQNM0868Q4XiZ40OQNURFuQP4l0GLodfrKyoqtBzljhFB1g6oUEXAS1IqlWL+2LBhw/r168sdF4KsWVChpCKUp1QqpdfrKysrNRpNueNCkLUMKpQkMuRp3bp1lZWV5Q4KQdY+qFCFyZCnysrKdevWlTsoBHkowLauJHiF0uv1KE8IsmqgQhVAmEDpdLqNGzeWOyIEeYhQsso7f/7866+/rqBB6VAU5fV6f/jhB5Ika2trn332WavV2tXV1dDQAABNTU03btyQbZwXqaqqKtlGZmZmrl27Njc3Nzc3BwBbtmzZsmWL3W7ftm2bbJsIsubRKLJiMx6PHz169PHHHz9x4kTp1orlww8/HB4e3rdv36uvvlpXV1ddXX316tXx8XG/379v376PPvpo48aN8k4zozu+YcMGGUYSicT58+d/+umntra2bdu21dXVAcCdO3dmZmbGxsaam5vb29srKrAhiCAiKKBQi4uLDoejtbW1v79fkZikk0wmDx069Nhjj504cSL7Jp+fn9+zZ09dXZ3f75etUCmOmpoaGWsLksmk2+2uqak5cODApk2bMr69d+/e0NDQ/fv333vvPZ1OJyNCBFnblNqHikQiL7300htvvLH68gQAvb29TzzxhMfjEc1BNm/ePDY2pogjrVYrb+nThQsXqqqqjh07li1PAFBbW9vb21tVVfXdd98VbzvkadH0jMgIKq+tkR5NiyekjNVMqNEBF4uXFBseGKWWh0lvEZP5LwdGKaBGB9KOKRwVO5v0ilkVh/QW4UN6CFlOJAe0NilJoe7evdvS0vL2228fPXpUqYCkc/Pmze+///6DDz4Q/Xb79u2VlZUGg8Hv98tb9p3xXosMC7dv356cnDxy5Ihw0O/3nzt3Tjhy6NChK1eu3LlzR4YLdSKucqR3cMrY6Xa73W6nPeLj7jzBcKdxapC9UanRAV/E7pQ2mfdwcQosNmKlT4+JbyxsstpWw9XDjXyFCgQCra2tg4ODnZ2dCgYknU8++eTNN9/MtXJyenp6iePevXulOKJpWl6f6OrVq01NTTU1NcLB5557bseOHcKRTZs2NTU1TU5OlhKk+qGoCHD3NGGzGKIRCgCADIQN9leYYdsrdkM4QAIARQajprZ2AgCAaG8zRYMklXMyBxkIc8es+MmQQeACQVYSmQo1OTn52muvffHFF21tbcoGJJ1ffvll9+7dq+NL3vvA8/PzTz31VMagTqd75JFHMgaffvrp+fl5mcExjPRoeIS1X8jTwg2zeY1gZq56bvkgoakcLpaHWzwhCHlaNB1nYOJ4A/OZ9LJVGmGzGMJjTC5EkcEoo1ZkIGxYTnsIm8UQDpCC7wEAwGZlJEp8MgcZSM9q+CpRWCflKDRFEMzMqrQoMggWG5FenfFnCpmVoyvLJTU64PKOjg6IFat569iHDpkKtX///kgk0traWimB7du3Kxs0w/T0dGNjo8TJGWmLdJjdVBRUqF9//fX69esZg08++WRJCjXSo+kInbrFlKS3ToU6WOkJeVoaRhzsuN/BzL0Efnage+K4R6SRNXHcA6cZS81nOlgtyuVipIcfvtVXD2DuG6f93dB86hZNj/eZBWaJ9n6nJTjocrlcg5E2d5eyGUhm2RX2BaxMNWiKTg2xwjg6MBi0OPlCM7dGUaMDfDmZXVDy1aRQJMlAGID7QEUYhSW9Lq5YTS9XASAchINut7s/LesThuhui0yFlbk6/15kKtTw8LDRaLx8+fKSBKanp5UNmkGj0fz9999SZi4sLIRCK9T8zQezJYuUmTqdrpSXkEcunWk+dZqTA3NfX/fEyKUQwIjnOCyPO/r6zADgOH3awQ683A2h/2VfGN6Wua+Pm5HLBQDABHtxzQ6HOcuYrcvNihHpdQ3BQebeswYK5jDFkVV2mTq7lqtBpqIUlo5AtLeZ0ovEdGtR3kBWQSmoJgmbxRChKACgqIjJbmc/cOkcGQgb7Ac5CRKUqwAAYhVpWohg6+o0yboaawiZCrVr164LFy4cOHBAqYdlMqivr79586aUmb///vszzzwjzwsjHKlUSsaxW7dunZ2dlTLz7t27zDopWYT+FwJzvUAczObmiVAoe5ydzpdwHWdKdQHgOE37oSNfychAjY6F0++9HPpgMIp2koyE2DA3mSu78kJFohD28SWXLwyMnojOTAuDIIzLc9OqSYIwRoMkBRQZNFrbbRZgq1GT1ca03tLiJoxc+y13iDnO/2FFfqfcarVevnzZ6XT6fD4FA5LO7t27v/nmGykzf/vtt127dpXiS97OmdIVanZ2tgSFMtebs3KhZrNZdDzkaWkI9dFcmVeqCwAAcDAloWOkofh1Cun3LEUGo0aCSFcEJhUxErkmg9SHeITRYOAqLob+HH11MSVhXWVWk0yPjCSDRqsNCJsFgiRJRRiZyTgNAMgpwOKOKSpS4JzWPCWtNqirqxsfHz958uTZs2eVCkg63d3dX3755e3bt/NPu3///meffbZ3717ZjjQaTTKZlHHgzp07r1+/nrFYtKamJuPJ4OLi4o0bN2R3ygDA8XL3xPEeTh1Cnp7j4HjZnDk+4vGEIBSa4JVl5JLkHCqni5CHGxTJ1gCW+8fCRjkA6fUx9znR3mYKcw0h8uIU2yC3vWKH5e7RGNsgzzFZ6kM8wmbhjRacaQj7BD1wH6dK2Q/xbFZTNDgWNFptrIvgGJ/P2azLTTAAanSokJAShBEEV+niVLRwsGubUl+2MBqNP/74o8PhWFhYWOVFm/X19YcPH37nnXeGh4fzrHhyOp2NjY3PP/98sfY1Gg1N00yVF4vFZGxpYDQaX3zxxXPnzr311lv8YHNzc8a0Tz/91G63G43GYu0v4zhN+3s0DZrjjItTt9gedfp4t58GR98pTwM70N0tOYfK6cJcDw0C+6xb1knzqVvjOzkDRHu/EwYGXVMAAGCwO/vZPlGXkxoYdLl8AGDq5BroRHt/Z8TFzDbYnVyyIzqZDIRN1i4J5yA0CmnuRGY6gXMkmEiRQbAcTNcYm9Xk80EbGzdhjE5F7Da+mnWD1yU86QJCmnaAqbPTFC5bG0UdKPleHkEQbre7dGvSSSQSe/funZ2d/fbbb7du3ZrxbTQa7e3t/fPPP7/66ivRJd0FEb71Is9CKpX6+OOPq6urRd96+euvv4aGhhYXF999913c4Fwm1OjACjwaFIf0usaMBVUGURDd+++/r4AVna6jo2N+ft5qtZZuTTparbazs/Off/7p6emZmZl58ODB5s2bl5aWrl275vP5ent79+zZc/LkSXlv/GYgb92mRqN54YUX5ubmPv/881QqFYvFqqqqlpaW/vjjj59//vns2bONjY2HDx/Gl/JkQ13xB+r27N3+n1XwRV78b2LHsWbUp1VEmRyq7CwsLHi93q+//jocDgOAxWLZv3//kSNHHn300RItl55GMeDuKwgigzWiUCuHcAMWrVZbXV1d7ogQ5CECex8F4F/z0Gq1yWQSBR1BVhNUKEnwIhWLxWKxWLnDQZCHBdzasTD8+yjM47alpaVkMom/RoUgqwAqlCQyRCoej9M0jb/oiSArDXbKi0C4px3zw+h6vX79+vW4VgBBVgjMoYpAmDFptVqaphOJRDweBwC9Xq/T6XQ6Hf4mAoIoCN5OxcGIFPNCDAMAMFKVSCT4j2WOEkHWCqhQRcNnUoxOASdJKE8IojgiCoV3WrHwiVW5A0GQtUamQjGLp5PJpLAfXJbIEARBlhWK0aN4PJ5MJtdxYF6AIEgZYRWK6fU+ePCgoqKi9LdtEQRBFKECOHmKxWK1tbX4sBxBEPWgBQCapuPxuFarRXlCEERVaGmaTiaTqVTKYDCUOxgEQZA0tACQSCRkbMKNIAiy0miZtQWoUAiCqBAtAKBCIQiiTthOOf7QCIIgKkTLv/6KIAiiNtgcqtxhIAiCiIDFHYIg6gUVCkEQ9YIKhSCIekGFQhBEvaBCLZN/I7rybkRTFu+4Mx9Sdgq8Ksz/76RpOtf/VOZRoHCmRJsS54sevsrPH/kNf4vyLnpNpF+obO+lk997Wa4tguShQA4lug+38A9euaTvHSx6eB5KVDSJMCpQUAuK8i661qy8C9Dye89QUikXBEFWFKzyWPIobHnv0nJ5x+3qETUgf0MoGdVKsTaFv6qS7ahgSZKdnSkeaonlW7bB/IfzTvkEB7KuFX+4cHLBqLDZhKgT+QpVYgkgekdl/M3fe9lehI2hXDEookcSvWcHL9tLHlPZRXEe78xkKcFkHF5U5AiyopS0qWYpIiXaoAHJd4gUpyuXQ+VpM6sNLNOQfzXq2vY345FZiazyzYlagCCKU2qnPNfDOGELSaLcFEzHVj9JkZchKhWnqHdhEwo1EVnzFM6hhBokTHBEmxdSbs7sw7MdQVY/RdR7LlMrRy7v2VcJsi5Lnva/6OHSyeM9o01e0Dus7vVEkPxIqvKypSTPx/zH5p8vpeed62/FyZXC5PIu8Uwl9vULPgFYUe8IohJwPVROynvTomQgCKBCIQiiZlChEARRL6hQCIKoF1QoBEHUCyoUgiDqBRUKQRD1ggqFIIh6QYVCEES9oEIhCKJeUKEQBFEvqFAIgqgXVCgEQdQLKhSCIOoFFQpBEPXyf1/u3eolK9qBAAAAAElFTkSuQmCC" alt="image-20240320094224873" tabindex="0" loading="lazy"><figcaption>image-20240320094224873</figcaption></figure><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">HandlerMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span> <span class="token comment">// each request calls handler</span>
	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:8000&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">handler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;URL.Path = %q\n&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="handler" tabindex="-1"><a class="header-anchor" href="#handler"><span>handler</span></a></h3><p><code>HandlerMain</code>函数将所有发送到<code>/</code>路径下的请求和<code>handler</code>函数关联起来，<code>/</code>开头的请求其实就是所有发送到当前站点上的请求，服务监听8000端口。</p><p>发送到这个服务的“请求”是一个<code>http.Request</code>类型的对象，这个对象中包含了请求中的一系列相关字段，其中就包括我们需要的URL。</p><p>当请求到达服务器时，这个请求会被传给<code>handler</code>函数来处理，这个函数会将/hello这个路径从请求的URL中解析出来，然后把其发送到响应中，这里我们用的是标准输出流的<code>fmt.Fprintf</code>。</p><h3 id="handler-count" tabindex="-1"><a class="header-anchor" href="#handler-count"><span>handler&amp;count</span></a></h3><p>为访问的url添加某种状态。比如，下面这个版本输出了同样的内容，但是会对请求的次数进行计算，计算各种URL被访问的总次数，访问/count的时候显示出来。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> mu sync<span class="token punctuation">.</span>Mutex
<span class="token keyword">var</span> count <span class="token builtin">int</span>

<span class="token keyword">func</span> <span class="token function">CountHandlerMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> countHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/count&quot;</span><span class="token punctuation">,</span> counter<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:8000&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// handler echoes the Path component of the requested URL.</span>
<span class="token keyword">func</span> <span class="token function">countHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	count<span class="token operator">++</span>
	mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;URL.Path = %q\n&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// counter echoes the number of calls so far.</span>
<span class="token keyword">func</span> <span class="token function">counter</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;Count %d\n&quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>
	mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="data:image/png;base64,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" alt="image-20240320095635047" tabindex="0" loading="lazy"><figcaption>image-20240320095635047</figcaption></figure><p>这个服务器有两个请求处理函数，根据请求的url不同会调用不同的函数：对/count这个url的请求会调用到counter这个函数，其它的url都会调用默认的处理函数。</p><h3 id="竞态条件" tabindex="-1"><a class="header-anchor" href="#竞态条件"><span>竞态条件</span></a></h3><p>服务器每一次接收请求处理时都会另起一个goroutine，这样服务器就可以同一时间处理多个请求。然而在并发情况下，假如真的有两个请求同一时刻去更新count，那么这个值可能并不会被正确地增加；这个程序可能会引发一个严重的bug：竞态条件（参见9.1）。为了避免这个问题，我们必须保证每次修改变量的最多只能有一个goroutine，这也就是代码里的<code>mu.Lock()</code>和<code>mu.Unlock()</code>调用将修改count的所有行为包在中间的目的（第九章再看）。</p><h3 id="if嵌套parseform" tabindex="-1"><a class="header-anchor" href="#if嵌套parseform"><span>if嵌套ParseForm()</span></a></h3><p>handler函数会把请求的http头和请求的form数据都打印出来</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">HandlerMoreMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> handlerMore<span class="token punctuation">)</span> <span class="token comment">// each request calls handler</span>
	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:8000&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">handlerMore</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;%s %s %s\n&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>Method<span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Proto<span class="token punctuation">)</span>
	<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> r<span class="token punctuation">.</span>Header <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;Header[%q] = %q\n&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;Host = %q\n&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>Host<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;RemoteAddr = %q\n&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>RemoteAddr<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">ParseForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> r<span class="token punctuation">.</span>Form <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;Form[%q] = %q\n&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/DailyNotes/assets/image-20240320100747503-Sgy0FVv_.png" alt="image-20240320100747503" tabindex="0" loading="lazy"><figcaption>image-20240320100747503</figcaption></figure><p>这里的ParseForm被嵌套在了if语句中</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>	<span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">ParseForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Go语言允许这样的一个简单的语句结果作为局部的变量声明出现在if语句的最前面，这一点对错误处理很有用处。我们还可以像下面这样写（当然看起来就长了一些）：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">ParseForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用if和ParseForm结合可以让代码更加简单，并且可以限制err这个变量的作用域，这么做是很不错的。2.7节中讲解作用域。</p><hr><h3 id="标准输出流" tabindex="-1"><a class="header-anchor" href="#标准输出流"><span>标准输出流</span></a></h3><p>在这些程序中，我们看到了很多不同的类型被输出到标准输出流中。比如</p><ul><li>前面的fetch程序，把HTTP的响应数据拷贝到了os.Stdout，</li><li>lissajous程序里我们输出的是一个文件。</li><li>fetchall程序则计算了一下响应Body的大小，这个程序中把响应Body拷贝到了ioutil.Discard。</li><li>在本节的web服务器程序中则是用fmt.Fprintf直接写到了http.ResponseWriter中。</li></ul><p>尽管三种具体的实现流程并不太一样，他们都实现一个共同的接口，即当它们被调用需要一个标准流输出时都可以满足。这个接口叫作io.Writer，在7.1节中会详细讨论。</p><h3 id="接口" tabindex="-1"><a class="header-anchor" href="#接口"><span>接口</span></a></h3><p>Go语言的接口机制会在第7章中讲解，为了在这里简单说明接口能做什么，让我们简单地将这里的web服务器和之前写的lissajous函数结合起来，这样GIF动画可以被写到HTTP的客户端，而不是之前的标准输出流。只要在web服务器的代码里加入下面这几行。</p><div class="language-Go line-numbers-mode" data-ext="Go" data-title="Go"><pre class="language-Go"><code>handler := func(w http.ResponseWriter, r *http.Request) {
    lissajous(w)
}
http.HandleFunc(&quot;/&quot;, handler)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者另一种等价形式：</p><div class="language-Go line-numbers-mode" data-ext="Go" data-title="Go"><pre class="language-Go"><code>http.HandleFunc(&quot;/&quot;, func(w http.ResponseWriter, r *http.Request) {
    lissajous(w)
})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>HandleFunc函数的第二个参数是一个函数的字面值，也就是一个在使用时定义的匿名函数。这些内容我们会在5.6节中讲解。</p><p>效果：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;ch1/pkg/lissajous&quot;</span>

<span class="token keyword">func</span> <span class="token function">Handlerlissajous</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		lissajous<span class="token punctuation">.</span><span class="token function">Lissajous</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:8000&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/DailyNotes/assets/image-20240320103048561-vQhMZbfY.png" alt="image-20240320103048561" tabindex="0" loading="lazy"><figcaption>image-20240320103048561</figcaption></figure><h3 id="练习-1-12" tabindex="-1"><a class="header-anchor" href="#练习-1-12"><span>练习 1.12</span></a></h3><p>修改Lissajour服务，从URL读取变量，比如你可以访问 http://localhost:8000/?cycles=20 这个URL，这样访问可以将程序里的cycles默认的5修改为20。字符串转换为数字可以调用strconv.Atoi函数。</p><figure><img src="/DailyNotes/assets/image-20240320111440397-BfQxHxBZ.png" alt="image-20240320111440397" tabindex="0" loading="lazy"><figcaption>image-20240320111440397</figcaption></figure><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;image&quot;</span>
	<span class="token string">&quot;image/color&quot;</span>
	<span class="token string">&quot;image/gif&quot;</span>
	<span class="token string">&quot;io&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;math&quot;</span>
	<span class="token string">&quot;math/rand&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>
	<span class="token string">&quot;strconv&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	handler <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">ParseForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		cycles<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Form<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;cycles&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 字符串转int</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 函数里比较的时候有math.Pi，就要求cycles float64，直接用int不对strconv.Atoi的结果是不对的</span>
		<span class="token function">lissajousNew</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token function">float64</span><span class="token punctuation">(</span>cycles<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:8000&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">lissajousNew</span><span class="token punctuation">(</span>out io<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> cycles <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> palette <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>color<span class="token punctuation">.</span>Color<span class="token punctuation">{</span>color<span class="token punctuation">.</span>White<span class="token punctuation">,</span> color<span class="token punctuation">.</span>Black<span class="token punctuation">}</span>

	<span class="token keyword">const</span> <span class="token punctuation">(</span>
		whiteIndex <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// first color in palette</span>
		blackIndex <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// next color in palette</span>
		res        <span class="token operator">=</span> <span class="token number">0.001</span>
		size       <span class="token operator">=</span> <span class="token number">100</span>
		nframes    <span class="token operator">=</span> <span class="token number">64</span>
		delay      <span class="token operator">=</span> <span class="token number">8</span>
	<span class="token punctuation">)</span>

	freq <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">Float64</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3.0</span> <span class="token comment">// relative frequency of y oscillator</span>
	anim <span class="token operator">:=</span> gif<span class="token punctuation">.</span>GIF<span class="token punctuation">{</span>LoopCount<span class="token punctuation">:</span> nframes<span class="token punctuation">}</span>
	phase <span class="token operator">:=</span> <span class="token number">0.0</span> <span class="token comment">// phase difference</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nframes<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		rect <span class="token operator">:=</span> image<span class="token punctuation">.</span><span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
		img <span class="token operator">:=</span> image<span class="token punctuation">.</span><span class="token function">NewPaletted</span><span class="token punctuation">(</span>rect<span class="token punctuation">,</span> palette<span class="token punctuation">)</span>
		<span class="token comment">// 这里比较</span>
		<span class="token keyword">for</span> t <span class="token operator">:=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> cycles<span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span>math<span class="token punctuation">.</span>Pi<span class="token punctuation">;</span> t <span class="token operator">+=</span> res <span class="token punctuation">{</span>
			x <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
			y <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>t<span class="token operator">*</span>freq <span class="token operator">+</span> phase<span class="token punctuation">)</span>
			img<span class="token punctuation">.</span><span class="token function">SetColorIndex</span><span class="token punctuation">(</span>size<span class="token operator">+</span><span class="token function">int</span><span class="token punctuation">(</span>x<span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">+</span><span class="token function">int</span><span class="token punctuation">(</span>y<span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				blackIndex<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		phase <span class="token operator">+=</span> <span class="token number">0.1</span>
		anim<span class="token punctuation">.</span>Delay <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>anim<span class="token punctuation">.</span>Delay<span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
		anim<span class="token punctuation">.</span>Image <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>anim<span class="token punctuation">.</span>Image<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	gif<span class="token punctuation">.</span><span class="token function">EncodeAll</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token operator">&amp;</span>anim<span class="token punctuation">)</span> <span class="token comment">// NOTE: ignoring encoding errors</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-8-本章要点" tabindex="-1"><a class="header-anchor" href="#_1-8-本章要点"><span>1.8. 本章要点</span></a></h2><h3 id="控制流" tabindex="-1"><a class="header-anchor" href="#控制流"><span>控制流</span></a></h3><p><strong>控制流：</strong> 这里是一个简单的switch的例子：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">switch</span> <span class="token function">coinflip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">case</span> <span class="token string">&quot;heads&quot;</span><span class="token punctuation">:</span>
    heads<span class="token operator">++</span>
<span class="token keyword">case</span> <span class="token string">&quot;tails&quot;</span><span class="token punctuation">:</span>
    tails<span class="token operator">++</span>
<span class="token keyword">default</span><span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;landed on edge!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>例子里的coinflip函数返回几种不同的结果，每一个case都会对应一个返回结果，这里需要注意，Go语言并不需要显式地在每一个case后写break，语言默认执行完case后的逻辑语句会自动退出。</p></li><li><p>如果你想要相邻的几个case都执行同一逻辑的话，需要自己显式地写上一个fallthrough语句来覆盖这种默认行为。不过fallthrough语句在一般的程序中很少用到。</p></li><li><p>Go语言里的switch还可以不带操作对象（译注：switch不带操作对象时默认用true值代替，然后将每个case的表达式和true值进行比较）；可以直接罗列多种条件，像其它语言里面的多个if else一样，下面是一个例子：</p></li></ul><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Signum</span><span class="token punctuation">(</span>x <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> x <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token operator">+</span><span class="token number">1</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">case</span> x <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这种形式叫做无tag switch(tagless switch)；这和switch true是等价的。</p><ul><li><p>像for和if控制语句一样，switch也可以紧跟一个简短的变量声明，一个自增表达式、赋值语句，或者一个函数调用（译注：比其它语言丰富）。</p></li><li><p>break和continue语句会改变控制流。和其它语言中的break和continue一样，break会中断当前的循环，并开始执行循环之后的内容，而continue会跳过当前循环，并开始执行下一次循环。这两个语句除了可以控制for循环，还可以用来控制switch和select语句（之后会讲到）</p></li><li><p>在1.3节中我们看到，continue会跳过内层的循环，如果我们想跳过的是更外层的循环的话，我们可以在相应的位置加上label，这样break和continue就可以根据我们的想法来continue和break任意循环。点像goto语句。</p></li></ul><h3 id="命名类型" tabindex="-1"><a class="header-anchor" href="#命名类型"><span>命名类型</span></a></h3><p>类型声明使得我们可以很方便地给一个特殊类型一个名字。因为struct类型声明通常非常地长，所以我们总要给这种struct取一个名字。本章中就有这样一个例子，二维点类型：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Point <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    X<span class="token punctuation">,</span> Y <span class="token builtin">int</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> p Point
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>类型声明和命名类型会在第二章中介绍。</p><h3 id="指针" tabindex="-1"><a class="header-anchor" href="#指针"><span>指针</span></a></h3><ul><li><p>在其它语言中，比如C语言，指针操作是完全不受约束的。在另外一些语言中，指针一般被处理为“引用”，除了到处传递这些指针之外，并不能对这些指针做太多事情。</p></li><li><p>Go语言在这两种范围中取了一种平衡。指针是可见的内存地址，&amp;操作符可以返回一个变量的内存地址，并且*操作符可以获取指针指向的变量内容</p></li><li><p>但是在Go语言里没有指针运算，也就是不能像c语言里可以对指针进行加或减操作。我们会在2.3.2中进行详细介绍。</p></li></ul><h3 id="方法和接口" tabindex="-1"><a class="header-anchor" href="#方法和接口"><span>方法和接口</span></a></h3><p>方法是和命名类型关联的一类函数。Go语言里比较特殊的是方法可以被关联到任意一种命名类型。在第六章我们会详细地讲方法。接口是一种抽象类型，这种类型可以让我们以同样的方式来处理不同的固有类型，不用关心它们的具体实现，而只需要关注它们提供的方法。第七章中会详细说明这些内容。</p><h3 id="包-packages" tabindex="-1"><a class="header-anchor" href="#包-packages"><span>包（packages）</span></a></h3><p>Go语言提供了一些很好用的package，并且这些package是可以扩展的。Go语言社区已经创造并且分享了很多很多。所以Go语言编程大多数情况下就是用已有的package来写我们自己的代码。</p><h3 id="注释" tabindex="-1"><a class="header-anchor" href="#注释"><span>注释</span></a></h3><p>在源文件的开头写的注释是这个源文件的文档。在每一个函数之前写一个说明函数行为的注释也是一个好习惯。这些惯例很重要，因为这些内容会被像godoc这样的工具检测到，并且在执行命令时显示这些注释。具体可以参考10.7.4。</p><p>多行注释可以用 <code>/* ... */</code> 来包裹，和其它大多数语言一样。在文件一开头的注释一般都是这种形式，或者一大段的解释性的注释文字也会被这符号包住，来避免每一行都需要加//。在注释中//和/*是没什么意义的，所以不要在注释中再嵌入注释。</p></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/echo0d/DailyNotes/edit/main/src/develop/Go/gopl/ch1.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: echo0d@163.com">echo0d</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link active prev" href="/DailyNotes/develop/Go/gopl/" aria-label="Go语言圣经"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->Go语言圣经</div></a><a class="route-link nav-link next" href="/DailyNotes/develop/Go/gopl/ch2.html" aria-label="02. 程序结构"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">02. 程序结构<!----></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">听君一席话，如听一席话</div><div class="vp-copyright">Copyright © 2024 echo0d </div></footer></div><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/DailyNotes/assets/app-KRcqTjW-.js" defer></script>
  </body>
</html>
